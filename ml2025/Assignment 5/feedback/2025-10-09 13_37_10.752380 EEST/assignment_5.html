<!DOCTYPE html>
<html>
<head>

<meta charset="utf-8" />
<title>assignment_5</title>

<style type="text/css">
/*!
 * Bootstrap v3.3.4 (http://getbootstrap.com)
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 *//*! normalize.css v3.0.2 | MIT License | git.io/normalize */html{font-family:sans-serif;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,hgroup,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:700}dfn{font-style:italic}h1{margin:.67em 0;font-size:2em}mark{color:#000;background:#ff0}small{font-size:80%}sub,sup{position:relative;font-size:75%;line-height:0;vertical-align:baseline}sup{top:-.5em}sub{bottom:-.25em}img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{height:0;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{margin:0;font:inherit;color:inherit}button{overflow:visible}button,select{text-transform:none}button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}input{line-height:normal}input[type=checkbox],input[type=radio]{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:0}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{height:auto}input[type=search]{-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;-webkit-appearance:textfield}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}fieldset{padding:.35em .625em .75em;margin:0 2px;border:1px solid silver}legend{padding:0;border:0}textarea{overflow:auto}optgroup{font-weight:700}table{border-spacing:0;border-collapse:collapse}td,th{padding:0}/*! Source: https://github.com/h5bp/html5-boilerplate/blob/master/src/css/main.css */@media print{*,:after,:before{color:#000!important;text-shadow:none!important;background:0 0!important;-webkit-box-shadow:none!important;box-shadow:none!important}a,a:visited{text-decoration:underline}a[href]:after{content:" (" attr(href) ")"}abbr[title]:after{content:" (" attr(title) ")"}a[href^="javascript:"]:after,a[href^="#"]:after{content:""}blockquote,pre{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}img,tr{page-break-inside:avoid}img{max-width:100%!important}h2,h3,p{orphans:3;widows:3}h2,h3{page-break-after:avoid}select{background:#fff!important}.navbar{display:none}.btn>.caret,.dropup>.btn>.caret{border-top-color:#000!important}.label{border:1px solid #000}.table{border-collapse:collapse!important}.table td,.table th{background-color:#fff!important}.table-bordered td,.table-bordered th{border:1px solid #ddd!important}}@font-face{font-family:'Glyphicons Halflings';src:url(../fonts/glyphicons-halflings-regular.eot);src:url(../fonts/glyphicons-halflings-regular.eot?#iefix) format('embedded-opentype'),url(../fonts/glyphicons-halflings-regular.woff2) format('woff2'),url(../fonts/glyphicons-halflings-regular.woff) format('woff'),url(../fonts/glyphicons-halflings-regular.ttf) format('truetype'),url(../fonts/glyphicons-halflings-regular.svg#glyphicons_halflingsregular) format('svg')}.glyphicon{position:relative;top:1px;display:inline-block;font-family:'Glyphicons Halflings';font-style:normal;font-weight:400;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.glyphicon-asterisk:before{content:"\2a"}.glyphicon-plus:before{content:"\2b"}.glyphicon-eur:before,.glyphicon-euro:before{content:"\20ac"}.glyphicon-minus:before{content:"\2212"}.glyphicon-cloud:before{content:"\2601"}.glyphicon-envelope:before{content:"\2709"}.glyphicon-pencil:before{content:"\270f"}.glyphicon-glass:before{content:"\e001"}.glyphicon-music:before{content:"\e002"}.glyphicon-search:before{content:"\e003"}.glyphicon-heart:before{content:"\e005"}.glyphicon-star:before{content:"\e006"}.glyphicon-star-empty:before{content:"\e007"}.glyphicon-user:before{content:"\e008"}.glyphicon-film:before{content:"\e009"}.glyphicon-th-large:before{content:"\e010"}.glyphicon-th:before{content:"\e011"}.glyphicon-th-list:before{content:"\e012"}.glyphicon-ok:before{content:"\e013"}.glyphicon-remove:before{content:"\e014"}.glyphicon-zoom-in:before{content:"\e015"}.glyphicon-zoom-out:before{content:"\e016"}.glyphicon-off:before{content:"\e017"}.glyphicon-signal:before{content:"\e018"}.glyphicon-cog:before{content:"\e019"}.glyphicon-trash:before{content:"\e020"}.glyphicon-home:before{content:"\e021"}.glyphicon-file:before{content:"\e022"}.glyphicon-time:before{content:"\e023"}.glyphicon-road:before{content:"\e024"}.glyphicon-download-alt:before{content:"\e025"}.glyphicon-download:before{content:"\e026"}.glyphicon-upload:before{content:"\e027"}.glyphicon-inbox:before{content:"\e028"}.glyphicon-play-circle:before{content:"\e029"}.glyphicon-repeat:before{content:"\e030"}.glyphicon-refresh:before{content:"\e031"}.glyphicon-list-alt:before{content:"\e032"}.glyphicon-lock:before{content:"\e033"}.glyphicon-flag:before{content:"\e034"}.glyphicon-headphones:before{content:"\e035"}.glyphicon-volume-off:before{content:"\e036"}.glyphicon-volume-down:before{content:"\e037"}.glyphicon-volume-up:before{content:"\e038"}.glyphicon-qrcode:before{content:"\e039"}.glyphicon-barcode:before{content:"\e040"}.glyphicon-tag:before{content:"\e041"}.glyphicon-tags:before{content:"\e042"}.glyphicon-book:before{content:"\e043"}.glyphicon-bookmark:before{content:"\e044"}.glyphicon-print:before{content:"\e045"}.glyphicon-camera:before{content:"\e046"}.glyphicon-font:before{content:"\e047"}.glyphicon-bold:before{content:"\e048"}.glyphicon-italic:before{content:"\e049"}.glyphicon-text-height:before{content:"\e050"}.glyphicon-text-width:before{content:"\e051"}.glyphicon-align-left:before{content:"\e052"}.glyphicon-align-center:before{content:"\e053"}.glyphicon-align-right:before{content:"\e054"}.glyphicon-align-justify:before{content:"\e055"}.glyphicon-list:before{content:"\e056"}.glyphicon-indent-left:before{content:"\e057"}.glyphicon-indent-right:before{content:"\e058"}.glyphicon-facetime-video:before{content:"\e059"}.glyphicon-picture:before{content:"\e060"}.glyphicon-map-marker:before{content:"\e062"}.glyphicon-adjust:before{content:"\e063"}.glyphicon-tint:before{content:"\e064"}.glyphicon-edit:before{content:"\e065"}.glyphicon-share:before{content:"\e066"}.glyphicon-check:before{content:"\e067"}.glyphicon-move:before{content:"\e068"}.glyphicon-step-backward:before{content:"\e069"}.glyphicon-fast-backward:before{content:"\e070"}.glyphicon-backward:before{content:"\e071"}.glyphicon-play:before{content:"\e072"}.glyphicon-pause:before{content:"\e073"}.glyphicon-stop:before{content:"\e074"}.glyphicon-forward:before{content:"\e075"}.glyphicon-fast-forward:before{content:"\e076"}.glyphicon-step-forward:before{content:"\e077"}.glyphicon-eject:before{content:"\e078"}.glyphicon-chevron-left:before{content:"\e079"}.glyphicon-chevron-right:before{content:"\e080"}.glyphicon-plus-sign:before{content:"\e081"}.glyphicon-minus-sign:before{content:"\e082"}.glyphicon-remove-sign:before{content:"\e083"}.glyphicon-ok-sign:before{content:"\e084"}.glyphicon-question-sign:before{content:"\e085"}.glyphicon-info-sign:before{content:"\e086"}.glyphicon-screenshot:before{content:"\e087"}.glyphicon-remove-circle:before{content:"\e088"}.glyphicon-ok-circle:before{content:"\e089"}.glyphicon-ban-circle:before{content:"\e090"}.glyphicon-arrow-left:before{content:"\e091"}.glyphicon-arrow-right:before{content:"\e092"}.glyphicon-arrow-up:before{content:"\e093"}.glyphicon-arrow-down:before{content:"\e094"}.glyphicon-share-alt:before{content:"\e095"}.glyphicon-resize-full:before{content:"\e096"}.glyphicon-resize-small:before{content:"\e097"}.glyphicon-exclamation-sign:before{content:"\e101"}.glyphicon-gift:before{content:"\e102"}.glyphicon-leaf:before{content:"\e103"}.glyphicon-fire:before{content:"\e104"}.glyphicon-eye-open:before{content:"\e105"}.glyphicon-eye-close:before{content:"\e106"}.glyphicon-warning-sign:before{content:"\e107"}.glyphicon-plane:before{content:"\e108"}.glyphicon-calendar:before{content:"\e109"}.glyphicon-random:before{content:"\e110"}.glyphicon-comment:before{content:"\e111"}.glyphicon-magnet:before{content:"\e112"}.glyphicon-chevron-up:before{content:"\e113"}.glyphicon-chevron-down:before{content:"\e114"}.glyphicon-retweet:before{content:"\e115"}.glyphicon-shopping-cart:before{content:"\e116"}.glyphicon-folder-close:before{content:"\e117"}.glyphicon-folder-open:before{content:"\e118"}.glyphicon-resize-vertical:before{content:"\e119"}.glyphicon-resize-horizontal:before{content:"\e120"}.glyphicon-hdd:before{content:"\e121"}.glyphicon-bullhorn:before{content:"\e122"}.glyphicon-bell:before{content:"\e123"}.glyphicon-certificate:before{content:"\e124"}.glyphicon-thumbs-up:before{content:"\e125"}.glyphicon-thumbs-down:before{content:"\e126"}.glyphicon-hand-right:before{content:"\e127"}.glyphicon-hand-left:before{content:"\e128"}.glyphicon-hand-up:before{content:"\e129"}.glyphicon-hand-down:before{content:"\e130"}.glyphicon-circle-arrow-right:before{content:"\e131"}.glyphicon-circle-arrow-left:before{content:"\e132"}.glyphicon-circle-arrow-up:before{content:"\e133"}.glyphicon-circle-arrow-down:before{content:"\e134"}.glyphicon-globe:before{content:"\e135"}.glyphicon-wrench:before{content:"\e136"}.glyphicon-tasks:before{content:"\e137"}.glyphicon-filter:before{content:"\e138"}.glyphicon-briefcase:before{content:"\e139"}.glyphicon-fullscreen:before{content:"\e140"}.glyphicon-dashboard:before{content:"\e141"}.glyphicon-paperclip:before{content:"\e142"}.glyphicon-heart-empty:before{content:"\e143"}.glyphicon-link:before{content:"\e144"}.glyphicon-phone:before{content:"\e145"}.glyphicon-pushpin:before{content:"\e146"}.glyphicon-usd:before{content:"\e148"}.glyphicon-gbp:before{content:"\e149"}.glyphicon-sort:before{content:"\e150"}.glyphicon-sort-by-alphabet:before{content:"\e151"}.glyphicon-sort-by-alphabet-alt:before{content:"\e152"}.glyphicon-sort-by-order:before{content:"\e153"}.glyphicon-sort-by-order-alt:before{content:"\e154"}.glyphicon-sort-by-attributes:before{content:"\e155"}.glyphicon-sort-by-attributes-alt:before{content:"\e156"}.glyphicon-unchecked:before{content:"\e157"}.glyphicon-expand:before{content:"\e158"}.glyphicon-collapse-down:before{content:"\e159"}.glyphicon-collapse-up:before{content:"\e160"}.glyphicon-log-in:before{content:"\e161"}.glyphicon-flash:before{content:"\e162"}.glyphicon-log-out:before{content:"\e163"}.glyphicon-new-window:before{content:"\e164"}.glyphicon-record:before{content:"\e165"}.glyphicon-save:before{content:"\e166"}.glyphicon-open:before{content:"\e167"}.glyphicon-saved:before{content:"\e168"}.glyphicon-import:before{content:"\e169"}.glyphicon-export:before{content:"\e170"}.glyphicon-send:before{content:"\e171"}.glyphicon-floppy-disk:before{content:"\e172"}.glyphicon-floppy-saved:before{content:"\e173"}.glyphicon-floppy-remove:before{content:"\e174"}.glyphicon-floppy-save:before{content:"\e175"}.glyphicon-floppy-open:before{content:"\e176"}.glyphicon-credit-card:before{content:"\e177"}.glyphicon-transfer:before{content:"\e178"}.glyphicon-cutlery:before{content:"\e179"}.glyphicon-header:before{content:"\e180"}.glyphicon-compressed:before{content:"\e181"}.glyphicon-earphone:before{content:"\e182"}.glyphicon-phone-alt:before{content:"\e183"}.glyphicon-tower:before{content:"\e184"}.glyphicon-stats:before{content:"\e185"}.glyphicon-sd-video:before{content:"\e186"}.glyphicon-hd-video:before{content:"\e187"}.glyphicon-subtitles:before{content:"\e188"}.glyphicon-sound-stereo:before{content:"\e189"}.glyphicon-sound-dolby:before{content:"\e190"}.glyphicon-sound-5-1:before{content:"\e191"}.glyphicon-sound-6-1:before{content:"\e192"}.glyphicon-sound-7-1:before{content:"\e193"}.glyphicon-copyright-mark:before{content:"\e194"}.glyphicon-registration-mark:before{content:"\e195"}.glyphicon-cloud-download:before{content:"\e197"}.glyphicon-cloud-upload:before{content:"\e198"}.glyphicon-tree-conifer:before{content:"\e199"}.glyphicon-tree-deciduous:before{content:"\e200"}.glyphicon-cd:before{content:"\e201"}.glyphicon-save-file:before{content:"\e202"}.glyphicon-open-file:before{content:"\e203"}.glyphicon-level-up:before{content:"\e204"}.glyphicon-copy:before{content:"\e205"}.glyphicon-paste:before{content:"\e206"}.glyphicon-alert:before{content:"\e209"}.glyphicon-equalizer:before{content:"\e210"}.glyphicon-king:before{content:"\e211"}.glyphicon-queen:before{content:"\e212"}.glyphicon-pawn:before{content:"\e213"}.glyphicon-bishop:before{content:"\e214"}.glyphicon-knight:before{content:"\e215"}.glyphicon-baby-formula:before{content:"\e216"}.glyphicon-tent:before{content:"\26fa"}.glyphicon-blackboard:before{content:"\e218"}.glyphicon-bed:before{content:"\e219"}.glyphicon-apple:before{content:"\f8ff"}.glyphicon-erase:before{content:"\e221"}.glyphicon-hourglass:before{content:"\231b"}.glyphicon-lamp:before{content:"\e223"}.glyphicon-duplicate:before{content:"\e224"}.glyphicon-piggy-bank:before{content:"\e225"}.glyphicon-scissors:before{content:"\e226"}.glyphicon-bitcoin:before{content:"\e227"}.glyphicon-btc:before{content:"\e227"}.glyphicon-xbt:before{content:"\e227"}.glyphicon-yen:before{content:"\00a5"}.glyphicon-jpy:before{content:"\00a5"}.glyphicon-ruble:before{content:"\20bd"}.glyphicon-rub:before{content:"\20bd"}.glyphicon-scale:before{content:"\e230"}.glyphicon-ice-lolly:before{content:"\e231"}.glyphicon-ice-lolly-tasted:before{content:"\e232"}.glyphicon-education:before{content:"\e233"}.glyphicon-option-horizontal:before{content:"\e234"}.glyphicon-option-vertical:before{content:"\e235"}.glyphicon-menu-hamburger:before{content:"\e236"}.glyphicon-modal-window:before{content:"\e237"}.glyphicon-oil:before{content:"\e238"}.glyphicon-grain:before{content:"\e239"}.glyphicon-sunglasses:before{content:"\e240"}.glyphicon-text-size:before{content:"\e241"}.glyphicon-text-color:before{content:"\e242"}.glyphicon-text-background:before{content:"\e243"}.glyphicon-object-align-top:before{content:"\e244"}.glyphicon-object-align-bottom:before{content:"\e245"}.glyphicon-object-align-horizontal:before{content:"\e246"}.glyphicon-object-align-left:before{content:"\e247"}.glyphicon-object-align-vertical:before{content:"\e248"}.glyphicon-object-align-right:before{content:"\e249"}.glyphicon-triangle-right:before{content:"\e250"}.glyphicon-triangle-left:before{content:"\e251"}.glyphicon-triangle-bottom:before{content:"\e252"}.glyphicon-triangle-top:before{content:"\e253"}.glyphicon-console:before{content:"\e254"}.glyphicon-superscript:before{content:"\e255"}.glyphicon-subscript:before{content:"\e256"}.glyphicon-menu-left:before{content:"\e257"}.glyphicon-menu-right:before{content:"\e258"}.glyphicon-menu-down:before{content:"\e259"}.glyphicon-menu-up:before{content:"\e260"}*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}:after,:before{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}html{font-size:10px;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:14px;line-height:1.42857143;color:#333;background-color:#fff}button,input,select,textarea{font-family:inherit;font-size:inherit;line-height:inherit}a{color:#337ab7;text-decoration:none}a:focus,a:hover{color:#23527c;text-decoration:underline}a:focus{outline:thin dotted;outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}figure{margin:0}img{vertical-align:middle}.carousel-inner>.item>a>img,.carousel-inner>.item>img,.img-responsive,.thumbnail a>img,.thumbnail>img{display:block;max-width:100%;height:auto}.img-rounded{border-radius:6px}.img-thumbnail{display:inline-block;max-width:100%;height:auto;padding:4px;line-height:1.42857143;background-color:#fff;border:1px solid #ddd;border-radius:4px;-webkit-transition:all .2s ease-in-out;-o-transition:all .2s ease-in-out;transition:all .2s ease-in-out}.img-circle{border-radius:50%}hr{margin-top:20px;margin-bottom:20px;border:0;border-top:1px solid #eee}.sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0}.sr-only-focusable:active,.sr-only-focusable:focus{position:static;width:auto;height:auto;margin:0;overflow:visible;clip:auto}[role=button]{cursor:pointer}.h1,.h2,.h3,.h4,.h5,.h6,h1,h2,h3,h4,h5,h6{font-family:inherit;font-weight:500;line-height:1.1;color:inherit}.h1 .small,.h1 small,.h2 .small,.h2 small,.h3 .small,.h3 small,.h4 .small,.h4 small,.h5 .small,.h5 small,.h6 .small,.h6 small,h1 .small,h1 small,h2 .small,h2 small,h3 .small,h3 small,h4 .small,h4 small,h5 .small,h5 small,h6 .small,h6 small{font-weight:400;line-height:1;color:#777}.h1,.h2,.h3,h1,h2,h3{margin-top:20px;margin-bottom:10px}.h1 .small,.h1 small,.h2 .small,.h2 small,.h3 .small,.h3 small,h1 .small,h1 small,h2 .small,h2 small,h3 .small,h3 small{font-size:65%}.h4,.h5,.h6,h4,h5,h6{margin-top:10px;margin-bottom:10px}.h4 .small,.h4 small,.h5 .small,.h5 small,.h6 .small,.h6 small,h4 .small,h4 small,h5 .small,h5 small,h6 .small,h6 small{font-size:75%}.h1,h1{font-size:36px}.h2,h2{font-size:30px}.h3,h3{font-size:24px}.h4,h4{font-size:18px}.h5,h5{font-size:14px}.h6,h6{font-size:12px}p{margin:0 0 10px}.lead{margin-bottom:20px;font-size:16px;font-weight:300;line-height:1.4}@media (min-width:768px){.lead{font-size:21px}}.small,small{font-size:85%}.mark,mark{padding:.2em;background-color:#fcf8e3}.text-left{text-align:left}.text-right{text-align:right}.text-center{text-align:center}.text-justify{text-align:justify}.text-nowrap{white-space:nowrap}.text-lowercase{text-transform:lowercase}.text-uppercase{text-transform:uppercase}.text-capitalize{text-transform:capitalize}.text-muted{color:#777}.text-primary{color:#337ab7}a.text-primary:hover{color:#286090}.text-success{color:#3c763d}a.text-success:hover{color:#2b542c}.text-info{color:#31708f}a.text-info:hover{color:#245269}.text-warning{color:#8a6d3b}a.text-warning:hover{color:#66512c}.text-danger{color:#a94442}a.text-danger:hover{color:#843534}.bg-primary{color:#fff;background-color:#337ab7}a.bg-primary:hover{background-color:#286090}.bg-success{background-color:#dff0d8}a.bg-success:hover{background-color:#c1e2b3}.bg-info{background-color:#d9edf7}a.bg-info:hover{background-color:#afd9ee}.bg-warning{background-color:#fcf8e3}a.bg-warning:hover{background-color:#f7ecb5}.bg-danger{background-color:#f2dede}a.bg-danger:hover{background-color:#e4b9b9}.page-header{padding-bottom:9px;margin:40px 0 20px;border-bottom:1px solid #eee}ol,ul{margin-top:0;margin-bottom:10px}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}.list-unstyled{padding-left:0;list-style:none}.list-inline{padding-left:0;margin-left:-5px;list-style:none}.list-inline>li{display:inline-block;padding-right:5px;padding-left:5px}dl{margin-top:0;margin-bottom:20px}dd,dt{line-height:1.42857143}dt{font-weight:700}dd{margin-left:0}@media (min-width:768px){.dl-horizontal dt{float:left;width:160px;overflow:hidden;clear:left;text-align:right;text-overflow:ellipsis;white-space:nowrap}.dl-horizontal dd{margin-left:180px}}abbr[data-original-title],abbr[title]{cursor:help;border-bottom:1px dotted #777}.initialism{font-size:90%;text-transform:uppercase}blockquote{padding:10px 20px;margin:0 0 20px;font-size:17.5px;border-left:5px solid #eee}blockquote ol:last-child,blockquote p:last-child,blockquote ul:last-child{margin-bottom:0}blockquote .small,blockquote footer,blockquote small{display:block;font-size:80%;line-height:1.42857143;color:#777}blockquote .small:before,blockquote footer:before,blockquote small:before{content:'\2014 \00A0'}.blockquote-reverse,blockquote.pull-right{padding-right:15px;padding-left:0;text-align:right;border-right:5px solid #eee;border-left:0}.blockquote-reverse .small:before,.blockquote-reverse footer:before,.blockquote-reverse small:before,blockquote.pull-right .small:before,blockquote.pull-right footer:before,blockquote.pull-right small:before{content:''}.blockquote-reverse .small:after,.blockquote-reverse footer:after,.blockquote-reverse small:after,blockquote.pull-right .small:after,blockquote.pull-right footer:after,blockquote.pull-right small:after{content:'\00A0 \2014'}address{margin-bottom:20px;font-style:normal;line-height:1.42857143}code,kbd,pre,samp{font-family:Menlo,Monaco,Consolas,"Courier New",monospace}code{padding:2px 4px;font-size:90%;color:#c7254e;background-color:#f9f2f4;border-radius:4px}kbd{padding:2px 4px;font-size:90%;color:#fff;background-color:#333;border-radius:3px;-webkit-box-shadow:inset 0 -1px 0 rgba(0,0,0,.25);box-shadow:inset 0 -1px 0 rgba(0,0,0,.25)}kbd kbd{padding:0;font-size:100%;font-weight:700;-webkit-box-shadow:none;box-shadow:none}pre{display:block;padding:9.5px;margin:0 0 10px;font-size:13px;line-height:1.42857143;color:#333;word-break:break-all;word-wrap:break-word;background-color:#f5f5f5;border:1px solid #ccc;border-radius:4px}pre code{padding:0;font-size:inherit;color:inherit;white-space:pre-wrap;background-color:transparent;border-radius:0}.pre-scrollable{max-height:340px;overflow-y:scroll}.container{padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}@media (min-width:768px){.container{width:750px}}@media (min-width:992px){.container{width:970px}}@media (min-width:1200px){.container{width:1170px}}.container-fluid{padding-right:15px;padding-left:15px;margin-right:auto;margin-left:auto}.row{margin-right:-15px;margin-left:-15px}.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9,.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9,.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9,.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9{position:relative;min-height:1px;padding-right:15px;padding-left:15px}.col-xs-1,.col-xs-10,.col-xs-11,.col-xs-12,.col-xs-2,.col-xs-3,.col-xs-4,.col-xs-5,.col-xs-6,.col-xs-7,.col-xs-8,.col-xs-9{float:left}.col-xs-12{width:100%}.col-xs-11{width:91.66666667%}.col-xs-10{width:83.33333333%}.col-xs-9{width:75%}.col-xs-8{width:66.66666667%}.col-xs-7{width:58.33333333%}.col-xs-6{width:50%}.col-xs-5{width:41.66666667%}.col-xs-4{width:33.33333333%}.col-xs-3{width:25%}.col-xs-2{width:16.66666667%}.col-xs-1{width:8.33333333%}.col-xs-pull-12{right:100%}.col-xs-pull-11{right:91.66666667%}.col-xs-pull-10{right:83.33333333%}.col-xs-pull-9{right:75%}.col-xs-pull-8{right:66.66666667%}.col-xs-pull-7{right:58.33333333%}.col-xs-pull-6{right:50%}.col-xs-pull-5{right:41.66666667%}.col-xs-pull-4{right:33.33333333%}.col-xs-pull-3{right:25%}.col-xs-pull-2{right:16.66666667%}.col-xs-pull-1{right:8.33333333%}.col-xs-pull-0{right:auto}.col-xs-push-12{left:100%}.col-xs-push-11{left:91.66666667%}.col-xs-push-10{left:83.33333333%}.col-xs-push-9{left:75%}.col-xs-push-8{left:66.66666667%}.col-xs-push-7{left:58.33333333%}.col-xs-push-6{left:50%}.col-xs-push-5{left:41.66666667%}.col-xs-push-4{left:33.33333333%}.col-xs-push-3{left:25%}.col-xs-push-2{left:16.66666667%}.col-xs-push-1{left:8.33333333%}.col-xs-push-0{left:auto}.col-xs-offset-12{margin-left:100%}.col-xs-offset-11{margin-left:91.66666667%}.col-xs-offset-10{margin-left:83.33333333%}.col-xs-offset-9{margin-left:75%}.col-xs-offset-8{margin-left:66.66666667%}.col-xs-offset-7{margin-left:58.33333333%}.col-xs-offset-6{margin-left:50%}.col-xs-offset-5{margin-left:41.66666667%}.col-xs-offset-4{margin-left:33.33333333%}.col-xs-offset-3{margin-left:25%}.col-xs-offset-2{margin-left:16.66666667%}.col-xs-offset-1{margin-left:8.33333333%}.col-xs-offset-0{margin-left:0}@media (min-width:768px){.col-sm-1,.col-sm-10,.col-sm-11,.col-sm-12,.col-sm-2,.col-sm-3,.col-sm-4,.col-sm-5,.col-sm-6,.col-sm-7,.col-sm-8,.col-sm-9{float:left}.col-sm-12{width:100%}.col-sm-11{width:91.66666667%}.col-sm-10{width:83.33333333%}.col-sm-9{width:75%}.col-sm-8{width:66.66666667%}.col-sm-7{width:58.33333333%}.col-sm-6{width:50%}.col-sm-5{width:41.66666667%}.col-sm-4{width:33.33333333%}.col-sm-3{width:25%}.col-sm-2{width:16.66666667%}.col-sm-1{width:8.33333333%}.col-sm-pull-12{right:100%}.col-sm-pull-11{right:91.66666667%}.col-sm-pull-10{right:83.33333333%}.col-sm-pull-9{right:75%}.col-sm-pull-8{right:66.66666667%}.col-sm-pull-7{right:58.33333333%}.col-sm-pull-6{right:50%}.col-sm-pull-5{right:41.66666667%}.col-sm-pull-4{right:33.33333333%}.col-sm-pull-3{right:25%}.col-sm-pull-2{right:16.66666667%}.col-sm-pull-1{right:8.33333333%}.col-sm-pull-0{right:auto}.col-sm-push-12{left:100%}.col-sm-push-11{left:91.66666667%}.col-sm-push-10{left:83.33333333%}.col-sm-push-9{left:75%}.col-sm-push-8{left:66.66666667%}.col-sm-push-7{left:58.33333333%}.col-sm-push-6{left:50%}.col-sm-push-5{left:41.66666667%}.col-sm-push-4{left:33.33333333%}.col-sm-push-3{left:25%}.col-sm-push-2{left:16.66666667%}.col-sm-push-1{left:8.33333333%}.col-sm-push-0{left:auto}.col-sm-offset-12{margin-left:100%}.col-sm-offset-11{margin-left:91.66666667%}.col-sm-offset-10{margin-left:83.33333333%}.col-sm-offset-9{margin-left:75%}.col-sm-offset-8{margin-left:66.66666667%}.col-sm-offset-7{margin-left:58.33333333%}.col-sm-offset-6{margin-left:50%}.col-sm-offset-5{margin-left:41.66666667%}.col-sm-offset-4{margin-left:33.33333333%}.col-sm-offset-3{margin-left:25%}.col-sm-offset-2{margin-left:16.66666667%}.col-sm-offset-1{margin-left:8.33333333%}.col-sm-offset-0{margin-left:0}}@media (min-width:992px){.col-md-1,.col-md-10,.col-md-11,.col-md-12,.col-md-2,.col-md-3,.col-md-4,.col-md-5,.col-md-6,.col-md-7,.col-md-8,.col-md-9{float:left}.col-md-12{width:100%}.col-md-11{width:91.66666667%}.col-md-10{width:83.33333333%}.col-md-9{width:75%}.col-md-8{width:66.66666667%}.col-md-7{width:58.33333333%}.col-md-6{width:50%}.col-md-5{width:41.66666667%}.col-md-4{width:33.33333333%}.col-md-3{width:25%}.col-md-2{width:16.66666667%}.col-md-1{width:8.33333333%}.col-md-pull-12{right:100%}.col-md-pull-11{right:91.66666667%}.col-md-pull-10{right:83.33333333%}.col-md-pull-9{right:75%}.col-md-pull-8{right:66.66666667%}.col-md-pull-7{right:58.33333333%}.col-md-pull-6{right:50%}.col-md-pull-5{right:41.66666667%}.col-md-pull-4{right:33.33333333%}.col-md-pull-3{right:25%}.col-md-pull-2{right:16.66666667%}.col-md-pull-1{right:8.33333333%}.col-md-pull-0{right:auto}.col-md-push-12{left:100%}.col-md-push-11{left:91.66666667%}.col-md-push-10{left:83.33333333%}.col-md-push-9{left:75%}.col-md-push-8{left:66.66666667%}.col-md-push-7{left:58.33333333%}.col-md-push-6{left:50%}.col-md-push-5{left:41.66666667%}.col-md-push-4{left:33.33333333%}.col-md-push-3{left:25%}.col-md-push-2{left:16.66666667%}.col-md-push-1{left:8.33333333%}.col-md-push-0{left:auto}.col-md-offset-12{margin-left:100%}.col-md-offset-11{margin-left:91.66666667%}.col-md-offset-10{margin-left:83.33333333%}.col-md-offset-9{margin-left:75%}.col-md-offset-8{margin-left:66.66666667%}.col-md-offset-7{margin-left:58.33333333%}.col-md-offset-6{margin-left:50%}.col-md-offset-5{margin-left:41.66666667%}.col-md-offset-4{margin-left:33.33333333%}.col-md-offset-3{margin-left:25%}.col-md-offset-2{margin-left:16.66666667%}.col-md-offset-1{margin-left:8.33333333%}.col-md-offset-0{margin-left:0}}@media (min-width:1200px){.col-lg-1,.col-lg-10,.col-lg-11,.col-lg-12,.col-lg-2,.col-lg-3,.col-lg-4,.col-lg-5,.col-lg-6,.col-lg-7,.col-lg-8,.col-lg-9{float:left}.col-lg-12{width:100%}.col-lg-11{width:91.66666667%}.col-lg-10{width:83.33333333%}.col-lg-9{width:75%}.col-lg-8{width:66.66666667%}.col-lg-7{width:58.33333333%}.col-lg-6{width:50%}.col-lg-5{width:41.66666667%}.col-lg-4{width:33.33333333%}.col-lg-3{width:25%}.col-lg-2{width:16.66666667%}.col-lg-1{width:8.33333333%}.col-lg-pull-12{right:100%}.col-lg-pull-11{right:91.66666667%}.col-lg-pull-10{right:83.33333333%}.col-lg-pull-9{right:75%}.col-lg-pull-8{right:66.66666667%}.col-lg-pull-7{right:58.33333333%}.col-lg-pull-6{right:50%}.col-lg-pull-5{right:41.66666667%}.col-lg-pull-4{right:33.33333333%}.col-lg-pull-3{right:25%}.col-lg-pull-2{right:16.66666667%}.col-lg-pull-1{right:8.33333333%}.col-lg-pull-0{right:auto}.col-lg-push-12{left:100%}.col-lg-push-11{left:91.66666667%}.col-lg-push-10{left:83.33333333%}.col-lg-push-9{left:75%}.col-lg-push-8{left:66.66666667%}.col-lg-push-7{left:58.33333333%}.col-lg-push-6{left:50%}.col-lg-push-5{left:41.66666667%}.col-lg-push-4{left:33.33333333%}.col-lg-push-3{left:25%}.col-lg-push-2{left:16.66666667%}.col-lg-push-1{left:8.33333333%}.col-lg-push-0{left:auto}.col-lg-offset-12{margin-left:100%}.col-lg-offset-11{margin-left:91.66666667%}.col-lg-offset-10{margin-left:83.33333333%}.col-lg-offset-9{margin-left:75%}.col-lg-offset-8{margin-left:66.66666667%}.col-lg-offset-7{margin-left:58.33333333%}.col-lg-offset-6{margin-left:50%}.col-lg-offset-5{margin-left:41.66666667%}.col-lg-offset-4{margin-left:33.33333333%}.col-lg-offset-3{margin-left:25%}.col-lg-offset-2{margin-left:16.66666667%}.col-lg-offset-1{margin-left:8.33333333%}.col-lg-offset-0{margin-left:0}}table{background-color:transparent}caption{padding-top:8px;padding-bottom:8px;color:#777;text-align:left}th{text-align:left}.table{width:100%;max-width:100%;margin-bottom:20px}.table>tbody>tr>td,.table>tbody>tr>th,.table>tfoot>tr>td,.table>tfoot>tr>th,.table>thead>tr>td,.table>thead>tr>th{padding:8px;line-height:1.42857143;vertical-align:top;border-top:1px solid #ddd}.table>thead>tr>th{vertical-align:bottom;border-bottom:2px solid #ddd}.table>caption+thead>tr:first-child>td,.table>caption+thead>tr:first-child>th,.table>colgroup+thead>tr:first-child>td,.table>colgroup+thead>tr:first-child>th,.table>thead:first-child>tr:first-child>td,.table>thead:first-child>tr:first-child>th{border-top:0}.table>tbody+tbody{border-top:2px solid #ddd}.table .table{background-color:#fff}.table-condensed>tbody>tr>td,.table-condensed>tbody>tr>th,.table-condensed>tfoot>tr>td,.table-condensed>tfoot>tr>th,.table-condensed>thead>tr>td,.table-condensed>thead>tr>th{padding:5px}.table-bordered{border:1px solid #ddd}.table-bordered>tbody>tr>td,.table-bordered>tbody>tr>th,.table-bordered>tfoot>tr>td,.table-bordered>tfoot>tr>th,.table-bordered>thead>tr>td,.table-bordered>thead>tr>th{border:1px solid #ddd}.table-bordered>thead>tr>td,.table-bordered>thead>tr>th{border-bottom-width:2px}.table-striped>tbody>tr:nth-of-type(odd){background-color:#f9f9f9}.table-hover>tbody>tr:hover{background-color:#f5f5f5}table col[class*=col-]{position:static;display:table-column;float:none}table td[class*=col-],table th[class*=col-]{position:static;display:table-cell;float:none}.table>tbody>tr.active>td,.table>tbody>tr.active>th,.table>tbody>tr>td.active,.table>tbody>tr>th.active,.table>tfoot>tr.active>td,.table>tfoot>tr.active>th,.table>tfoot>tr>td.active,.table>tfoot>tr>th.active,.table>thead>tr.active>td,.table>thead>tr.active>th,.table>thead>tr>td.active,.table>thead>tr>th.active{background-color:#f5f5f5}.table-hover>tbody>tr.active:hover>td,.table-hover>tbody>tr.active:hover>th,.table-hover>tbody>tr:hover>.active,.table-hover>tbody>tr>td.active:hover,.table-hover>tbody>tr>th.active:hover{background-color:#e8e8e8}.table>tbody>tr.success>td,.table>tbody>tr.success>th,.table>tbody>tr>td.success,.table>tbody>tr>th.success,.table>tfoot>tr.success>td,.table>tfoot>tr.success>th,.table>tfoot>tr>td.success,.table>tfoot>tr>th.success,.table>thead>tr.success>td,.table>thead>tr.success>th,.table>thead>tr>td.success,.table>thead>tr>th.success{background-color:#dff0d8}.table-hover>tbody>tr.success:hover>td,.table-hover>tbody>tr.success:hover>th,.table-hover>tbody>tr:hover>.success,.table-hover>tbody>tr>td.success:hover,.table-hover>tbody>tr>th.success:hover{background-color:#d0e9c6}.table>tbody>tr.info>td,.table>tbody>tr.info>th,.table>tbody>tr>td.info,.table>tbody>tr>th.info,.table>tfoot>tr.info>td,.table>tfoot>tr.info>th,.table>tfoot>tr>td.info,.table>tfoot>tr>th.info,.table>thead>tr.info>td,.table>thead>tr.info>th,.table>thead>tr>td.info,.table>thead>tr>th.info{background-color:#d9edf7}.table-hover>tbody>tr.info:hover>td,.table-hover>tbody>tr.info:hover>th,.table-hover>tbody>tr:hover>.info,.table-hover>tbody>tr>td.info:hover,.table-hover>tbody>tr>th.info:hover{background-color:#c4e3f3}.table>tbody>tr.warning>td,.table>tbody>tr.warning>th,.table>tbody>tr>td.warning,.table>tbody>tr>th.warning,.table>tfoot>tr.warning>td,.table>tfoot>tr.warning>th,.table>tfoot>tr>td.warning,.table>tfoot>tr>th.warning,.table>thead>tr.warning>td,.table>thead>tr.warning>th,.table>thead>tr>td.warning,.table>thead>tr>th.warning{background-color:#fcf8e3}.table-hover>tbody>tr.warning:hover>td,.table-hover>tbody>tr.warning:hover>th,.table-hover>tbody>tr:hover>.warning,.table-hover>tbody>tr>td.warning:hover,.table-hover>tbody>tr>th.warning:hover{background-color:#faf2cc}.table>tbody>tr.danger>td,.table>tbody>tr.danger>th,.table>tbody>tr>td.danger,.table>tbody>tr>th.danger,.table>tfoot>tr.danger>td,.table>tfoot>tr.danger>th,.table>tfoot>tr>td.danger,.table>tfoot>tr>th.danger,.table>thead>tr.danger>td,.table>thead>tr.danger>th,.table>thead>tr>td.danger,.table>thead>tr>th.danger{background-color:#f2dede}.table-hover>tbody>tr.danger:hover>td,.table-hover>tbody>tr.danger:hover>th,.table-hover>tbody>tr:hover>.danger,.table-hover>tbody>tr>td.danger:hover,.table-hover>tbody>tr>th.danger:hover{background-color:#ebcccc}.table-responsive{min-height:.01%;overflow-x:auto}@media screen and (max-width:767px){.table-responsive{width:100%;margin-bottom:15px;overflow-y:hidden;-ms-overflow-style:-ms-autohiding-scrollbar;border:1px solid #ddd}.table-responsive>.table{margin-bottom:0}.table-responsive>.table>tbody>tr>td,.table-responsive>.table>tbody>tr>th,.table-responsive>.table>tfoot>tr>td,.table-responsive>.table>tfoot>tr>th,.table-responsive>.table>thead>tr>td,.table-responsive>.table>thead>tr>th{white-space:nowrap}.table-responsive>.table-bordered{border:0}.table-responsive>.table-bordered>tbody>tr>td:first-child,.table-responsive>.table-bordered>tbody>tr>th:first-child,.table-responsive>.table-bordered>tfoot>tr>td:first-child,.table-responsive>.table-bordered>tfoot>tr>th:first-child,.table-responsive>.table-bordered>thead>tr>td:first-child,.table-responsive>.table-bordered>thead>tr>th:first-child{border-left:0}.table-responsive>.table-bordered>tbody>tr>td:last-child,.table-responsive>.table-bordered>tbody>tr>th:last-child,.table-responsive>.table-bordered>tfoot>tr>td:last-child,.table-responsive>.table-bordered>tfoot>tr>th:last-child,.table-responsive>.table-bordered>thead>tr>td:last-child,.table-responsive>.table-bordered>thead>tr>th:last-child{border-right:0}.table-responsive>.table-bordered>tbody>tr:last-child>td,.table-responsive>.table-bordered>tbody>tr:last-child>th,.table-responsive>.table-bordered>tfoot>tr:last-child>td,.table-responsive>.table-bordered>tfoot>tr:last-child>th{border-bottom:0}}fieldset{min-width:0;padding:0;margin:0;border:0}legend{display:block;width:100%;padding:0;margin-bottom:20px;font-size:21px;line-height:inherit;color:#333;border:0;border-bottom:1px solid #e5e5e5}label{display:inline-block;max-width:100%;margin-bottom:5px;font-weight:700}input[type=search]{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}input[type=checkbox],input[type=radio]{margin:4px 0 0;margin-top:1px \9;line-height:normal}input[type=file]{display:block}input[type=range]{display:block;width:100%}select[multiple],select[size]{height:auto}input[type=file]:focus,input[type=checkbox]:focus,input[type=radio]:focus{outline:thin dotted;outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}output{display:block;padding-top:7px;font-size:14px;line-height:1.42857143;color:#555}.form-control{display:block;width:100%;height:34px;padding:6px 12px;font-size:14px;line-height:1.42857143;color:#555;background-color:#fff;background-image:none;border:1px solid #ccc;border-radius:4px;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075);-webkit-transition:border-color ease-in-out .15s,-webkit-box-shadow ease-in-out .15s;-o-transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s;transition:border-color ease-in-out .15s,box-shadow ease-in-out .15s}.form-control:focus{border-color:#66afe9;outline:0;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6);box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 8px rgba(102,175,233,.6)}.form-control::-moz-placeholder{color:#999;opacity:1}.form-control:-ms-input-placeholder{color:#999}.form-control::-webkit-input-placeholder{color:#999}.form-control[disabled],.form-control[readonly],fieldset[disabled] .form-control{background-color:#eee;opacity:1}.form-control[disabled],fieldset[disabled] .form-control{cursor:not-allowed}textarea.form-control{height:auto}input[type=search]{-webkit-appearance:none}@media screen and (-webkit-min-device-pixel-ratio:0){input[type=date],input[type=time],input[type=datetime-local],input[type=month]{line-height:34px}.input-group-sm input[type=date],.input-group-sm input[type=time],.input-group-sm input[type=datetime-local],.input-group-sm input[type=month],input[type=date].input-sm,input[type=time].input-sm,input[type=datetime-local].input-sm,input[type=month].input-sm{line-height:30px}.input-group-lg input[type=date],.input-group-lg input[type=time],.input-group-lg input[type=datetime-local],.input-group-lg input[type=month],input[type=date].input-lg,input[type=time].input-lg,input[type=datetime-local].input-lg,input[type=month].input-lg{line-height:46px}}.form-group{margin-bottom:15px}.checkbox,.radio{position:relative;display:block;margin-top:10px;margin-bottom:10px}.checkbox label,.radio label{min-height:20px;padding-left:20px;margin-bottom:0;font-weight:400;cursor:pointer}.checkbox input[type=checkbox],.checkbox-inline input[type=checkbox],.radio input[type=radio],.radio-inline input[type=radio]{position:absolute;margin-top:4px \9;margin-left:-20px}.checkbox+.checkbox,.radio+.radio{margin-top:-5px}.checkbox-inline,.radio-inline{position:relative;display:inline-block;padding-left:20px;margin-bottom:0;font-weight:400;vertical-align:middle;cursor:pointer}.checkbox-inline+.checkbox-inline,.radio-inline+.radio-inline{margin-top:0;margin-left:10px}fieldset[disabled] input[type=checkbox],fieldset[disabled] input[type=radio],input[type=checkbox].disabled,input[type=checkbox][disabled],input[type=radio].disabled,input[type=radio][disabled]{cursor:not-allowed}.checkbox-inline.disabled,.radio-inline.disabled,fieldset[disabled] .checkbox-inline,fieldset[disabled] .radio-inline{cursor:not-allowed}.checkbox.disabled label,.radio.disabled label,fieldset[disabled] .checkbox label,fieldset[disabled] .radio label{cursor:not-allowed}.form-control-static{min-height:34px;padding-top:7px;padding-bottom:7px;margin-bottom:0}.form-control-static.input-lg,.form-control-static.input-sm{padding-right:0;padding-left:0}.input-sm{height:30px;padding:5px 10px;font-size:12px;line-height:1.5;border-radius:3px}select.input-sm{height:30px;line-height:30px}select[multiple].input-sm,textarea.input-sm{height:auto}.form-group-sm .form-control{height:30px;padding:5px 10px;font-size:12px;line-height:1.5;border-radius:3px}select.form-group-sm .form-control{height:30px;line-height:30px}select[multiple].form-group-sm .form-control,textarea.form-group-sm .form-control{height:auto}.form-group-sm .form-control-static{height:30px;min-height:32px;padding:5px 10px;font-size:12px;line-height:1.5}.input-lg{height:46px;padding:10px 16px;font-size:18px;line-height:1.3333333;border-radius:6px}select.input-lg{height:46px;line-height:46px}select[multiple].input-lg,textarea.input-lg{height:auto}.form-group-lg .form-control{height:46px;padding:10px 16px;font-size:18px;line-height:1.3333333;border-radius:6px}select.form-group-lg .form-control{height:46px;line-height:46px}select[multiple].form-group-lg .form-control,textarea.form-group-lg .form-control{height:auto}.form-group-lg .form-control-static{height:46px;min-height:38px;padding:10px 16px;font-size:18px;line-height:1.3333333}.has-feedback{position:relative}.has-feedback .form-control{padding-right:42.5px}.form-control-feedback{position:absolute;top:0;right:0;z-index:2;display:block;width:34px;height:34px;line-height:34px;text-align:center;pointer-events:none}.input-lg+.form-control-feedback{width:46px;height:46px;line-height:46px}.input-sm+.form-control-feedback{width:30px;height:30px;line-height:30px}.has-success .checkbox,.has-success .checkbox-inline,.has-success .control-label,.has-success .help-block,.has-success .radio,.has-success .radio-inline,.has-success.checkbox label,.has-success.checkbox-inline label,.has-success.radio label,.has-success.radio-inline label{color:#3c763d}.has-success .form-control{border-color:#3c763d;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}.has-success .form-control:focus{border-color:#2b542c;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #67b168;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #67b168}.has-success .input-group-addon{color:#3c763d;background-color:#dff0d8;border-color:#3c763d}.has-success .form-control-feedback{color:#3c763d}.has-warning .checkbox,.has-warning .checkbox-inline,.has-warning .control-label,.has-warning .help-block,.has-warning .radio,.has-warning .radio-inline,.has-warning.checkbox label,.has-warning.checkbox-inline label,.has-warning.radio label,.has-warning.radio-inline label{color:#8a6d3b}.has-warning .form-control{border-color:#8a6d3b;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}.has-warning .form-control:focus{border-color:#66512c;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #c0a16b;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #c0a16b}.has-warning .input-group-addon{color:#8a6d3b;background-color:#fcf8e3;border-color:#8a6d3b}.has-warning .form-control-feedback{color:#8a6d3b}.has-error .checkbox,.has-error .checkbox-inline,.has-error .control-label,.has-error .help-block,.has-error .radio,.has-error .radio-inline,.has-error.checkbox label,.has-error.checkbox-inline label,.has-error.radio label,.has-error.radio-inline label{color:#a94442}.has-error .form-control{border-color:#a94442;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075);box-shadow:inset 0 1px 1px rgba(0,0,0,.075)}.has-error .form-control:focus{border-color:#843534;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #ce8483;box-shadow:inset 0 1px 1px rgba(0,0,0,.075),0 0 6px #ce8483}.has-error .input-group-addon{color:#a94442;background-color:#f2dede;border-color:#a94442}.has-error .form-control-feedback{color:#a94442}.has-feedback label~.form-control-feedback{top:25px}.has-feedback label.sr-only~.form-control-feedback{top:0}.help-block{display:block;margin-top:5px;margin-bottom:10px;color:#737373}@media (min-width:768px){.form-inline .form-group{display:inline-block;margin-bottom:0;vertical-align:middle}.form-inline .form-control{display:inline-block;width:auto;vertical-align:middle}.form-inline .form-control-static{display:inline-block}.form-inline .input-group{display:inline-table;vertical-align:middle}.form-inline .input-group .form-control,.form-inline .input-group .input-group-addon,.form-inline .input-group .input-group-btn{width:auto}.form-inline .input-group>.form-control{width:100%}.form-inline .control-label{margin-bottom:0;vertical-align:middle}.form-inline .checkbox,.form-inline .radio{display:inline-block;margin-top:0;margin-bottom:0;vertical-align:middle}.form-inline .checkbox label,.form-inline .radio label{padding-left:0}.form-inline .checkbox input[type=checkbox],.form-inline .radio input[type=radio]{position:relative;margin-left:0}.form-inline .has-feedback .form-control-feedback{top:0}}.form-horizontal .checkbox,.form-horizontal .checkbox-inline,.form-horizontal .radio,.form-horizontal .radio-inline{padding-top:7px;margin-top:0;margin-bottom:0}.form-horizontal .checkbox,.form-horizontal .radio{min-height:27px}.form-horizontal .form-group{margin-right:-15px;margin-left:-15px}@media (min-width:768px){.form-horizontal .control-label{padding-top:7px;margin-bottom:0;text-align:right}}.form-horizontal .has-feedback .form-control-feedback{right:15px}@media (min-width:768px){.form-horizontal .form-group-lg .control-label{padding-top:14.33px}}@media (min-width:768px){.form-horizontal .form-group-sm .control-label{padding-top:6px}}.btn{display:inline-block;padding:6px 12px;margin-bottom:0;font-size:14px;font-weight:400;line-height:1.42857143;text-align:center;white-space:nowrap;vertical-align:middle;-ms-touch-action:manipulation;touch-action:manipulation;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;background-image:none;border:1px solid transparent;border-radius:4px}.btn.active.focus,.btn.active:focus,.btn.focus,.btn:active.focus,.btn:active:focus,.btn:focus{outline:thin dotted;outline:5px auto -webkit-focus-ring-color;outline-offset:-2px}.btn.focus,.btn:focus,.btn:hover{color:#333;text-decoration:none}.btn.active,.btn:active{background-image:none;outline:0;-webkit-box-shadow:inset 0 3px 5px rgba(0,0,0,.125);box-shadow:inset 0 3px 5px rgba(0,0,0,.125)}.btn.disabled,.btn[disabled],fieldset[disabled] .btn{pointer-events:none;cursor:not-allowed;filter:alpha(opacity=65);-webkit-box-shadow:none;box-shadow:none;opacity:.65}.btn-default{color:#333;background-color:#fff;border-color:#ccc}.btn-default.active,.btn-default.focus,.btn-default:active,.btn-default:focus,.btn-default:hover,.open>.dropdown-toggle.btn-default{color:#333;background-color:#e6e6e6;border-color:#adadad}.btn-default.active,.btn-default:active,.open>.dropdown-toggle.btn-default{background-image:none}.btn-default.disabled,.btn-default.disabled.active,.btn-default.disabled.focus,.btn-default.disabled:active,.btn-default.disabled:focus,.btn-default.disabled:hover,.btn-default[disabled],.btn-default[disabled].active,.btn-default[disabled].focus,.btn-default[disabled]:active,.btn-default[disabled]:focus,.btn-default[disabled]:hover,fieldset[disabled] .btn-default,fieldset[disabled] .btn-default.active,fieldset[disabled] .btn-default.focus,fieldset[disabled] .btn-default:active,fieldset[disabled] .btn-default:focus,fieldset[disabled] .btn-default:hover{background-color:#fff;border-color:#ccc}.btn-default .badge{color:#fff;background-color:#333}.btn-primary{color:#fff;background-color:#337ab7;border-color:#2e6da4}.btn-primary.active,.btn-primary.focus,.btn-primary:active,.btn-primary:focus,.btn-primary:hover,.open>.dropdown-toggle.btn-primary{color:#fff;background-color:#286090;border-color:#204d74}.btn-primary.active,.btn-primary:active,.open>.dropdown-toggle.btn-primary{background-image:none}.btn-primary.disabled,.btn-primary.disabled.active,.btn-primary.disabled.focus,.btn-primary.disabled:active,.btn-primary.disabled:focus,.btn-primary.disabled:hover,.btn-primary[disabled],.btn-primary[disabled].active,.btn-primary[disabled].focus,.btn-primary[disabled]:active,.btn-primary[disabled]:focus,.btn-primary[disabled]:hover,fieldset[disabled] .btn-primary,fieldset[disabled] .btn-primary.active,fieldset[disabled] .btn-primary.focus,fieldset[disabled] .btn-primary:active,fieldset[disabled] .btn-primary:focus,fieldset[disabled] .btn-primary:hover{background-color:#337ab7;border-color:#2e6da4}.btn-primary .badge{color:#337ab7;background-color:#fff}.btn-success{color:#fff;background-color:#5cb85c;border-color:#4cae4c}.btn-success.active,.btn-success.focus,.btn-success:active,.btn-success:focus,.btn-success:hover,.open>.dropdown-toggle.btn-success{color:#fff;background-color:#449d44;border-color:#398439}.btn-success.active,.btn-success:active,.open>.dropdown-toggle.btn-success{background-image:none}.btn-success.disabled,.btn-success.disabled.active,.btn-success.disabled.focus,.btn-success.disabled:active,.btn-success.disabled:focus,.btn-success.disabled:hover,.btn-success[disabled],.btn-success[disabled].active,.btn-success[disabled].focus,.btn-success[disabled]:active,.btn-success[disabled]:focus,.btn-success[disabled]:hover,fieldset[disabled] .btn-success,fieldset[disabled] .btn-success.active,fieldset[disabled] .btn-success.focus,fieldset[disabled] .btn-success:active,fieldset[disabled] .btn-success:focus,fieldset[disabled] .btn-success:hover{background-color:#5cb85c;border-color:#4cae4c}.btn-success .badge{color:#5cb85c;background-color:#fff}.btn-info{color:#fff;background-color:#5bc0de;border-color:#46b8da}.btn-info.active,.btn-info.focus,.btn-info:active,.btn-info:focus,.btn-info:hover,.open>.dropdown-toggle.btn-info{color:#fff;background-color:#31b0d5;border-color:#269abc}.btn-info.active,.btn-info:active,.open>.dropdown-toggle.btn-info{background-image:none}.btn-info.disabled,.btn-info.disabled.active,.btn-info.disabled.focus,.btn-info.disabled:active,.btn-info.disabled:focus,.btn-info.disabled:hover,.btn-info[disabled],.btn-info[disabled].active,.btn-info[disabled].focus,.btn-info[disabled]:active,.btn-info[disabled]:focus,.btn-info[disabled]:hover,fieldset[disabled] .btn-info,fieldset[disabled] .btn-info.active,fieldset[disabled] .btn-info.focus,fieldset[disabled] .btn-info:active,fieldset[disabled] .btn-info:focus,fieldset[disabled] .btn-info:hover{background-color:#5bc0de;border-color:#46b8da}.btn-info .badge{color:#5bc0de;background-color:#fff}.btn-warning{color:#fff;background-color:#f0ad4e;border-color:#eea236}.btn-warning.active,.btn-warning.focus,.btn-warning:active,.btn-warning:focus,.btn-warning:hover,.open>.dropdown-toggle.btn-warning{color:#fff;background-color:#ec971f;border-color:#d58512}.btn-warning.active,.btn-warning:active,.open>.dropdown-toggle.btn-warning{background-image:none}.btn-warning.disabled,.btn-warning.disabled.active,.btn-warning.disabled.focus,.btn-warning.disabled:active,.btn-warning.disabled:focus,.btn-warning.disabled:hover,.btn-warning[disabled],.btn-warning[disabled].active,.btn-warning[disabled].focus,.btn-warning[disabled]:active,.btn-warning[disabled]:focus,.btn-warning[disabled]:hover,fieldset[disabled] .btn-warning,fieldset[disabled] .btn-warning.active,fieldset[disabled] .btn-warning.focus,fieldset[disabled] .btn-warning:active,fieldset[disabled] .btn-warning:focus,fieldset[disabled] .btn-warning:hover{background-color:#f0ad4e;border-color:#eea236}.btn-warning .badge{color:#f0ad4e;background-color:#fff}.btn-danger{color:#fff;background-color:#d9534f;border-color:#d43f3a}.btn-danger.active,.btn-danger.focus,.btn-danger:active,.btn-danger:focus,.btn-danger:hover,.open>.dropdown-toggle.btn-danger{color:#fff;background-color:#c9302c;border-color:#ac2925}.btn-danger.active,.btn-danger:active,.open>.dropdown-toggle.btn-danger{background-image:none}.btn-danger.disabled,.btn-danger.disabled.active,.btn-danger.disabled.focus,.btn-danger.disabled:active,.btn-danger.disabled:focus,.btn-danger.disabled:hover,.btn-danger[disabled],.btn-danger[disabled].active,.btn-danger[disabled].focus,.btn-danger[disabled]:active,.btn-danger[disabled]:focus,.btn-danger[disabled]:hover,fieldset[disabled] .btn-danger,fieldset[disabled] .btn-danger.active,fieldset[disabled] .btn-danger.focus,fieldset[disabled] .btn-danger:active,fieldset[disabled] .btn-danger:focus,fieldset[disabled] .btn-danger:hover{background-color:#d9534f;border-color:#d43f3a}.btn-danger .badge{color:#d9534f;background-color:#fff}.btn-link{font-weight:400;color:#337ab7;border-radius:0}.btn-link,.btn-link.active,.btn-link:active,.btn-link[disabled],fieldset[disabled] .btn-link{background-color:transparent;-webkit-box-shadow:none;box-shadow:none}.btn-link,.btn-link:active,.btn-link:focus,.btn-link:hover{border-color:transparent}.btn-link:focus,.btn-link:hover{color:#23527c;text-decoration:underline;background-color:transparent}.btn-link[disabled]:focus,.btn-link[disabled]:hover,fieldset[disabled] .btn-link:focus,fieldset[disabled] .btn-link:hover{color:#777;text-decoration:none}.btn-group-lg>.btn,.btn-lg{padding:10px 16px;font-size:18px;line-height:1.3333333;border-radius:6px}.btn-group-sm>.btn,.btn-sm{padding:5px 10px;font-size:12px;line-height:1.5;border-radius:3px}.btn-group-xs>.btn,.btn-xs{padding:1px 5px;font-size:12px;line-height:1.5;border-radius:3px}.btn-block{display:block;width:100%}.btn-block+.btn-block{margin-top:5px}input[type=button].btn-block,input[type=reset].btn-block,input[type=submit].btn-block{width:100%}.fade{opacity:0;-webkit-transition:opacity .15s linear;-o-transition:opacity .15s linear;transition:opacity .15s linear}.fade.in{opacity:1}.collapse{display:none}.collapse.in{display:block}tr.collapse.in{display:table-row}tbody.collapse.in{display:table-row-group}.collapsing{position:relative;height:0;overflow:hidden;-webkit-transition-timing-function:ease;-o-transition-timing-function:ease;transition-timing-function:ease;-webkit-transition-duration:.35s;-o-transition-duration:.35s;transition-duration:.35s;-webkit-transition-property:height,visibility;-o-transition-property:height,visibility;transition-property:height,visibility}.caret{display:inline-block;width:0;height:0;margin-left:2px;vertical-align:middle;border-top:4px dashed;border-right:4px solid transparent;border-left:4px solid transparent}.dropdown,.dropup{position:relative}.dropdown-toggle:focus{outline:0}.dropdown-menu{position:absolute;top:100%;left:0;z-index:1000;display:none;float:left;min-width:160px;padding:5px 0;margin:2px 0 0;font-size:14px;text-align:left;list-style:none;background-color:#fff;-webkit-background-clip:padding-box;background-clip:padding-box;border:1px solid #ccc;border:1px solid rgba(0,0,0,.15);border-radius:4px;-webkit-box-shadow:0 6px 12px rgba(0,0,0,.175);box-shadow:0 6px 12px rgba(0,0,0,.175)}.dropdown-menu.pull-right{right:0;left:auto}.dropdown-menu .divider{height:1px;margin:9px 0;overflow:hidden;background-color:#e5e5e5}.dropdown-menu>li>a{display:block;padding:3px 20px;clear:both;font-weight:400;line-height:1.42857143;color:#333;white-space:nowrap}.dropdown-menu>li>a:focus,.dropdown-menu>li>a:hover{color:#262626;text-decoration:none;background-color:#f5f5f5}.dropdown-menu>.active>a,.dropdown-menu>.active>a:focus,.dropdown-menu>.active>a:hover{color:#fff;text-decoration:none;background-color:#337ab7;outline:0}.dropdown-menu>.disabled>a,.dropdown-menu>.disabled>a:focus,.dropdown-menu>.disabled>a:hover{color:#777}.dropdown-menu>.disabled>a:focus,.dropdown-menu>.disabled>a:hover{text-decoration:none;cursor:not-allowed;background-color:transparent;background-image:none;filter:progid:DXImageTransform.Microsoft.gradient(enabled=false)}.open>.dropdown-menu{display:block}.open>a{outline:0}.dropdown-menu-right{right:0;left:auto}.dropdown-menu-left{right:auto;left:0}.dropdown-header{display:block;padding:3px 20px;font-size:12px;line-height:1.42857143;color:#777;white-space:nowrap}.dropdown-backdrop{position:fixed;top:0;right:0;bottom:0;left:0;z-index:990}.pull-right>.dropdown-menu{right:0;left:auto}.dropup .caret,.navbar-fixed-bottom .dropdown .caret{content:"";border-top:0;border-bottom:4px solid}.dropup .dropdown-menu,.navbar-fixed-bottom .dropdown .dropdown-menu{top:auto;bottom:100%;margin-bottom:2px}@media (min-width:768px){.navbar-right .dropdown-menu{right:0;left:auto}.navbar-right .dropdown-menu-left{right:auto;left:0}}.btn-group,.btn-group-vertical{position:relative;display:inline-block;vertical-align:middle}.btn-group-vertical>.btn,.btn-group>.btn{position:relative;float:left}.btn-group-vertical>.btn.active,.btn-group-vertical>.btn:active,.btn-group-vertical>.btn:focus,.btn-group-vertical>.btn:hover,.btn-group>.btn.active,.btn-group>.btn:active,.btn-group>.btn:focus,.btn-group>.btn:hover{z-index:2}.btn-group .btn+.btn,.btn-group .btn+.btn-group,.btn-group .btn-group+.btn,.btn-group .btn-group+.btn-group{margin-left:-1px}.btn-toolbar{margin-left:-5px}.btn-toolbar .btn-group,.btn-toolbar .input-group{float:left}.btn-toolbar>.btn,.btn-toolbar>.btn-group,.btn-toolbar>.input-group{margin-left:5px}.btn-group>.btn:not(:first-child):not(:last-child):not(.dropdown-toggle){border-radius:0}.btn-group>.btn:first-child{margin-left:0}.btn-group>.btn:first-child:not(:last-child):not(.dropdown-toggle){border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn:last-child:not(:first-child),.btn-group>.dropdown-toggle:not(:first-child){border-top-left-radius:0;border-bottom-left-radius:0}.btn-group>.btn-group{float:left}.btn-group>.btn-group:not(:first-child):not(:last-child)>.btn{border-radius:0}.btn-group>.btn-group:first-child:not(:last-child)>.btn:last-child,.btn-group>.btn-group:first-child:not(:last-child)>.dropdown-toggle{border-top-right-radius:0;border-bottom-right-radius:0}.btn-group>.btn-group:last-child:not(:first-child)>.btn:first-child{border-top-left-radius:0;border-bottom-left-radius:0}.btn-group .dropdown-toggle:active,.btn-group.open .dropdown-toggle{outline:0}.btn-group>.btn+.dropdown-toggle{padding-right:8px;padding-left:8px}.btn-group>.btn-lg+.dropdown-toggle{padding-right:12px;padding-left:12px}.btn-group.open .dropdown-toggle{-webkit-box-shadow:inset 0 3px 5px rgba(0,0,0,.125);box-shadow:inset 0 3px 5px rgba(0,0,0,.125)}.btn-group.open .dropdown-toggle.btn-link{-webkit-box-shadow:none;box-shadow:none}.btn .caret{margin-left:0}.btn-lg .caret{border-width:5px 5px 0;border-bottom-width:0}.dropup .btn-lg .caret{border-width:0 5px 5px}.btn-group-vertical>.btn,.btn-group-vertical>.btn-group,.btn-group-vertical>.btn-group>.btn{display:block;float:none;width:100%;max-width:100%}.btn-group-vertical>.btn-group>.btn{float:none}.btn-group-vertical>.btn+.btn,.btn-group-vertical>.btn+.btn-group,.btn-group-vertical>.btn-group+.btn,.btn-group-vertical>.btn-group+.btn-group{margin-top:-1px;margin-left:0}.btn-group-vertical>.btn:not(:first-child):not(:last-child){border-radius:0}.btn-group-vertical>.btn:first-child:not(:last-child){border-top-right-radius:4px;border-bottom-right-radius:0;border-bottom-left-radius:0}.btn-group-vertical>.btn:last-child:not(:first-child){border-top-left-radius:0;border-top-right-radius:0;border-bottom-left-radius:4px}.btn-group-vertical>.btn-group:not(:first-child):not(:last-child)>.btn{border-radius:0}.btn-group-vertical>.btn-group:first-child:not(:last-child)>.btn:last-child,.btn-group-vertical>.btn-group:first-child:not(:last-child)>.dropdown-toggle{border-bottom-right-radius:0;border-bottom-left-radius:0}.btn-group-vertical>.btn-group:last-child:not(:first-child)>.btn:first-child{border-top-left-radius:0;border-top-right-radius:0}.btn-group-justified{display:table;width:100%;table-layout:fixed;border-collapse:separate}.btn-group-justified>.btn,.btn-group-justified>.btn-group{display:table-cell;float:none;width:1%}.btn-group-justified>.btn-group .btn{width:100%}.btn-group-justified>.btn-group .dropdown-menu{left:auto}[data-toggle=buttons]>.btn input[type=checkbox],[data-toggle=buttons]>.btn input[type=radio],[data-toggle=buttons]>.btn-group>.btn input[type=checkbox],[data-toggle=buttons]>.btn-group>.btn input[type=radio]{position:absolute;clip:rect(0,0,0,0);pointer-events:none}.input-group{position:relative;display:table;border-collapse:separate}.input-group[class*=col-]{float:none;padding-right:0;padding-left:0}.input-group .form-control{position:relative;z-index:2;float:left;width:100%;margin-bottom:0}.input-group-lg>.form-control,.input-group-lg>.input-group-addon,.input-group-lg>.input-group-btn>.btn{height:46px;padding:10px 16px;font-size:18px;line-height:1.3333333;border-radius:6px}select.input-group-lg>.form-control,select.input-group-lg>.input-group-addon,select.input-group-lg>.input-group-btn>.btn{height:46px;line-height:46px}select[multiple].input-group-lg>.form-control,select[multiple].input-group-lg>.input-group-addon,select[multiple].input-group-lg>.input-group-btn>.btn,textarea.input-group-lg>.form-control,textarea.input-group-lg>.input-group-addon,textarea.input-group-lg>.input-group-btn>.btn{height:auto}.input-group-sm>.form-control,.input-group-sm>.input-group-addon,.input-group-sm>.input-group-btn>.btn{height:30px;padding:5px 10px;font-size:12px;line-height:1.5;border-radius:3px}select.input-group-sm>.form-control,select.input-group-sm>.input-group-addon,select.input-group-sm>.input-group-btn>.btn{height:30px;line-height:30px}select[multiple].input-group-sm>.form-control,select[multiple].input-group-sm>.input-group-addon,select[multiple].input-group-sm>.input-group-btn>.btn,textarea.input-group-sm>.form-control,textarea.input-group-sm>.input-group-addon,textarea.input-group-sm>.input-group-btn>.btn{height:auto}.input-group .form-control,.input-group-addon,.input-group-btn{display:table-cell}.input-group .form-control:not(:first-child):not(:last-child),.input-group-addon:not(:first-child):not(:last-child),.input-group-btn:not(:first-child):not(:last-child){border-radius:0}.input-group-addon,.input-group-btn{width:1%;white-space:nowrap;vertical-align:middle}.input-group-addon{padding:6px 12px;font-size:14px;font-weight:400;line-height:1;color:#555;text-align:center;background-color:#eee;border:1px solid #ccc;border-radius:4px}.input-group-addon.input-sm{padding:5px 10px;font-size:12px;border-radius:3px}.input-group-addon.input-lg{padding:10px 16px;font-size:18px;border-radius:6px}.input-group-addon input[type=checkbox],.input-group-addon input[type=radio]{margin-top:0}.input-group .form-control:first-child,.input-group-addon:first-child,.input-group-btn:first-child>.btn,.input-group-btn:first-child>.btn-group>.btn,.input-group-btn:first-child>.dropdown-toggle,.input-group-btn:last-child>.btn-group:not(:last-child)>.btn,.input-group-btn:last-child>.btn:not(:last-child):not(.dropdown-toggle){border-top-right-radius:0;border-bottom-right-radius:0}.input-group-addon:first-child{border-right:0}.input-group .form-control:last-child,.input-group-addon:last-child,.input-group-btn:first-child>.btn-group:not(:first-child)>.btn,.input-group-btn:first-child>.btn:not(:first-child),.input-group-btn:last-child>.btn,.input-group-btn:last-child>.btn-group>.btn,.input-group-btn:last-child>.dropdown-toggle{border-top-left-radius:0;border-bottom-left-radius:0}.input-group-addon:last-child{border-left:0}.input-group-btn{position:relative;font-size:0;white-space:nowrap}.input-group-btn>.btn{position:relative}.input-group-btn>.btn+.btn{margin-left:-1px}.input-group-btn>.btn:active,.input-group-btn>.btn:focus,.input-group-btn>.btn:hover{z-index:2}.input-group-btn:first-child>.btn,.input-group-btn:first-child>.btn-group{margin-right:-1px}.input-group-btn:last-child>.btn,.input-group-btn:last-child>.btn-group{margin-left:-1px}.nav{padding-left:0;margin-bottom:0;list-style:none}.nav>li{position:relative;display:block}.nav>li>a{position:relative;display:block;padding:10px 15px}.nav>li>a:focus,.nav>li>a:hover{text-decoration:none;background-color:#eee}.nav>li.disabled>a{color:#777}.nav>li.disabled>a:focus,.nav>li.disabled>a:hover{color:#777;text-decoration:none;cursor:not-allowed;background-color:transparent}.nav .open>a,.nav .open>a:focus,.nav .open>a:hover{background-color:#eee;border-color:#337ab7}.nav .nav-divider{height:1px;margin:9px 0;overflow:hidden;background-color:#e5e5e5}.nav>li>a>img{max-width:none}.nav-tabs{border-bottom:1px solid #ddd}.nav-tabs>li{float:left;margin-bottom:-1px}.nav-tabs>li>a{margin-right:2px;line-height:1.42857143;border:1px solid transparent;border-radius:4px 4px 0 0}.nav-tabs>li>a:hover{border-color:#eee #eee #ddd}.nav-tabs>li.active>a,.nav-tabs>li.active>a:focus,.nav-tabs>li.active>a:hover{color:#555;cursor:default;background-color:#fff;border:1px solid #ddd;border-bottom-color:transparent}.nav-tabs.nav-justified{width:100%;border-bottom:0}.nav-tabs.nav-justified>li{float:none}.nav-tabs.nav-justified>li>a{margin-bottom:5px;text-align:center}.nav-tabs.nav-justified>.dropdown .dropdown-menu{top:auto;left:auto}@media (min-width:768px){.nav-tabs.nav-justified>li{display:table-cell;width:1%}.nav-tabs.nav-justified>li>a{margin-bottom:0}}.nav-tabs.nav-justified>li>a{margin-right:0;border-radius:4px}.nav-tabs.nav-justified>.active>a,.nav-tabs.nav-justified>.active>a:focus,.nav-tabs.nav-justified>.active>a:hover{border:1px solid #ddd}@media (min-width:768px){.nav-tabs.nav-justified>li>a{border-bottom:1px solid #ddd;border-radius:4px 4px 0 0}.nav-tabs.nav-justified>.active>a,.nav-tabs.nav-justified>.active>a:focus,.nav-tabs.nav-justified>.active>a:hover{border-bottom-color:#fff}}.nav-pills>li{float:left}.nav-pills>li>a{border-radius:4px}.nav-pills>li+li{margin-left:2px}.nav-pills>li.active>a,.nav-pills>li.active>a:focus,.nav-pills>li.active>a:hover{color:#fff;background-color:#337ab7}.nav-stacked>li{float:none}.nav-stacked>li+li{margin-top:2px;margin-left:0}.nav-justified{width:100%}.nav-justified>li{float:none}.nav-justified>li>a{margin-bottom:5px;text-align:center}.nav-justified>.dropdown .dropdown-menu{top:auto;left:auto}@media (min-width:768px){.nav-justified>li{display:table-cell;width:1%}.nav-justified>li>a{margin-bottom:0}}.nav-tabs-justified{border-bottom:0}.nav-tabs-justified>li>a{margin-right:0;border-radius:4px}.nav-tabs-justified>.active>a,.nav-tabs-justified>.active>a:focus,.nav-tabs-justified>.active>a:hover{border:1px solid #ddd}@media (min-width:768px){.nav-tabs-justified>li>a{border-bottom:1px solid #ddd;border-radius:4px 4px 0 0}.nav-tabs-justified>.active>a,.nav-tabs-justified>.active>a:focus,.nav-tabs-justified>.active>a:hover{border-bottom-color:#fff}}.tab-content>.tab-pane{display:none}.tab-content>.active{display:block}.nav-tabs .dropdown-menu{margin-top:-1px;border-top-left-radius:0;border-top-right-radius:0}.navbar{position:relative;min-height:50px;margin-bottom:20px;border:1px solid transparent}@media (min-width:768px){.navbar{border-radius:4px}}@media (min-width:768px){.navbar-header{float:left}}.navbar-collapse{padding-right:15px;padding-left:15px;overflow-x:visible;-webkit-overflow-scrolling:touch;border-top:1px solid transparent;-webkit-box-shadow:inset 0 1px 0 rgba(255,255,255,.1);box-shadow:inset 0 1px 0 rgba(255,255,255,.1)}.navbar-collapse.in{overflow-y:auto}@media (min-width:768px){.navbar-collapse{width:auto;border-top:0;-webkit-box-shadow:none;box-shadow:none}.navbar-collapse.collapse{display:block!important;height:auto!important;padding-bottom:0;overflow:visible!important}.navbar-collapse.in{overflow-y:visible}.navbar-fixed-bottom .navbar-collapse,.navbar-fixed-top .navbar-collapse,.navbar-static-top .navbar-collapse{padding-right:0;padding-left:0}}.navbar-fixed-bottom .navbar-collapse,.navbar-fixed-top .navbar-collapse{max-height:340px}@media (max-device-width:480px)and (orientation:landscape){.navbar-fixed-bottom .navbar-collapse,.navbar-fixed-top .navbar-collapse{max-height:200px}}.container-fluid>.navbar-collapse,.container-fluid>.navbar-header,.container>.navbar-collapse,.container>.navbar-header{margin-right:-15px;margin-left:-15px}@media (min-width:768px){.container-fluid>.navbar-collapse,.container-fluid>.navbar-header,.container>.navbar-collapse,.container>.navbar-header{margin-right:0;margin-left:0}}.navbar-static-top{z-index:1000;border-width:0 0 1px}@media (min-width:768px){.navbar-static-top{border-radius:0}}.navbar-fixed-bottom,.navbar-fixed-top{position:fixed;right:0;left:0;z-index:1030}@media (min-width:768px){.navbar-fixed-bottom,.navbar-fixed-top{border-radius:0}}.navbar-fixed-top{top:0;border-width:0 0 1px}.navbar-fixed-bottom{bottom:0;margin-bottom:0;border-width:1px 0 0}.navbar-brand{float:left;height:50px;padding:15px 15px;font-size:18px;line-height:20px}.navbar-brand:focus,.navbar-brand:hover{text-decoration:none}.navbar-brand>img{display:block}@media (min-width:768px){.navbar>.container .navbar-brand,.navbar>.container-fluid .navbar-brand{margin-left:-15px}}.navbar-toggle{position:relative;float:right;padding:9px 10px;margin-top:8px;margin-right:15px;margin-bottom:8px;background-color:transparent;background-image:none;border:1px solid transparent;border-radius:4px}.navbar-toggle:focus{outline:0}.navbar-toggle .icon-bar{display:block;width:22px;height:2px;border-radius:1px}.navbar-toggle .icon-bar+.icon-bar{margin-top:4px}@media (min-width:768px){.navbar-toggle{display:none}}.navbar-nav{margin:7.5px -15px}.navbar-nav>li>a{padding-top:10px;padding-bottom:10px;line-height:20px}@media (max-width:767px){.navbar-nav .open .dropdown-menu{position:static;float:none;width:auto;margin-top:0;background-color:transparent;border:0;-webkit-box-shadow:none;box-shadow:none}.navbar-nav .open .dropdown-menu .dropdown-header,.navbar-nav .open .dropdown-menu>li>a{padding:5px 15px 5px 25px}.navbar-nav .open .dropdown-menu>li>a{line-height:20px}.navbar-nav .open .dropdown-menu>li>a:focus,.navbar-nav .open .dropdown-menu>li>a:hover{background-image:none}}@media (min-width:768px){.navbar-nav{float:left;margin:0}.navbar-nav>li{float:left}.navbar-nav>li>a{padding-top:15px;padding-bottom:15px}}.navbar-form{padding:10px 15px;margin-top:8px;margin-right:-15px;margin-bottom:8px;margin-left:-15px;border-top:1px solid transparent;border-bottom:1px solid transparent;-webkit-box-shadow:inset 0 1px 0 rgba(255,255,255,.1),0 1px 0 rgba(255,255,255,.1);box-shadow:inset 0 1px 0 rgba(255,255,255,.1),0 1px 0 rgba(255,255,255,.1)}@media (min-width:768px){.navbar-form .form-group{display:inline-block;margin-bottom:0;vertical-align:middle}.navbar-form .form-control{display:inline-block;width:auto;vertical-align:middle}.navbar-form .form-control-static{display:inline-block}.navbar-form .input-group{display:inline-table;vertical-align:middle}.navbar-form .input-group .form-control,.navbar-form .input-group .input-group-addon,.navbar-form .input-group .input-group-btn{width:auto}.navbar-form .input-group>.form-control{width:100%}.navbar-form .control-label{margin-bottom:0;vertical-align:middle}.navbar-form .checkbox,.navbar-form .radio{display:inline-block;margin-top:0;margin-bottom:0;vertical-align:middle}.navbar-form .checkbox label,.navbar-form .radio label{padding-left:0}.navbar-form .checkbox input[type=checkbox],.navbar-form .radio input[type=radio]{position:relative;margin-left:0}.navbar-form .has-feedback .form-control-feedback{top:0}}@media (max-width:767px){.navbar-form .form-group{margin-bottom:5px}.navbar-form .form-group:last-child{margin-bottom:0}}@media (min-width:768px){.navbar-form{width:auto;padding-top:0;padding-bottom:0;margin-right:0;margin-left:0;border:0;-webkit-box-shadow:none;box-shadow:none}}.navbar-nav>li>.dropdown-menu{margin-top:0;border-top-left-radius:0;border-top-right-radius:0}.navbar-fixed-bottom .navbar-nav>li>.dropdown-menu{margin-bottom:0;border-top-left-radius:4px;border-top-right-radius:4px;border-bottom-right-radius:0;border-bottom-left-radius:0}.navbar-btn{margin-top:8px;margin-bottom:8px}.navbar-btn.btn-sm{margin-top:10px;margin-bottom:10px}.navbar-btn.btn-xs{margin-top:14px;margin-bottom:14px}.navbar-text{margin-top:15px;margin-bottom:15px}@media (min-width:768px){.navbar-text{float:left;margin-right:15px;margin-left:15px}}@media (min-width:768px){.navbar-left{float:left!important}.navbar-right{float:right!important;margin-right:-15px}.navbar-right~.navbar-right{margin-right:0}}.navbar-default{background-color:#f8f8f8;border-color:#e7e7e7}.navbar-default .navbar-brand{color:#777}.navbar-default .navbar-brand:focus,.navbar-default .navbar-brand:hover{color:#5e5e5e;background-color:transparent}.navbar-default .navbar-text{color:#777}.navbar-default .navbar-nav>li>a{color:#777}.navbar-default .navbar-nav>li>a:focus,.navbar-default .navbar-nav>li>a:hover{color:#333;background-color:transparent}.navbar-default .navbar-nav>.active>a,.navbar-default .navbar-nav>.active>a:focus,.navbar-default .navbar-nav>.active>a:hover{color:#555;background-color:#e7e7e7}.navbar-default .navbar-nav>.disabled>a,.navbar-default .navbar-nav>.disabled>a:focus,.navbar-default .navbar-nav>.disabled>a:hover{color:#ccc;background-color:transparent}.navbar-default .navbar-toggle{border-color:#ddd}.navbar-default .navbar-toggle:focus,.navbar-default .navbar-toggle:hover{background-color:#ddd}.navbar-default .navbar-toggle .icon-bar{background-color:#888}.navbar-default .navbar-collapse,.navbar-default .navbar-form{border-color:#e7e7e7}.navbar-default .navbar-nav>.open>a,.navbar-default .navbar-nav>.open>a:focus,.navbar-default .navbar-nav>.open>a:hover{color:#555;background-color:#e7e7e7}@media (max-width:767px){.navbar-default .navbar-nav .open .dropdown-menu>li>a{color:#777}.navbar-default .navbar-nav .open .dropdown-menu>li>a:focus,.navbar-default .navbar-nav .open .dropdown-menu>li>a:hover{color:#333;background-color:transparent}.navbar-default .navbar-nav .open .dropdown-menu>.active>a,.navbar-default .navbar-nav .open .dropdown-menu>.active>a:focus,.navbar-default .navbar-nav .open .dropdown-menu>.active>a:hover{color:#555;background-color:#e7e7e7}.navbar-default .navbar-nav .open .dropdown-menu>.disabled>a,.navbar-default .navbar-nav .open .dropdown-menu>.disabled>a:focus,.navbar-default .navbar-nav .open .dropdown-menu>.disabled>a:hover{color:#ccc;background-color:transparent}}.navbar-default .navbar-link{color:#777}.navbar-default .navbar-link:hover{color:#333}.navbar-default .btn-link{color:#777}.navbar-default .btn-link:focus,.navbar-default .btn-link:hover{color:#333}.navbar-default .btn-link[disabled]:focus,.navbar-default .btn-link[disabled]:hover,fieldset[disabled] .navbar-default .btn-link:focus,fieldset[disabled] .navbar-default .btn-link:hover{color:#ccc}.navbar-inverse{background-color:#222;border-color:#080808}.navbar-inverse .navbar-brand{color:#9d9d9d}.navbar-inverse .navbar-brand:focus,.navbar-inverse .navbar-brand:hover{color:#fff;background-color:transparent}.navbar-inverse .navbar-text{color:#9d9d9d}.navbar-inverse .navbar-nav>li>a{color:#9d9d9d}.navbar-inverse .navbar-nav>li>a:focus,.navbar-inverse .navbar-nav>li>a:hover{color:#fff;background-color:transparent}.navbar-inverse .navbar-nav>.active>a,.navbar-inverse .navbar-nav>.active>a:focus,.navbar-inverse .navbar-nav>.active>a:hover{color:#fff;background-color:#080808}.navbar-inverse .navbar-nav>.disabled>a,.navbar-inverse .navbar-nav>.disabled>a:focus,.navbar-inverse .navbar-nav>.disabled>a:hover{color:#444;background-color:transparent}.navbar-inverse .navbar-toggle{border-color:#333}.navbar-inverse .navbar-toggle:focus,.navbar-inverse .navbar-toggle:hover{background-color:#333}.navbar-inverse .navbar-toggle .icon-bar{background-color:#fff}.navbar-inverse .navbar-collapse,.navbar-inverse .navbar-form{border-color:#101010}.navbar-inverse .navbar-nav>.open>a,.navbar-inverse .navbar-nav>.open>a:focus,.navbar-inverse .navbar-nav>.open>a:hover{color:#fff;background-color:#080808}@media (max-width:767px){.navbar-inverse .navbar-nav .open .dropdown-menu>.dropdown-header{border-color:#080808}.navbar-inverse .navbar-nav .open .dropdown-menu .divider{background-color:#080808}.navbar-inverse .navbar-nav .open .dropdown-menu>li>a{color:#9d9d9d}.navbar-inverse .navbar-nav .open .dropdown-menu>li>a:focus,.navbar-inverse .navbar-nav .open .dropdown-menu>li>a:hover{color:#fff;background-color:transparent}.navbar-inverse .navbar-nav .open .dropdown-menu>.active>a,.navbar-inverse .navbar-nav .open .dropdown-menu>.active>a:focus,.navbar-inverse .navbar-nav .open .dropdown-menu>.active>a:hover{color:#fff;background-color:#080808}.navbar-inverse .navbar-nav .open .dropdown-menu>.disabled>a,.navbar-inverse .navbar-nav .open .dropdown-menu>.disabled>a:focus,.navbar-inverse .navbar-nav .open .dropdown-menu>.disabled>a:hover{color:#444;background-color:transparent}}.navbar-inverse .navbar-link{color:#9d9d9d}.navbar-inverse .navbar-link:hover{color:#fff}.navbar-inverse .btn-link{color:#9d9d9d}.navbar-inverse .btn-link:focus,.navbar-inverse .btn-link:hover{color:#fff}.navbar-inverse .btn-link[disabled]:focus,.navbar-inverse .btn-link[disabled]:hover,fieldset[disabled] .navbar-inverse .btn-link:focus,fieldset[disabled] .navbar-inverse .btn-link:hover{color:#444}.breadcrumb{padding:8px 15px;margin-bottom:20px;list-style:none;background-color:#f5f5f5;border-radius:4px}.breadcrumb>li{display:inline-block}.breadcrumb>li+li:before{padding:0 5px;color:#ccc;content:"/\00a0"}.breadcrumb>.active{color:#777}.pagination{display:inline-block;padding-left:0;margin:20px 0;border-radius:4px}.pagination>li{display:inline}.pagination>li>a,.pagination>li>span{position:relative;float:left;padding:6px 12px;margin-left:-1px;line-height:1.42857143;color:#337ab7;text-decoration:none;background-color:#fff;border:1px solid #ddd}.pagination>li:first-child>a,.pagination>li:first-child>span{margin-left:0;border-top-left-radius:4px;border-bottom-left-radius:4px}.pagination>li:last-child>a,.pagination>li:last-child>span{border-top-right-radius:4px;border-bottom-right-radius:4px}.pagination>li>a:focus,.pagination>li>a:hover,.pagination>li>span:focus,.pagination>li>span:hover{color:#23527c;background-color:#eee;border-color:#ddd}.pagination>.active>a,.pagination>.active>a:focus,.pagination>.active>a:hover,.pagination>.active>span,.pagination>.active>span:focus,.pagination>.active>span:hover{z-index:2;color:#fff;cursor:default;background-color:#337ab7;border-color:#337ab7}.pagination>.disabled>a,.pagination>.disabled>a:focus,.pagination>.disabled>a:hover,.pagination>.disabled>span,.pagination>.disabled>span:focus,.pagination>.disabled>span:hover{color:#777;cursor:not-allowed;background-color:#fff;border-color:#ddd}.pagination-lg>li>a,.pagination-lg>li>span{padding:10px 16px;font-size:18px}.pagination-lg>li:first-child>a,.pagination-lg>li:first-child>span{border-top-left-radius:6px;border-bottom-left-radius:6px}.pagination-lg>li:last-child>a,.pagination-lg>li:last-child>span{border-top-right-radius:6px;border-bottom-right-radius:6px}.pagination-sm>li>a,.pagination-sm>li>span{padding:5px 10px;font-size:12px}.pagination-sm>li:first-child>a,.pagination-sm>li:first-child>span{border-top-left-radius:3px;border-bottom-left-radius:3px}.pagination-sm>li:last-child>a,.pagination-sm>li:last-child>span{border-top-right-radius:3px;border-bottom-right-radius:3px}.pager{padding-left:0;margin:20px 0;text-align:center;list-style:none}.pager li{display:inline}.pager li>a,.pager li>span{display:inline-block;padding:5px 14px;background-color:#fff;border:1px solid #ddd;border-radius:15px}.pager li>a:focus,.pager li>a:hover{text-decoration:none;background-color:#eee}.pager .next>a,.pager .next>span{float:right}.pager .previous>a,.pager .previous>span{float:left}.pager .disabled>a,.pager .disabled>a:focus,.pager .disabled>a:hover,.pager .disabled>span{color:#777;cursor:not-allowed;background-color:#fff}.label{display:inline;padding:.2em .6em .3em;font-size:75%;font-weight:700;line-height:1;color:#fff;text-align:center;white-space:nowrap;vertical-align:baseline;border-radius:.25em}a.label:focus,a.label:hover{color:#fff;text-decoration:none;cursor:pointer}.label:empty{display:none}.btn .label{position:relative;top:-1px}.label-default{background-color:#777}.label-default[href]:focus,.label-default[href]:hover{background-color:#5e5e5e}.label-primary{background-color:#337ab7}.label-primary[href]:focus,.label-primary[href]:hover{background-color:#286090}.label-success{background-color:#5cb85c}.label-success[href]:focus,.label-success[href]:hover{background-color:#449d44}.label-info{background-color:#5bc0de}.label-info[href]:focus,.label-info[href]:hover{background-color:#31b0d5}.label-warning{background-color:#f0ad4e}.label-warning[href]:focus,.label-warning[href]:hover{background-color:#ec971f}.label-danger{background-color:#d9534f}.label-danger[href]:focus,.label-danger[href]:hover{background-color:#c9302c}.badge{display:inline-block;min-width:10px;padding:3px 7px;font-size:12px;font-weight:700;line-height:1;color:#fff;text-align:center;white-space:nowrap;vertical-align:baseline;background-color:#777;border-radius:10px}.badge:empty{display:none}.btn .badge{position:relative;top:-1px}.btn-group-xs>.btn .badge,.btn-xs .badge{top:0;padding:1px 5px}a.badge:focus,a.badge:hover{color:#fff;text-decoration:none;cursor:pointer}.list-group-item.active>.badge,.nav-pills>.active>a>.badge{color:#337ab7;background-color:#fff}.list-group-item>.badge{float:right}.list-group-item>.badge+.badge{margin-right:5px}.nav-pills>li>a>.badge{margin-left:3px}.jumbotron{padding:30px 15px;margin-bottom:30px;color:inherit;background-color:#eee}.jumbotron .h1,.jumbotron h1{color:inherit}.jumbotron p{margin-bottom:15px;font-size:21px;font-weight:200}.jumbotron>hr{border-top-color:#d5d5d5}.container .jumbotron,.container-fluid .jumbotron{border-radius:6px}.jumbotron .container{max-width:100%}@media screen and (min-width:768px){.jumbotron{padding:48px 0}.container .jumbotron,.container-fluid .jumbotron{padding-right:60px;padding-left:60px}.jumbotron .h1,.jumbotron h1{font-size:63px}}.thumbnail{display:block;padding:4px;margin-bottom:20px;line-height:1.42857143;background-color:#fff;border:1px solid #ddd;border-radius:4px;-webkit-transition:border .2s ease-in-out;-o-transition:border .2s ease-in-out;transition:border .2s ease-in-out}.thumbnail a>img,.thumbnail>img{margin-right:auto;margin-left:auto}a.thumbnail.active,a.thumbnail:focus,a.thumbnail:hover{border-color:#337ab7}.thumbnail .caption{padding:9px;color:#333}.alert{padding:15px;margin-bottom:20px;border:1px solid transparent;border-radius:4px}.alert h4{margin-top:0;color:inherit}.alert .alert-link{font-weight:700}.alert>p,.alert>ul{margin-bottom:0}.alert>p+p{margin-top:5px}.alert-dismissable,.alert-dismissible{padding-right:35px}.alert-dismissable .close,.alert-dismissible .close{position:relative;top:-2px;right:-21px;color:inherit}.alert-success{color:#3c763d;background-color:#dff0d8;border-color:#d6e9c6}.alert-success hr{border-top-color:#c9e2b3}.alert-success .alert-link{color:#2b542c}.alert-info{color:#31708f;background-color:#d9edf7;border-color:#bce8f1}.alert-info hr{border-top-color:#a6e1ec}.alert-info .alert-link{color:#245269}.alert-warning{color:#8a6d3b;background-color:#fcf8e3;border-color:#faebcc}.alert-warning hr{border-top-color:#f7e1b5}.alert-warning .alert-link{color:#66512c}.alert-danger{color:#a94442;background-color:#f2dede;border-color:#ebccd1}.alert-danger hr{border-top-color:#e4b9c0}.alert-danger .alert-link{color:#843534}@-webkit-keyframes progress-bar-stripes{from{background-position:40px 0}to{background-position:0 0}}@-o-keyframes progress-bar-stripes{from{background-position:40px 0}to{background-position:0 0}}@keyframes progress-bar-stripes{from{background-position:40px 0}to{background-position:0 0}}.progress{height:20px;margin-bottom:20px;overflow:hidden;background-color:#f5f5f5;border-radius:4px;-webkit-box-shadow:inset 0 1px 2px rgba(0,0,0,.1);box-shadow:inset 0 1px 2px rgba(0,0,0,.1)}.progress-bar{float:left;width:0;height:100%;font-size:12px;line-height:20px;color:#fff;text-align:center;background-color:#337ab7;-webkit-box-shadow:inset 0 -1px 0 rgba(0,0,0,.15);box-shadow:inset 0 -1px 0 rgba(0,0,0,.15);-webkit-transition:width .6s ease;-o-transition:width .6s ease;transition:width .6s ease}.progress-bar-striped,.progress-striped .progress-bar{background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:-o-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);-webkit-background-size:40px 40px;background-size:40px 40px}.progress-bar.active,.progress.active .progress-bar{-webkit-animation:progress-bar-stripes 2s linear infinite;-o-animation:progress-bar-stripes 2s linear infinite;animation:progress-bar-stripes 2s linear infinite}.progress-bar-success{background-color:#5cb85c}.progress-striped .progress-bar-success{background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:-o-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent)}.progress-bar-info{background-color:#5bc0de}.progress-striped .progress-bar-info{background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:-o-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent)}.progress-bar-warning{background-color:#f0ad4e}.progress-striped .progress-bar-warning{background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:-o-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent)}.progress-bar-danger{background-color:#d9534f}.progress-striped .progress-bar-danger{background-image:-webkit-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:-o-linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);background-image:linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent)}.media{margin-top:15px}.media:first-child{margin-top:0}.media,.media-body{overflow:hidden;zoom:1}.media-body{width:10000px}.media-object{display:block}.media-right,.media>.pull-right{padding-left:10px}.media-left,.media>.pull-left{padding-right:10px}.media-body,.media-left,.media-right{display:table-cell;vertical-align:top}.media-middle{vertical-align:middle}.media-bottom{vertical-align:bottom}.media-heading{margin-top:0;margin-bottom:5px}.media-list{padding-left:0;list-style:none}.list-group{padding-left:0;margin-bottom:20px}.list-group-item{position:relative;display:block;padding:10px 15px;margin-bottom:-1px;background-color:#fff;border:1px solid #ddd}.list-group-item:first-child{border-top-left-radius:4px;border-top-right-radius:4px}.list-group-item:last-child{margin-bottom:0;border-bottom-right-radius:4px;border-bottom-left-radius:4px}a.list-group-item{color:#555}a.list-group-item .list-group-item-heading{color:#333}a.list-group-item:focus,a.list-group-item:hover{color:#555;text-decoration:none;background-color:#f5f5f5}.list-group-item.disabled,.list-group-item.disabled:focus,.list-group-item.disabled:hover{color:#777;cursor:not-allowed;background-color:#eee}.list-group-item.disabled .list-group-item-heading,.list-group-item.disabled:focus .list-group-item-heading,.list-group-item.disabled:hover .list-group-item-heading{color:inherit}.list-group-item.disabled .list-group-item-text,.list-group-item.disabled:focus .list-group-item-text,.list-group-item.disabled:hover .list-group-item-text{color:#777}.list-group-item.active,.list-group-item.active:focus,.list-group-item.active:hover{z-index:2;color:#fff;background-color:#337ab7;border-color:#337ab7}.list-group-item.active .list-group-item-heading,.list-group-item.active .list-group-item-heading>.small,.list-group-item.active .list-group-item-heading>small,.list-group-item.active:focus .list-group-item-heading,.list-group-item.active:focus .list-group-item-heading>.small,.list-group-item.active:focus .list-group-item-heading>small,.list-group-item.active:hover .list-group-item-heading,.list-group-item.active:hover .list-group-item-heading>.small,.list-group-item.active:hover .list-group-item-heading>small{color:inherit}.list-group-item.active .list-group-item-text,.list-group-item.active:focus .list-group-item-text,.list-group-item.active:hover .list-group-item-text{color:#c7ddef}.list-group-item-success{color:#3c763d;background-color:#dff0d8}a.list-group-item-success{color:#3c763d}a.list-group-item-success .list-group-item-heading{color:inherit}a.list-group-item-success:focus,a.list-group-item-success:hover{color:#3c763d;background-color:#d0e9c6}a.list-group-item-success.active,a.list-group-item-success.active:focus,a.list-group-item-success.active:hover{color:#fff;background-color:#3c763d;border-color:#3c763d}.list-group-item-info{color:#31708f;background-color:#d9edf7}a.list-group-item-info{color:#31708f}a.list-group-item-info .list-group-item-heading{color:inherit}a.list-group-item-info:focus,a.list-group-item-info:hover{color:#31708f;background-color:#c4e3f3}a.list-group-item-info.active,a.list-group-item-info.active:focus,a.list-group-item-info.active:hover{color:#fff;background-color:#31708f;border-color:#31708f}.list-group-item-warning{color:#8a6d3b;background-color:#fcf8e3}a.list-group-item-warning{color:#8a6d3b}a.list-group-item-warning .list-group-item-heading{color:inherit}a.list-group-item-warning:focus,a.list-group-item-warning:hover{color:#8a6d3b;background-color:#faf2cc}a.list-group-item-warning.active,a.list-group-item-warning.active:focus,a.list-group-item-warning.active:hover{color:#fff;background-color:#8a6d3b;border-color:#8a6d3b}.list-group-item-danger{color:#a94442;background-color:#f2dede}a.list-group-item-danger{color:#a94442}a.list-group-item-danger .list-group-item-heading{color:inherit}a.list-group-item-danger:focus,a.list-group-item-danger:hover{color:#a94442;background-color:#ebcccc}a.list-group-item-danger.active,a.list-group-item-danger.active:focus,a.list-group-item-danger.active:hover{color:#fff;background-color:#a94442;border-color:#a94442}.list-group-item-heading{margin-top:0;margin-bottom:5px}.list-group-item-text{margin-bottom:0;line-height:1.3}.panel{margin-bottom:20px;background-color:#fff;border:1px solid transparent;border-radius:4px;-webkit-box-shadow:0 1px 1px rgba(0,0,0,.05);box-shadow:0 1px 1px rgba(0,0,0,.05)}.panel-body{padding:15px}.panel-heading{padding:10px 15px;border-bottom:1px solid transparent;border-top-left-radius:3px;border-top-right-radius:3px}.panel-heading>.dropdown .dropdown-toggle{color:inherit}.panel-title{margin-top:0;margin-bottom:0;font-size:16px;color:inherit}.panel-title>.small,.panel-title>.small>a,.panel-title>a,.panel-title>small,.panel-title>small>a{color:inherit}.panel-footer{padding:10px 15px;background-color:#f5f5f5;border-top:1px solid #ddd;border-bottom-right-radius:3px;border-bottom-left-radius:3px}.panel>.list-group,.panel>.panel-collapse>.list-group{margin-bottom:0}.panel>.list-group .list-group-item,.panel>.panel-collapse>.list-group .list-group-item{border-width:1px 0;border-radius:0}.panel>.list-group:first-child .list-group-item:first-child,.panel>.panel-collapse>.list-group:first-child .list-group-item:first-child{border-top:0;border-top-left-radius:3px;border-top-right-radius:3px}.panel>.list-group:last-child .list-group-item:last-child,.panel>.panel-collapse>.list-group:last-child .list-group-item:last-child{border-bottom:0;border-bottom-right-radius:3px;border-bottom-left-radius:3px}.panel-heading+.list-group .list-group-item:first-child{border-top-width:0}.list-group+.panel-footer{border-top-width:0}.panel>.panel-collapse>.table,.panel>.table,.panel>.table-responsive>.table{margin-bottom:0}.panel>.panel-collapse>.table caption,.panel>.table caption,.panel>.table-responsive>.table caption{padding-right:15px;padding-left:15px}.panel>.table-responsive:first-child>.table:first-child,.panel>.table:first-child{border-top-left-radius:3px;border-top-right-radius:3px}.panel>.table-responsive:first-child>.table:first-child>tbody:first-child>tr:first-child,.panel>.table-responsive:first-child>.table:first-child>thead:first-child>tr:first-child,.panel>.table:first-child>tbody:first-child>tr:first-child,.panel>.table:first-child>thead:first-child>tr:first-child{border-top-left-radius:3px;border-top-right-radius:3px}.panel>.table-responsive:first-child>.table:first-child>tbody:first-child>tr:first-child td:first-child,.panel>.table-responsive:first-child>.table:first-child>tbody:first-child>tr:first-child th:first-child,.panel>.table-responsive:first-child>.table:first-child>thead:first-child>tr:first-child td:first-child,.panel>.table-responsive:first-child>.table:first-child>thead:first-child>tr:first-child th:first-child,.panel>.table:first-child>tbody:first-child>tr:first-child td:first-child,.panel>.table:first-child>tbody:first-child>tr:first-child th:first-child,.panel>.table:first-child>thead:first-child>tr:first-child td:first-child,.panel>.table:first-child>thead:first-child>tr:first-child th:first-child{border-top-left-radius:3px}.panel>.table-responsive:first-child>.table:first-child>tbody:first-child>tr:first-child td:last-child,.panel>.table-responsive:first-child>.table:first-child>tbody:first-child>tr:first-child th:last-child,.panel>.table-responsive:first-child>.table:first-child>thead:first-child>tr:first-child td:last-child,.panel>.table-responsive:first-child>.table:first-child>thead:first-child>tr:first-child th:last-child,.panel>.table:first-child>tbody:first-child>tr:first-child td:last-child,.panel>.table:first-child>tbody:first-child>tr:first-child th:last-child,.panel>.table:first-child>thead:first-child>tr:first-child td:last-child,.panel>.table:first-child>thead:first-child>tr:first-child th:last-child{border-top-right-radius:3px}.panel>.table-responsive:last-child>.table:last-child,.panel>.table:last-child{border-bottom-right-radius:3px;border-bottom-left-radius:3px}.panel>.table-responsive:last-child>.table:last-child>tbody:last-child>tr:last-child,.panel>.table-responsive:last-child>.table:last-child>tfoot:last-child>tr:last-child,.panel>.table:last-child>tbody:last-child>tr:last-child,.panel>.table:last-child>tfoot:last-child>tr:last-child{border-bottom-right-radius:3px;border-bottom-left-radius:3px}.panel>.table-responsive:last-child>.table:last-child>tbody:last-child>tr:last-child td:first-child,.panel>.table-responsive:last-child>.table:last-child>tbody:last-child>tr:last-child th:first-child,.panel>.table-responsive:last-child>.table:last-child>tfoot:last-child>tr:last-child td:first-child,.panel>.table-responsive:last-child>.table:last-child>tfoot:last-child>tr:last-child th:first-child,.panel>.table:last-child>tbody:last-child>tr:last-child td:first-child,.panel>.table:last-child>tbody:last-child>tr:last-child th:first-child,.panel>.table:last-child>tfoot:last-child>tr:last-child td:first-child,.panel>.table:last-child>tfoot:last-child>tr:last-child th:first-child{border-bottom-left-radius:3px}.panel>.table-responsive:last-child>.table:last-child>tbody:last-child>tr:last-child td:last-child,.panel>.table-responsive:last-child>.table:last-child>tbody:last-child>tr:last-child th:last-child,.panel>.table-responsive:last-child>.table:last-child>tfoot:last-child>tr:last-child td:last-child,.panel>.table-responsive:last-child>.table:last-child>tfoot:last-child>tr:last-child th:last-child,.panel>.table:last-child>tbody:last-child>tr:last-child td:last-child,.panel>.table:last-child>tbody:last-child>tr:last-child th:last-child,.panel>.table:last-child>tfoot:last-child>tr:last-child td:last-child,.panel>.table:last-child>tfoot:last-child>tr:last-child th:last-child{border-bottom-right-radius:3px}.panel>.panel-body+.table,.panel>.panel-body+.table-responsive,.panel>.table+.panel-body,.panel>.table-responsive+.panel-body{border-top:1px solid #ddd}.panel>.table>tbody:first-child>tr:first-child td,.panel>.table>tbody:first-child>tr:first-child th{border-top:0}.panel>.table-bordered,.panel>.table-responsive>.table-bordered{border:0}.panel>.table-bordered>tbody>tr>td:first-child,.panel>.table-bordered>tbody>tr>th:first-child,.panel>.table-bordered>tfoot>tr>td:first-child,.panel>.table-bordered>tfoot>tr>th:first-child,.panel>.table-bordered>thead>tr>td:first-child,.panel>.table-bordered>thead>tr>th:first-child,.panel>.table-responsive>.table-bordered>tbody>tr>td:first-child,.panel>.table-responsive>.table-bordered>tbody>tr>th:first-child,.panel>.table-responsive>.table-bordered>tfoot>tr>td:first-child,.panel>.table-responsive>.table-bordered>tfoot>tr>th:first-child,.panel>.table-responsive>.table-bordered>thead>tr>td:first-child,.panel>.table-responsive>.table-bordered>thead>tr>th:first-child{border-left:0}.panel>.table-bordered>tbody>tr>td:last-child,.panel>.table-bordered>tbody>tr>th:last-child,.panel>.table-bordered>tfoot>tr>td:last-child,.panel>.table-bordered>tfoot>tr>th:last-child,.panel>.table-bordered>thead>tr>td:last-child,.panel>.table-bordered>thead>tr>th:last-child,.panel>.table-responsive>.table-bordered>tbody>tr>td:last-child,.panel>.table-responsive>.table-bordered>tbody>tr>th:last-child,.panel>.table-responsive>.table-bordered>tfoot>tr>td:last-child,.panel>.table-responsive>.table-bordered>tfoot>tr>th:last-child,.panel>.table-responsive>.table-bordered>thead>tr>td:last-child,.panel>.table-responsive>.table-bordered>thead>tr>th:last-child{border-right:0}.panel>.table-bordered>tbody>tr:first-child>td,.panel>.table-bordered>tbody>tr:first-child>th,.panel>.table-bordered>thead>tr:first-child>td,.panel>.table-bordered>thead>tr:first-child>th,.panel>.table-responsive>.table-bordered>tbody>tr:first-child>td,.panel>.table-responsive>.table-bordered>tbody>tr:first-child>th,.panel>.table-responsive>.table-bordered>thead>tr:first-child>td,.panel>.table-responsive>.table-bordered>thead>tr:first-child>th{border-bottom:0}.panel>.table-bordered>tbody>tr:last-child>td,.panel>.table-bordered>tbody>tr:last-child>th,.panel>.table-bordered>tfoot>tr:last-child>td,.panel>.table-bordered>tfoot>tr:last-child>th,.panel>.table-responsive>.table-bordered>tbody>tr:last-child>td,.panel>.table-responsive>.table-bordered>tbody>tr:last-child>th,.panel>.table-responsive>.table-bordered>tfoot>tr:last-child>td,.panel>.table-responsive>.table-bordered>tfoot>tr:last-child>th{border-bottom:0}.panel>.table-responsive{margin-bottom:0;border:0}.panel-group{margin-bottom:20px}.panel-group .panel{margin-bottom:0;border-radius:4px}.panel-group .panel+.panel{margin-top:5px}.panel-group .panel-heading{border-bottom:0}.panel-group .panel-heading+.panel-collapse>.list-group,.panel-group .panel-heading+.panel-collapse>.panel-body{border-top:1px solid #ddd}.panel-group .panel-footer{border-top:0}.panel-group .panel-footer+.panel-collapse .panel-body{border-bottom:1px solid #ddd}.panel-default{border-color:#ddd}.panel-default>.panel-heading{color:#333;background-color:#f5f5f5;border-color:#ddd}.panel-default>.panel-heading+.panel-collapse>.panel-body{border-top-color:#ddd}.panel-default>.panel-heading .badge{color:#f5f5f5;background-color:#333}.panel-default>.panel-footer+.panel-collapse>.panel-body{border-bottom-color:#ddd}.panel-primary{border-color:#337ab7}.panel-primary>.panel-heading{color:#fff;background-color:#337ab7;border-color:#337ab7}.panel-primary>.panel-heading+.panel-collapse>.panel-body{border-top-color:#337ab7}.panel-primary>.panel-heading .badge{color:#337ab7;background-color:#fff}.panel-primary>.panel-footer+.panel-collapse>.panel-body{border-bottom-color:#337ab7}.panel-success{border-color:#d6e9c6}.panel-success>.panel-heading{color:#3c763d;background-color:#dff0d8;border-color:#d6e9c6}.panel-success>.panel-heading+.panel-collapse>.panel-body{border-top-color:#d6e9c6}.panel-success>.panel-heading .badge{color:#dff0d8;background-color:#3c763d}.panel-success>.panel-footer+.panel-collapse>.panel-body{border-bottom-color:#d6e9c6}.panel-info{border-color:#bce8f1}.panel-info>.panel-heading{color:#31708f;background-color:#d9edf7;border-color:#bce8f1}.panel-info>.panel-heading+.panel-collapse>.panel-body{border-top-color:#bce8f1}.panel-info>.panel-heading .badge{color:#d9edf7;background-color:#31708f}.panel-info>.panel-footer+.panel-collapse>.panel-body{border-bottom-color:#bce8f1}.panel-warning{border-color:#faebcc}.panel-warning>.panel-heading{color:#8a6d3b;background-color:#fcf8e3;border-color:#faebcc}.panel-warning>.panel-heading+.panel-collapse>.panel-body{border-top-color:#faebcc}.panel-warning>.panel-heading .badge{color:#fcf8e3;background-color:#8a6d3b}.panel-warning>.panel-footer+.panel-collapse>.panel-body{border-bottom-color:#faebcc}.panel-danger{border-color:#ebccd1}.panel-danger>.panel-heading{color:#a94442;background-color:#f2dede;border-color:#ebccd1}.panel-danger>.panel-heading+.panel-collapse>.panel-body{border-top-color:#ebccd1}.panel-danger>.panel-heading .badge{color:#f2dede;background-color:#a94442}.panel-danger>.panel-footer+.panel-collapse>.panel-body{border-bottom-color:#ebccd1}.embed-responsive{position:relative;display:block;height:0;padding:0;overflow:hidden}.embed-responsive .embed-responsive-item,.embed-responsive embed,.embed-responsive iframe,.embed-responsive object,.embed-responsive video{position:absolute;top:0;bottom:0;left:0;width:100%;height:100%;border:0}.embed-responsive-16by9{padding-bottom:56.25%}.embed-responsive-4by3{padding-bottom:75%}.well{min-height:20px;padding:19px;margin-bottom:20px;background-color:#f5f5f5;border:1px solid #e3e3e3;border-radius:4px;-webkit-box-shadow:inset 0 1px 1px rgba(0,0,0,.05);box-shadow:inset 0 1px 1px rgba(0,0,0,.05)}.well blockquote{border-color:#ddd;border-color:rgba(0,0,0,.15)}.well-lg{padding:24px;border-radius:6px}.well-sm{padding:9px;border-radius:3px}.close{float:right;font-size:21px;font-weight:700;line-height:1;color:#000;text-shadow:0 1px 0 #fff;filter:alpha(opacity=20);opacity:.2}.close:focus,.close:hover{color:#000;text-decoration:none;cursor:pointer;filter:alpha(opacity=50);opacity:.5}button.close{-webkit-appearance:none;padding:0;cursor:pointer;background:0 0;border:0}.modal-open{overflow:hidden}.modal{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1050;display:none;overflow:hidden;-webkit-overflow-scrolling:touch;outline:0}.modal.fade .modal-dialog{-webkit-transition:-webkit-transform .3s ease-out;-o-transition:-o-transform .3s ease-out;transition:transform .3s ease-out;-webkit-transform:translate(0,-25%);-ms-transform:translate(0,-25%);-o-transform:translate(0,-25%);transform:translate(0,-25%)}.modal.in .modal-dialog{-webkit-transform:translate(0,0);-ms-transform:translate(0,0);-o-transform:translate(0,0);transform:translate(0,0)}.modal-open .modal{overflow-x:hidden;overflow-y:auto}.modal-dialog{position:relative;width:auto;margin:10px}.modal-content{position:relative;background-color:#fff;-webkit-background-clip:padding-box;background-clip:padding-box;border:1px solid #999;border:1px solid rgba(0,0,0,.2);border-radius:6px;outline:0;-webkit-box-shadow:0 3px 9px rgba(0,0,0,.5);box-shadow:0 3px 9px rgba(0,0,0,.5)}.modal-backdrop{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1040;background-color:#000}.modal-backdrop.fade{filter:alpha(opacity=0);opacity:0}.modal-backdrop.in{filter:alpha(opacity=50);opacity:.5}.modal-header{min-height:16.43px;padding:15px;border-bottom:1px solid #e5e5e5}.modal-header .close{margin-top:-2px}.modal-title{margin:0;line-height:1.42857143}.modal-body{position:relative;padding:15px}.modal-footer{padding:15px;text-align:right;border-top:1px solid #e5e5e5}.modal-footer .btn+.btn{margin-bottom:0;margin-left:5px}.modal-footer .btn-group .btn+.btn{margin-left:-1px}.modal-footer .btn-block+.btn-block{margin-left:0}.modal-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}@media (min-width:768px){.modal-dialog{width:600px;margin:30px auto}.modal-content{-webkit-box-shadow:0 5px 15px rgba(0,0,0,.5);box-shadow:0 5px 15px rgba(0,0,0,.5)}.modal-sm{width:300px}}@media (min-width:992px){.modal-lg{width:900px}}.tooltip{position:absolute;z-index:1070;display:block;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:12px;font-weight:400;line-height:1.4;filter:alpha(opacity=0);opacity:0}.tooltip.in{filter:alpha(opacity=90);opacity:.9}.tooltip.top{padding:5px 0;margin-top:-3px}.tooltip.right{padding:0 5px;margin-left:3px}.tooltip.bottom{padding:5px 0;margin-top:3px}.tooltip.left{padding:0 5px;margin-left:-3px}.tooltip-inner{max-width:200px;padding:3px 8px;color:#fff;text-align:center;text-decoration:none;background-color:#000;border-radius:4px}.tooltip-arrow{position:absolute;width:0;height:0;border-color:transparent;border-style:solid}.tooltip.top .tooltip-arrow{bottom:0;left:50%;margin-left:-5px;border-width:5px 5px 0;border-top-color:#000}.tooltip.top-left .tooltip-arrow{right:5px;bottom:0;margin-bottom:-5px;border-width:5px 5px 0;border-top-color:#000}.tooltip.top-right .tooltip-arrow{bottom:0;left:5px;margin-bottom:-5px;border-width:5px 5px 0;border-top-color:#000}.tooltip.right .tooltip-arrow{top:50%;left:0;margin-top:-5px;border-width:5px 5px 5px 0;border-right-color:#000}.tooltip.left .tooltip-arrow{top:50%;right:0;margin-top:-5px;border-width:5px 0 5px 5px;border-left-color:#000}.tooltip.bottom .tooltip-arrow{top:0;left:50%;margin-left:-5px;border-width:0 5px 5px;border-bottom-color:#000}.tooltip.bottom-left .tooltip-arrow{top:0;right:5px;margin-top:-5px;border-width:0 5px 5px;border-bottom-color:#000}.tooltip.bottom-right .tooltip-arrow{top:0;left:5px;margin-top:-5px;border-width:0 5px 5px;border-bottom-color:#000}.popover{position:absolute;top:0;left:0;z-index:1060;display:none;max-width:276px;padding:1px;font-family:"Helvetica Neue",Helvetica,Arial,sans-serif;font-size:14px;font-weight:400;line-height:1.42857143;text-align:left;white-space:normal;background-color:#fff;-webkit-background-clip:padding-box;background-clip:padding-box;border:1px solid #ccc;border:1px solid rgba(0,0,0,.2);border-radius:6px;-webkit-box-shadow:0 5px 10px rgba(0,0,0,.2);box-shadow:0 5px 10px rgba(0,0,0,.2)}.popover.top{margin-top:-10px}.popover.right{margin-left:10px}.popover.bottom{margin-top:10px}.popover.left{margin-left:-10px}.popover-title{padding:8px 14px;margin:0;font-size:14px;background-color:#f7f7f7;border-bottom:1px solid #ebebeb;border-radius:5px 5px 0 0}.popover-content{padding:9px 14px}.popover>.arrow,.popover>.arrow:after{position:absolute;display:block;width:0;height:0;border-color:transparent;border-style:solid}.popover>.arrow{border-width:11px}.popover>.arrow:after{content:"";border-width:10px}.popover.top>.arrow{bottom:-11px;left:50%;margin-left:-11px;border-top-color:#999;border-top-color:rgba(0,0,0,.25);border-bottom-width:0}.popover.top>.arrow:after{bottom:1px;margin-left:-10px;content:" ";border-top-color:#fff;border-bottom-width:0}.popover.right>.arrow{top:50%;left:-11px;margin-top:-11px;border-right-color:#999;border-right-color:rgba(0,0,0,.25);border-left-width:0}.popover.right>.arrow:after{bottom:-10px;left:1px;content:" ";border-right-color:#fff;border-left-width:0}.popover.bottom>.arrow{top:-11px;left:50%;margin-left:-11px;border-top-width:0;border-bottom-color:#999;border-bottom-color:rgba(0,0,0,.25)}.popover.bottom>.arrow:after{top:1px;margin-left:-10px;content:" ";border-top-width:0;border-bottom-color:#fff}.popover.left>.arrow{top:50%;right:-11px;margin-top:-11px;border-right-width:0;border-left-color:#999;border-left-color:rgba(0,0,0,.25)}.popover.left>.arrow:after{right:1px;bottom:-10px;content:" ";border-right-width:0;border-left-color:#fff}.carousel{position:relative}.carousel-inner{position:relative;width:100%;overflow:hidden}.carousel-inner>.item{position:relative;display:none;-webkit-transition:.6s ease-in-out left;-o-transition:.6s ease-in-out left;transition:.6s ease-in-out left}.carousel-inner>.item>a>img,.carousel-inner>.item>img{line-height:1}@media all and (transform-3d),(-webkit-transform-3d){.carousel-inner>.item{-webkit-transition:-webkit-transform .6s ease-in-out;-o-transition:-o-transform .6s ease-in-out;transition:transform .6s ease-in-out;-webkit-backface-visibility:hidden;backface-visibility:hidden;-webkit-perspective:1000;perspective:1000}.carousel-inner>.item.active.right,.carousel-inner>.item.next{left:0;-webkit-transform:translate3d(100%,0,0);transform:translate3d(100%,0,0)}.carousel-inner>.item.active.left,.carousel-inner>.item.prev{left:0;-webkit-transform:translate3d(-100%,0,0);transform:translate3d(-100%,0,0)}.carousel-inner>.item.active,.carousel-inner>.item.next.left,.carousel-inner>.item.prev.right{left:0;-webkit-transform:translate3d(0,0,0);transform:translate3d(0,0,0)}}.carousel-inner>.active,.carousel-inner>.next,.carousel-inner>.prev{display:block}.carousel-inner>.active{left:0}.carousel-inner>.next,.carousel-inner>.prev{position:absolute;top:0;width:100%}.carousel-inner>.next{left:100%}.carousel-inner>.prev{left:-100%}.carousel-inner>.next.left,.carousel-inner>.prev.right{left:0}.carousel-inner>.active.left{left:-100%}.carousel-inner>.active.right{left:100%}.carousel-control{position:absolute;top:0;bottom:0;left:0;width:15%;font-size:20px;color:#fff;text-align:center;text-shadow:0 1px 2px rgba(0,0,0,.6);filter:alpha(opacity=50);opacity:.5}.carousel-control.left{background-image:-webkit-linear-gradient(left,rgba(0,0,0,.5) 0,rgba(0,0,0,.0001) 100%);background-image:-o-linear-gradient(left,rgba(0,0,0,.5) 0,rgba(0,0,0,.0001) 100%);background-image:-webkit-gradient(linear,left top,right top,from(rgba(0,0,0,.5)),to(rgba(0,0,0,.0001)));background-image:linear-gradient(to right,rgba(0,0,0,.5) 0,rgba(0,0,0,.0001) 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#80000000', endColorstr='#00000000', GradientType=1);background-repeat:repeat-x}.carousel-control.right{right:0;left:auto;background-image:-webkit-linear-gradient(left,rgba(0,0,0,.0001) 0,rgba(0,0,0,.5) 100%);background-image:-o-linear-gradient(left,rgba(0,0,0,.0001) 0,rgba(0,0,0,.5) 100%);background-image:-webkit-gradient(linear,left top,right top,from(rgba(0,0,0,.0001)),to(rgba(0,0,0,.5)));background-image:linear-gradient(to right,rgba(0,0,0,.0001) 0,rgba(0,0,0,.5) 100%);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr='#00000000', endColorstr='#80000000', GradientType=1);background-repeat:repeat-x}.carousel-control:focus,.carousel-control:hover{color:#fff;text-decoration:none;filter:alpha(opacity=90);outline:0;opacity:.9}.carousel-control .glyphicon-chevron-left,.carousel-control .glyphicon-chevron-right,.carousel-control .icon-next,.carousel-control .icon-prev{position:absolute;top:50%;z-index:5;display:inline-block}.carousel-control .glyphicon-chevron-left,.carousel-control .icon-prev{left:50%;margin-left:-10px}.carousel-control .glyphicon-chevron-right,.carousel-control .icon-next{right:50%;margin-right:-10px}.carousel-control .icon-next,.carousel-control .icon-prev{width:20px;height:20px;margin-top:-10px;font-family:serif;line-height:1}.carousel-control .icon-prev:before{content:'\2039'}.carousel-control .icon-next:before{content:'\203a'}.carousel-indicators{position:absolute;bottom:10px;left:50%;z-index:15;width:60%;padding-left:0;margin-left:-30%;text-align:center;list-style:none}.carousel-indicators li{display:inline-block;width:10px;height:10px;margin:1px;text-indent:-999px;cursor:pointer;background-color:#000 \9;background-color:rgba(0,0,0,0);border:1px solid #fff;border-radius:10px}.carousel-indicators .active{width:12px;height:12px;margin:0;background-color:#fff}.carousel-caption{position:absolute;right:15%;bottom:20px;left:15%;z-index:10;padding-top:20px;padding-bottom:20px;color:#fff;text-align:center;text-shadow:0 1px 2px rgba(0,0,0,.6)}.carousel-caption .btn{text-shadow:none}@media screen and (min-width:768px){.carousel-control .glyphicon-chevron-left,.carousel-control .glyphicon-chevron-right,.carousel-control .icon-next,.carousel-control .icon-prev{width:30px;height:30px;margin-top:-15px;font-size:30px}.carousel-control .glyphicon-chevron-left,.carousel-control .icon-prev{margin-left:-15px}.carousel-control .glyphicon-chevron-right,.carousel-control .icon-next{margin-right:-15px}.carousel-caption{right:20%;left:20%;padding-bottom:30px}.carousel-indicators{bottom:20px}}.btn-group-vertical>.btn-group:after,.btn-group-vertical>.btn-group:before,.btn-toolbar:after,.btn-toolbar:before,.clearfix:after,.clearfix:before,.container-fluid:after,.container-fluid:before,.container:after,.container:before,.dl-horizontal dd:after,.dl-horizontal dd:before,.form-horizontal .form-group:after,.form-horizontal .form-group:before,.modal-footer:after,.modal-footer:before,.nav:after,.nav:before,.navbar-collapse:after,.navbar-collapse:before,.navbar-header:after,.navbar-header:before,.navbar:after,.navbar:before,.pager:after,.pager:before,.panel-body:after,.panel-body:before,.row:after,.row:before{display:table;content:" "}.btn-group-vertical>.btn-group:after,.btn-toolbar:after,.clearfix:after,.container-fluid:after,.container:after,.dl-horizontal dd:after,.form-horizontal .form-group:after,.modal-footer:after,.nav:after,.navbar-collapse:after,.navbar-header:after,.navbar:after,.pager:after,.panel-body:after,.row:after{clear:both}.center-block{display:block;margin-right:auto;margin-left:auto}.pull-right{float:right!important}.pull-left{float:left!important}.hide{display:none!important}.show{display:block!important}.invisible{visibility:hidden}.text-hide{font:0/0 a;color:transparent;text-shadow:none;background-color:transparent;border:0}.hidden{display:none!important}.affix{position:fixed}@-ms-viewport{width:device-width}.visible-lg,.visible-md,.visible-sm,.visible-xs{display:none!important}.visible-lg-block,.visible-lg-inline,.visible-lg-inline-block,.visible-md-block,.visible-md-inline,.visible-md-inline-block,.visible-sm-block,.visible-sm-inline,.visible-sm-inline-block,.visible-xs-block,.visible-xs-inline,.visible-xs-inline-block{display:none!important}@media (max-width:767px){.visible-xs{display:block!important}table.visible-xs{display:table}tr.visible-xs{display:table-row!important}td.visible-xs,th.visible-xs{display:table-cell!important}}@media (max-width:767px){.visible-xs-block{display:block!important}}@media (max-width:767px){.visible-xs-inline{display:inline!important}}@media (max-width:767px){.visible-xs-inline-block{display:inline-block!important}}@media (min-width:768px)and (max-width:991px){.visible-sm{display:block!important}table.visible-sm{display:table}tr.visible-sm{display:table-row!important}td.visible-sm,th.visible-sm{display:table-cell!important}}@media (min-width:768px)and (max-width:991px){.visible-sm-block{display:block!important}}@media (min-width:768px)and (max-width:991px){.visible-sm-inline{display:inline!important}}@media (min-width:768px)and (max-width:991px){.visible-sm-inline-block{display:inline-block!important}}@media (min-width:992px)and (max-width:1199px){.visible-md{display:block!important}table.visible-md{display:table}tr.visible-md{display:table-row!important}td.visible-md,th.visible-md{display:table-cell!important}}@media (min-width:992px)and (max-width:1199px){.visible-md-block{display:block!important}}@media (min-width:992px)and (max-width:1199px){.visible-md-inline{display:inline!important}}@media (min-width:992px)and (max-width:1199px){.visible-md-inline-block{display:inline-block!important}}@media (min-width:1200px){.visible-lg{display:block!important}table.visible-lg{display:table}tr.visible-lg{display:table-row!important}td.visible-lg,th.visible-lg{display:table-cell!important}}@media (min-width:1200px){.visible-lg-block{display:block!important}}@media (min-width:1200px){.visible-lg-inline{display:inline!important}}@media (min-width:1200px){.visible-lg-inline-block{display:inline-block!important}}@media (max-width:767px){.hidden-xs{display:none!important}}@media (min-width:768px)and (max-width:991px){.hidden-sm{display:none!important}}@media (min-width:992px)and (max-width:1199px){.hidden-md{display:none!important}}@media (min-width:1200px){.hidden-lg{display:none!important}}.visible-print{display:none!important}@media print{.visible-print{display:block!important}table.visible-print{display:table}tr.visible-print{display:table-row!important}td.visible-print,th.visible-print{display:table-cell!important}}.visible-print-block{display:none!important}@media print{.visible-print-block{display:block!important}}.visible-print-inline{display:none!important}@media print{.visible-print-inline{display:inline!important}}.visible-print-inline-block{display:none!important}@media print{.visible-print-inline-block{display:inline-block!important}}@media print{.hidden-print{display:none!important}}</style>

<style type="text/css">
    pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.highlight .hll { background-color: #ffffcc }
.highlight { background: #f8f8f8; }
.highlight .c { color: #3D7B7B; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #9C6500 } /* Comment.Preproc */
.highlight .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.highlight .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #E40000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #008400 } /* Generic.Inserted */
.highlight .go { color: #717171 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #687822 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #717171; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #767600 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #666666 } /* Literal.Number.Bin */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sa { color: #BA2121 } /* Literal.String.Affix */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #A45A77 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0000FF } /* Name.Function.Magic */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .vm { color: #19177C } /* Name.Variable.Magic */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>


<!-- Loading mathjax macro -->
<!-- Load mathjax -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS_CHTML-full,Safe"> </script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    init_mathjax = function() {
        if (window.MathJax) {
        // MathJax loaded
            MathJax.Hub.Config({
                TeX: {
                    equationNumbers: {
                    autoNumber: "AMS",
                    useLabelIds: true
                    }
                },
                tex2jax: {
                    inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                    displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
                    processEscapes: true,
                    processEnvironments: true
                },
                displayAlign: 'center',
                CommonHTML: {
                    linebreaks: {
                    automatic: true
                    }
                }
            });

            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
        }
    }
    init_mathjax();
    </script>
    <!-- End of mathjax configuration -->

<style>
td.center, th.center {
    text-align: center;
}

body {
  overflow: visible;
  font-size: 14px;
  padding-top: 1em;
}

div#notebook {
  overflow: visible;
  border-top: none;
}

div#notebook-container {
  width: 100%;
}

@media print {
  div.cell {
    display: block;
    page-break-inside: avoid;
  }
  div.output_wrapper {
    display: block;
    page-break-inside: avoid;
  }
  div.output {
    display: block;
    page-break-inside: avoid;
  }
}

div.prompt {
  min-width: 21ex;
}

div.nbgrader_cell {
    width: 100%;
}

div.nbgrader_cell .panel-heading {
    padding: 0.4em 0.6em;
    height: 37px;
}

div.nbgrader_cell .panel-heading a {
    color: #BBBBBB;
}

div.nbgrader_cell .panel-footer {
    padding: 0.4em 0.6em;
}

div.nbgrader_cell .panel-body {
    padding: 0.4em;
}

.comment {
    width: 100%;
    margin-top: 0.5em;
}

div.nbgrader_cell .input_area {
    background: white;
    border: none;
}

.score {
    color: black;
}

li.late-penalty {
    color: #d2413a;
}

span.nbgrader-label {
    line-height: 25px;
}

.save-icon {
    margin-left: 1em;
    top: 4px;
}
</style>

</head>
<body>
  <a name="top"></a>
  <div class="container">
    <div class="panel panel-default">
      <div class="panel-heading">
        <h4>assignment_5 (Score: 13.0 / 14.0)</h4>
        <div id="toc">
          <ol>
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            <li><a href="#cell-0584325e68b31952">Test cell</a> (Score: 1.0 / 1.0)</li>
            
            
          
            
            
          
            
            
          
            
            
          
            
            <li><a href="#cell-05d969ea25aaf599">Test cell</a> (Score: 2.0 / 2.0)</li>
            
            
          
            
            
          
            
            
          
            
            <li><a href="#cell-4b9cc6f50f975e03">Test cell</a> (Score: 2.0 / 2.0)</li>
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            <li><a href="#cell-789d006652c57c07">Test cell</a> (Score: 0.0 / 1.0)</li>
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            <li><a href="#cell-307f265b7d244b66">Test cell</a> (Score: 1.0 / 1.0)</li>
            
            
          
            
            
          
            
            
          
            
            <li><a href="#cell-c5bab8432aab8bc7">Test cell</a> (Score: 2.0 / 2.0)</li>
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            <li><a href="#cell-973c5451c1c3107d">Test cell</a> (Score: 1.0 / 1.0)</li>
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            <li><a href="#cell-87af2727f38ded3c">Test cell</a> (Score: 2.0 / 2.0)</li>
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            <li><a href="#cell-e9f5e28fbc895895">Test cell</a> (Score: 1.0 / 1.0)</li>
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            <li><a href="#cell-4722a2f16e1305ef">Test cell</a> (Score: 1.0 / 1.0)</li>
            
            
          
          
          </ol>
        </div>
      </div>
      <div class="panel-body">
        <div id="notebook" class="border-box-sizing">
          <div class="container" id="notebook-container">
            
<body>
  <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">

<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h1 id="Assignment-5">Assignment 5<a class="anchor-link" href="#Assignment-5">&#182;</a></h1><p>(v.2.1)</p>
<h2 id="Lecture-9-&amp;-10---Reinforcement-Learning-and-Language-Models">Lecture 9 &amp; 10 - Reinforcement Learning and Language Models<a class="anchor-link" href="#Lecture-9-&amp;-10---Reinforcement-Learning-and-Language-Models">&#182;</a></h2>
    </div>
  </div></div>

<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h1 id="General-Instructions">General Instructions<a class="anchor-link" href="#General-Instructions">&#182;</a></h1><ul>
<li>Jupyter notebook is supposed to be run cell by cell in order, please do not skip any code cell, this will cause some errors. Also running cells back and forth sometimes might also incur errors. If you feel you lost your track, you can click &quot;Kernel-&gt;Restart&quot; from the menu to restart the process.</li>
<li>Before submitting your assignment, ensure that it does not contain trivial errors by pressing the &quot;validate&quot; button at the top.</li>
<li>Your implementations are supposed to be added to the places where it reads &quot;YOUR CODE HERE&quot;. Please also remove the &quot;raise NotImplementedError()&quot; line before submitting.</li>
<li>Please DO NOT change the metadata of any cell, cells for demo and instructions are not editable.</li>
<li>Please DO NOT change the order of solution cell and test cell, you will lost points if the order is changed.</li>
<li>You can copy lines of code from cells that are not editable, but please DO NOT copy and paste them as cells, this may incur validation error.</li>
<li>You can add extra cells or code to help double-check your solution, but please make sure that variables required by tasks are not overwritten, or just delete those extra cells before submitting.</li>
<li>Please DO NOT change file names in you submission, renamed files can not be recognized by the grading system.</li>
<li>Reading the documentation of Python libraries is always a good practice, all the Python libraries (Numpy, Pandas, Sklearn,etc.) we utilized in this course provide very well organized documentation for each method/class/function.</li>
</ul>

    </div>
  </div></div>

<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h1 id="Reinforcement-Learning">Reinforcement Learning<a class="anchor-link" href="#Reinforcement-Learning">&#182;</a></h1><h3 id="Learning-Goals">Learning Goals<a class="anchor-link" href="#Learning-Goals">&#182;</a></h3><p>After successfully completing this assignment, you should be able to:</p>
<ul>
<li>explain why exploration and exploitation are important concepts in reinforcement learning problems</li>
<li>understand better the Multi-Armed Bandit problem</li>
<li>implement a strategy for maximizing the cumulative reward (UCB)</li>
<li>understand the Frozen Lake game/problem</li>
<li>implement an algorithm for training an agent to find an optimal path through this grid game (Q-learning)</li>
<li>understand on an intuitive level how different parameters impacts the performance</li>
</ul>
<h2 id="Table-of-Contents">Table of Contents<a class="anchor-link" href="#Table-of-Contents">&#182;</a></h2><ol>
<li><a href="#multi_armed_bandit">Multi-Armed Bandit</a></li>
<li><a href="#frozen_lake_game">Frozen Lake Game</a></li>
</ol>

    </div>
  </div></div>

<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h1 id="Multi-Armed-Bandit-">Multi-Armed Bandit <a class="anchor" id="multi_armed_bandit" /><a class="anchor-link" href="#Multi-Armed-Bandit-">&#182;</a></h1><p><img src="https://leovan.me/images/cn/2020-05-16-multi-armed-bandit/compulsive-gambling.png" alt="Multi-armed bandit" title="Multi-armed bandit" /></p>
<p>Here we will focus on the &quot;Multi-armed bandit&quot; problem. There are 10 one-armed bandit machines where each have different probabilities for winning and with different reward ranges. As we have a limited amount of coins to spend, the goal is to play on these machines in a way that maximizes the cumulative reward. An action at every time step involves selecting and playing on  one of these ten one-armed bandits, or simply arms. For each action, i.e. for each arm that we play, we observe the reward which is a value between 0 and 10 (). Since we know nothing about the reward properties of these machines to start with, we need to implement a suitable strategy that is based around observing the rewards that we get from playing on these machines.</p>

    </div>
  </div></div>

<div id="cell-id=f5ea70aa" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Import the libraries we will be using</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1234</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">tabulate</span>
</pre></div>

    </div>
  </div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h2 id="Dataset">Dataset<a class="anchor-link" href="#Dataset">&#182;</a></h2><p>The dataset that we will use here is <code>10_armed_bandit_data.csv</code>. Each row in this dataset shows the reward of playing on each arm at a given time step. With this way of representing the data, the reward from each arm changes for each time step, meaning that also the order in which the arms are selected will influence the outcome. Since there are 1000 rows in the dataset, it means we have 1000 coins to play with.</p>

    </div>
  </div></div>

<div id="cell-id=116f9956" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Importing the dataset</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;10_armed_bandit_data.csv&#39;</span><span class="p">)</span>

<span class="c1"># Print the first 5 rows from the dataset.</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
</pre></div>

    </div>
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>   Arm 0  Arm 1  Arm 2  Arm 3  Arm 4  Arm 5  Arm 6  Arm 7  Arm 8  Arm 9
0      0      0      0      4      2      0      0      0      0      1
1      0      0      6      0      0      0      0      0      0      0
2      0      0      0      0      3      0      0      0      0      0
3      0      0      7      0      2      0      1      5      0      0
4      0      2      0      5      0      0      0      0      0      0
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h2 id="Random-Selection">Random Selection<a class="anchor-link" href="#Random-Selection">&#182;</a></h2><p>In this first part we adopt a simple strategy that involves naively selecting and playing on a random arm each time, independent of the rewards we get.</p>

    </div>
  </div></div>

<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <div class=" alert alert-warning">
<h2 id="Student-Task-A5.1">Student Task A5.1<a class="anchor-link" href="#Student-Task-A5.1">&#182;</a></h2><p>Your task is to implement the Random Selection strategy - selecting a random arm (or action) $a$ at every time step $t$ - by completing the <code>random_selection()</code> function. Our budget is 1000 coins.</p>
</div>

    </div>
  </div></div>

<div id="cell-id=72d79c53" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="comment-cell-545908122b24ea7e"></a><div class="panel-heading"><span class="nbgrader-label">Student's answer</span><span class="pull-right"><a href="#top">(Top)</a></span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Implementing Random Selection </span>
<span class="k">def</span> <span class="nf">random_selection</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    
    <span class="c1"># There are 10 columns in the dataset, one for each arm/machine.</span>
    <span class="c1"># The row count represents the number of times we play, i.e., how many coins we will spend. </span>
    <span class="n">coins</span><span class="p">,</span> <span class="n">arms</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># (1000, 10)</span>
    
    <span class="n">reward_sum_per_arm</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">arms</span>
    <span class="n">selection_count_per_arm</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">arms</span>
    
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">coins</span><span class="p">):</span>
        
        <span class="c1">## Select a random arm (action) among the 10 available arms</span>
        <span class="c1"># a = random. ...</span>
        
        <span class="c1">## Fetch the reward for selecting the given arm (a) at the given time step (t) from the data</span>
        <span class="c1"># reward = data.values[...]</span>
        
        <span class="c1"># YOUR CODE HERE</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">arms</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">reward</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span>
        

        <span class="n">selection_count_per_arm</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">reward_sum_per_arm</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">+=</span> <span class="n">reward</span>

    <span class="k">return</span> <span class="n">reward_sum_per_arm</span><span class="p">,</span> <span class="n">selection_count_per_arm</span>


<span class="c1"># Run the selection algorithm</span>
<span class="n">reward_sum_per_arm</span><span class="p">,</span> <span class="n">selection_count_per_arm</span> <span class="o">=</span> <span class="n">random_selection</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># Print the outcome and some statistics</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total reward using Random Selection: </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">reward_sum_per_arm</span><span class="p">)))</span>

<span class="n">sorted_indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">([</span><span class="o">-</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selection_count_per_arm</span><span class="p">])</span>
<span class="n">tab_data</span> <span class="o">=</span> <span class="p">[[</span><span class="n">indx</span><span class="p">,</span> <span class="n">selection_count_per_arm</span><span class="p">[</span><span class="n">indx</span><span class="p">]]</span> <span class="k">for</span> <span class="n">indx</span> <span class="ow">in</span> <span class="n">sorted_indxs</span><span class="p">]</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Arm&#39;</span><span class="p">,</span> <span class="s1">&#39;Times selected&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">tabulate</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span><span class="n">tab_data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">))</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Total reward using Random Selection: 739

  Arm    Times selected
-----  ----------------
    9               125
    5               108
    4               104
    2               101
    6               101
    8               101
    7                98
    1                92
    0                90
    3                80
</pre>
</div>
</div>

</div>
</div>

</div>
<div id="cell-id=552d33e8" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="cell-0584325e68b31952"></a><div class="panel-heading"><span class="nbgrader-label">Grade cell: <code>cell-0584325e68b31952</code></span>
  <span class="pull-right">
      Score: 1.0 / 1.0 <a href="#top">(Top)</a>
  </span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># this cell is for tests</span>

<span class="c1">### BEGIN HIDDEN TESTS</span>
<span class="c1"># min_reward = 598, max_reward = 985</span>
<span class="n">reward_s_p_a</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">random_selection</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">tot_reward</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">reward_s_p_a</span><span class="p">)</span>
<span class="k">assert</span><span class="p">(</span><span class="mi">550</span> <span class="o">&lt;=</span> <span class="n">tot_reward</span> <span class="o">&lt;=</span> <span class="mi">1000</span><span class="p">)</span>
<span class="c1">### END HIDDEN TESTS</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h2 id="Upper-Confidence-Bound-(UCB)-Selection">Upper Confidence Bound (UCB) Selection<a class="anchor-link" href="#Upper-Confidence-Bound-(UCB)-Selection">&#182;</a></h2><p>Random selection of arms to play on is probably not the optimal approach. To improve our reward we want to use the UCB algorithm to calculate $a_t$ which is the action, or arm, at time $t$ with maximum UCB:
$$a_t = \underset{a\in{A}}{\operatorname{argmax}}\biggr[Q_t(a) + c \sqrt{\frac{\log{t}}{N_t(a)}}\biggr]$$</p>
<br>
Where $Q_t(a)$ is the estimated value of action (arm) $a$ at time step $t$:
$$Q_t(a) = \frac{ \sum_{i=1}^{t-1} R_{i}\mathbf{1}_{A_i = a} }{ \sum_{i=1}^{t-1} \mathbf{1}_{A_i = a} }$$
<br>
$t$ - current time step.<br>
$N_t(a)$ - the number of times that action $a$ has been selected, prior to time $t$.<br>
$c$ - confidence value that controls the level of *exploration* vs *exploitation*. Higher $c$ means higher exploration rate (... of arms that have not been explored much or yielded much reward so far).<br>
$\sum_{i=1}^{t-1} R_{i}\mathbf{1}_{A_i = a}$ - sum of rewards from selecting $a$ up to $t$-1<br>
$\sum_{i=1}^{t-1} \mathbf{1}_{A_i = a}$ - number of times $a$ has been selected up to $t$-1<br>

    </div>
  </div></div>

<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <div class=" alert alert-warning">
<h2 id="Student-Task-A5.2">Student Task A5.2<a class="anchor-link" href="#Student-Task-A5.2">&#182;</a></h2><p>In this assignment your task is to implement the above UCB algorithm, <code>max_ucb_action()</code>. As inputs our function takes $c$, $t$, a list storing the accumulated rewards per arm (<code>reward_sum_per_arm</code>), and a list with informaion about how many times each arm has been selected so far (<code>selection_count_per_arm</code>, this is $\{N_t(A)\}$).
<br><br>
Note, in the beginning the value of $N_t(a)$ will be zero. To avoid the division by zero problem, we can, in those cases, set it to a number that is close to zero, e.g., 1e-100.</p>
</div>

    </div>
  </div></div>

<div id="cell-id=483be6fe" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="comment-cell-a7d2a05e1457eb03"></a><div class="panel-heading"><span class="nbgrader-label">Student's answer</span><span class="pull-right"><a href="#top">(Top)</a></span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Example showing how the input arguments might look like at t = 40.</span>
<span class="c1"># c = 1</span>
<span class="c1"># t = 40</span>
<span class="c1"># reward_sum_per_arm = [0, 12, 0, 2, 1, 0, 0, 0, 0, 0]</span>
<span class="c1"># selection_count_per_arm = [3, 15, 3, 5, 4, 3, 2, 2, 2, 2]</span>

<span class="c1"># reward_sum_per_arm and selection_count_per_arm stores the cummulated values up to the current time step t</span>

<span class="k">def</span> <span class="nf">max_ucb_action</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">reward_sum_per_arm</span><span class="p">,</span> <span class="n">selection_count_per_arm</span><span class="p">):</span>
    <span class="n">arms</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">reward_sum_per_arm</span><span class="p">)</span>
    <span class="n">confidence_per_arm</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">arms</span>
    
    <span class="c1"># In this for-loop we calculate the confidence_per_arm (i.e., action a) at the given time step t</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">arms</span><span class="p">):</span>
        
        <span class="n">Nt</span> <span class="o">=</span> <span class="n">selection_count_per_arm</span><span class="p">[</span><span class="n">a</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">Nt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">Nt</span> <span class="o">=</span> <span class="mf">1e-100</span>  <span class="c1"># To avoid division by zero error</span>
        
        <span class="c1"># Qt = ...</span>
        
        <span class="c1">## NB!: use math.log(t+1) to avoid error with math.log(0)</span>
        <span class="c1"># Ut = ...  </span>
        
        <span class="c1"># confidence_per_arm[a] = ...</span>
        
        
        <span class="c1"># YOUR CODE HERE</span>
        <span class="n">Qt</span> <span class="o">=</span> <span class="n">reward_sum_per_arm</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">/</span> <span class="n">Nt</span>
        <span class="n">Ut</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">Nt</span><span class="p">)</span>
        <span class="n">confidence_per_arm</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">Qt</span> <span class="o">+</span> <span class="n">Ut</span>

    <span class="c1"># Pick the arm/action with the highest upper bound</span>
    <span class="n">max_upper_bound_arm</span> <span class="o">=</span> <span class="n">confidence_per_arm</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">confidence_per_arm</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">max_upper_bound_arm</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

</div>
<div id="cell-id=430fc9d7" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="cell-05d969ea25aaf599"></a><div class="panel-heading"><span class="nbgrader-label">Grade cell: <code>cell-05d969ea25aaf599</code></span>
  <span class="pull-right">
      Score: 2.0 / 2.0 <a href="#top">(Top)</a>
  </span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># this cell is for tests</span>

<span class="c1">### BEGIN HIDDEN TESTS</span>
<span class="n">c_</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">t_</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">reward_sum_per_arm_</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">selection_count_per_arm_</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="k">assert</span><span class="p">(</span><span class="n">max_ucb_action</span><span class="p">(</span><span class="n">c_</span><span class="p">,</span> <span class="n">t_</span><span class="p">,</span> <span class="n">reward_sum_per_arm_</span><span class="p">,</span> <span class="n">selection_count_per_arm_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">6</span><span class="p">)</span>

<span class="n">c_</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">t_</span> <span class="o">=</span> <span class="mi">400</span>
<span class="n">reward_sum_per_arm_</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">220</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">18</span><span class="p">]</span>
<span class="n">selection_count_per_arm_</span> <span class="o">=</span> <span class="p">[</span><span class="mi">13</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">232</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">29</span><span class="p">]</span>
<span class="k">assert</span><span class="p">(</span><span class="n">max_ucb_action</span><span class="p">(</span><span class="n">c_</span><span class="p">,</span> <span class="n">t_</span><span class="p">,</span> <span class="n">reward_sum_per_arm_</span><span class="p">,</span> <span class="n">selection_count_per_arm_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1">### END HIDDEN TESTS</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <div class=" alert alert-warning">
<h2 id="Student-Task-A5.3">Student Task A5.3<a class="anchor-link" href="#Student-Task-A5.3">&#182;</a></h2><p>Now that we have implemented <code>max_ucb_action()</code>, the next thing to do is to implement the function <code>ucb_selection()</code> where we use the UCB selection approach for playing on these 10 one-armed bandits. Our budget is again 1000 coins.</p>
</div>

    </div>
  </div></div>

<div id="cell-id=63a328bd" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="comment-cell-f969fac19bedee18"></a><div class="panel-heading"><span class="nbgrader-label">Student's answer</span><span class="pull-right"><a href="#top">(Top)</a></span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Implementing UCB Selection</span>
<span class="k">def</span> <span class="nf">ucb_selection</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    
    <span class="c1">## Implement this in the same way as the above random_selection() function (from A5.1).</span>
    <span class="c1">## The only exception is that you should now use use max_ucb_action() to select arms </span>
    <span class="c1">## instead of selecting arms at random.</span>
    <span class="c1"># ...</span>
    
    <span class="c1"># YOUR CODE HERE</span>
    <span class="n">coins</span><span class="p">,</span> <span class="n">arms</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">reward_sum_per_arm</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">arms</span>
    <span class="n">selection_count_per_arm</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">arms</span>
    
    
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">coins</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">max_ucb_action</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">reward_sum_per_arm</span><span class="p">,</span> <span class="n">selection_count_per_arm</span><span class="p">)</span>
        <span class="n">reward</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span>
        

        <span class="n">selection_count_per_arm</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">reward_sum_per_arm</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">+=</span> <span class="n">reward</span>
    <span class="k">return</span> <span class="n">reward_sum_per_arm</span><span class="p">,</span> <span class="n">selection_count_per_arm</span>


<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    # There are 10 columns in the dataset, one for each arm/machine.</span>
<span class="sd">    # The row count represents the number of times we play, i.e., how many coins we will spend. </span>
<span class="sd">    coins, arms = data.shape  # (1000, 10)</span>
<span class="sd">    </span>
<span class="sd">    reward_sum_per_arm = [0] * arms</span>
<span class="sd">    selection_count_per_arm = [0] * arms</span>
<span class="sd">    </span>
<span class="sd">    for t in range(0, coins):</span>
<span class="sd">        </span>
<span class="sd">        ## Select a random arm (action) among the 10 available arms</span>
<span class="sd">        # a = random. ...</span>
<span class="sd">        </span>
<span class="sd">        ## Fetch the reward for selecting the given arm (a) at the given time step (t) from the data</span>
<span class="sd">        # reward = data.values[...]</span>
<span class="sd">        </span>
<span class="sd">        # YOUR CODE HERE</span>
<span class="sd">        raise NotImplementedError()</span>
<span class="sd">        </span>
<span class="sd">        selection_count_per_arm[a] += 1</span>
<span class="sd">        reward_sum_per_arm[a] += reward</span>

<span class="sd">    return reward_sum_per_arm, selection_count_per_arm</span>
<span class="sd">    &#39;&#39;&#39;</span>

<span class="c1"># Run the selection algorithm (by default we have set c = 1)</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">reward_sum_per_arm</span><span class="p">,</span> <span class="n">selection_count_per_arm</span> <span class="o">=</span> <span class="n">ucb_selection</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>

<span class="c1"># Sanity check</span>
<span class="k">assert</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">ucb_selection</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1200</span><span class="p">)</span>


<span class="c1"># Print the outcome and some statistics</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Total reward using UCB Selection:&#39;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">reward_sum_per_arm</span><span class="p">))</span>

<span class="n">sorted_indxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">([</span><span class="o">-</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">selection_count_per_arm</span><span class="p">])</span>
<span class="n">tab_data</span> <span class="o">=</span> <span class="p">[[</span><span class="n">indx</span><span class="p">,</span> <span class="n">selection_count_per_arm</span><span class="p">[</span><span class="n">indx</span><span class="p">]]</span> <span class="k">for</span> <span class="n">indx</span> <span class="ow">in</span> <span class="n">sorted_indxs</span><span class="p">]</span>
<span class="n">headers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Arm&#39;</span><span class="p">,</span> <span class="s1">&#39;Times selected&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="n">tabulate</span><span class="o">.</span><span class="n">tabulate</span><span class="p">(</span><span class="n">tab_data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">))</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Total reward using UCB Selection: 1200

  Arm    Times selected
-----  ----------------
    3               874
    9                61
    7                35
    4                 6
    0                 4
    1                 4
    2                 4
    5                 4
    6                 4
    8                 4
</pre>
</div>
</div>

</div>
</div>

</div>
<div id="cell-id=19ab6bbf" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="cell-4b9cc6f50f975e03"></a><div class="panel-heading"><span class="nbgrader-label">Grade cell: <code>cell-4b9cc6f50f975e03</code></span>
  <span class="pull-right">
      Score: 2.0 / 2.0 <a href="#top">(Top)</a>
  </span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># this cell is for tests</span>

<span class="c1">### BEGIN HIDDEN TESTS</span>
<span class="n">c_</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">reward_s_p_a_1_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ucb_selection</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">c_</span><span class="p">)</span>
<span class="k">assert</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">reward_s_p_a_1_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1200</span><span class="p">)</span>

<span class="n">c_</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">reward_s_p_a_2_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">ucb_selection</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">c_</span><span class="p">)</span>
<span class="k">assert</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">reward_s_p_a_2_</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1381</span><span class="p">)</span>
<span class="c1">### END HIDDEN TESTS</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

</div>
<div id="cell-id=1a75c177" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
  </div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h1 id="The-Frozen-Lake-Game-">The Frozen Lake Game <a class="anchor" id="frozen_lake_game" /><a class="anchor-link" href="#The-Frozen-Lake-Game-">&#182;</a></h1><img src="https://debuggirl.files.wordpress.com/2013/03/img_43081.jpg" alt="drawing" width="800"/>
<p>The Frozen Lake game is about safely navigating a frozen lake whose ice happen have several hidden cracks or holes in it, stepping on any of these will result in you falling into the water. The goal is to reach a part of the lake where a hidden treasure is located. Both the weak spots (holes) and the goal are not known beforehand by the player. Here we will train an <em>agent</em> to navigate this lake safely and reach the goal. To do so we will be using the <strong>Q-learning</strong> algorithm. Here we use the <strong>Q-value function</strong> $Q({s, a}) = v$ that takes as input the current state $s$ and possible action $a$, and returns its value $v$. The frozen lake is represented as a grid of cells (gridworld), where each cell is associated with a state that can be start <code>S</code>, frozen lake <code>F</code>, hole in the ice <code>H</code>, or goal <code>G</code>, and the actions available at each state is to navigate <em>left</em>, <em>down</em>, <em>right</em>, or <em>up</em>.<br></p>
<br>
When playing this game the agent will be iteratively doing the following:
1. Choose an action given the current state of the agent (calculate where to move).
2. Perform the chosen action (move to the chosen cell).
3. Upadete the Q-value function (the Q-table) based on the reward from performing this action.
4. Set the new state of the agent.

    </div>
  </div></div>

<div id="cell-id=7e90a5eb" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Import the libraries we will be using</span>
<span class="kn">import</span> <span class="nn">gym</span>  <span class="c1"># gym-0.21.0</span>
<span class="c1">#gymnasium as gym</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">clear_output</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="nb">print</span><span class="p">(</span><span class="n">gym</span><span class="o">.</span><span class="n">__version__</span><span class="p">)</span>

<span class="c1"># Initiate the FrozenLake game</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;FrozenLake-v1&#39;</span><span class="p">,</span> <span class="n">is_slippery</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">map_name</span><span class="o">=</span><span class="s2">&quot;4x4&quot;</span><span class="p">)</span>

<span class="c1"># Next we render the game board</span>
<span class="n">env</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
</pre></div>

    </div>
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ModuleNotFoundError</span>                       Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[9], line 2</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span style="color: rgb(95,135,135)"># Import the libraries we will be using</span>
<span class="ansi-green-fg">----&gt; 2</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span> <span class="ansi-bold" style="color: rgb(0,0,255)">gym</span>  <span style="color: rgb(95,135,135)"># gym-0.21.0</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span style="color: rgb(95,135,135)">#gymnasium as gym</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> <span class="ansi-bold" style="color: rgb(0,135,0)">import</span> <span class="ansi-bold" style="color: rgb(0,0,255)">numpy</span> <span class="ansi-bold" style="color: rgb(0,135,0)">as</span> <span class="ansi-bold" style="color: rgb(0,0,255)">np</span>

<span class="ansi-red-fg">ModuleNotFoundError</span>: No module named &#39;gym&#39;</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <p>After running the above, you should should see the gameboard, i.e. the frozen lake.</p>
<br>
SFFF</br>
FHFH<br>
FFFH<br>
HFFG<br>
<p>It consist of the following cells:</p>
<ul>
<li>S - Start.</li>
<li>F - Frozen lake, which is safe to walk on.</li>
<li>H - Hole in the ice. Reaching this cell ends the round.</li>
<li>G - Goal. Reaching this cell gives +1 point and ends the round.</li>
</ul>
<p>As mentioned, we will now train an agent to navigate this frozen lake and ultimately reach the goal (<code>G</code> cell) with as few steps/turns as possible without falling into the lake (stepping on any of the <code>H</code> cells). At start the agent does not know where the goal is or what cells are safe to walk on. However, with repeated trials, combined with the delayed feedback reward gained from stepping on the various cells, the agent should eventually learn to navigate this lake.</p>

    </div>
  </div></div>

<div id="cell-id=a11f6b3f" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="n">state_space_size</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">observation_space</span><span class="o">.</span><span class="n">n</span>
<span class="n">action_space_size</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">n</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The frozen lake (gameboard) consist of </span><span class="si">{}</span><span class="s1"> states (cells) and </span><span class="si">{}</span><span class="s1"> actions for each of these.&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">state_space_size</span><span class="p">,</span> <span class="n">action_space_size</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;So for each state there are four actions availble:</span><span class="se">\n</span><span class="s1">0 =  left</span><span class="se">\n</span><span class="s1">1 =  down</span><span class="se">\n</span><span class="s1">2 =  right</span><span class="se">\n</span><span class="s1">3 =  up&#39;</span><span class="p">)</span>
</pre></div>

    </div>
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[10], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> state_space_size <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">env</span><span style="color: rgb(98,98,98)">.</span>observation_space<span style="color: rgb(98,98,98)">.</span>n
<span class="ansi-green-intense-fg ansi-bold">      2</span> action_space_size <span style="color: rgb(98,98,98)">=</span> env<span style="color: rgb(98,98,98)">.</span>action_space<span style="color: rgb(98,98,98)">.</span>n
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span style="color: rgb(0,135,0)">print</span>(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">The frozen lake (gameboard) consist of </span><span class="ansi-bold" style="color: rgb(175,95,135)">{}</span><span style="color: rgb(175,0,0)"> states (cells) and </span><span class="ansi-bold" style="color: rgb(175,95,135)">{}</span><span style="color: rgb(175,0,0)"> actions for each of these.</span><span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(98,98,98)">.</span>format(state_space_size, action_space_size))

<span class="ansi-red-fg">NameError</span>: name &#39;env&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h2 id="Q-Table">Q-Table<a class="anchor-link" href="#Q-Table">&#182;</a></h2><p>We will be using a <strong>Q-table</strong> as the underlying representation of the value function (Q-value function). For this type of game board, the Q-table is a well suited representation to use. This table will store all the knowledge gained by the agent - each <em>state</em> will have information about the <em>value</em> of taking any of the available <em>actions</em> (, , , ) when the policy is to find the hidden treasure without falling into the lake. To start with, all the q-values in this table will be zero, but these will be updated as the agent is playing.</p>

    </div>
  </div></div>

<div id="cell-id=b848f4b1" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="n">q_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">state_space_size</span><span class="p">,</span> <span class="n">action_space_size</span><span class="p">))</span>

<span class="c1"># Print some info about it</span>
<span class="n">s</span> <span class="o">=</span> <span class="s1">&#39;Q-table:</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">cr</span> <span class="ow">in</span> <span class="n">q_table</span><span class="p">:</span>
    <span class="n">s</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="si">{}</span><span class="se">\t</span><span class="s1">&lt;-- state [</span><span class="si">{}</span><span class="s1">,</span><span class="si">{}</span><span class="s1">]</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cr</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">&gt;=</span> <span class="n">action_space_size</span><span class="p">:</span>
        <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</pre></div>

    </div>
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[11], line 1</span>
<span class="ansi-green-fg">----&gt; 1</span> q_table <span style="color: rgb(98,98,98)">=</span> np<span style="color: rgb(98,98,98)">.</span>zeros((<span class="ansi-yellow-bg">state_space_size</span>, action_space_size))
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span style="color: rgb(95,135,135)"># Print some info about it</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> s <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">Q-table:</span><span class="ansi-bold" style="color: rgb(175,95,0)">\n</span><span style="color: rgb(175,0,0)">&#39;</span>

<span class="ansi-red-fg">NameError</span>: name &#39;state_space_size&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <p>With an empty Q-table the agent do not know anything about what actions are better than others. In other words, the Q-value function will always return zero for every possible action at each state. Thus in the beginning the agent will instead be taking random actions while exploring the board. This is called <em>exploration</em>. However, after having gained some knowledge about the board, the agent can start relying on the experience gained and reflected in the Q-value function. This is called <em>exploitation</em>. We will be using the <em>epsilon greedy strategy</em> to find a balance between <em>exploration</em> (random actions) and <em>exploitation</em> (optional actions according to the Q-value function).</p>

    </div>
  </div></div>

<div id="cell-id=b62e5b02" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Here we introduce some parameters to use in the Q-training algorithm.</span>

<span class="c1"># Learning rate (value between 0 and 1)</span>
<span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="c1"># Reward discount used in the Bellman equation (value between 0 and 1)</span>
<span class="n">discount_factor</span> <span class="o">=</span> <span class="mf">0.99</span>
</pre></div>

    </div>
  </div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h2 id="The-Bellman-Equation">The Bellman Equation<a class="anchor-link" href="#The-Bellman-Equation">&#182;</a></h2><p>For updating a state in the Q-table we will here be using the following version of the <em>Bellman equation</em>:<br>
$$Q^{updated}(s_{t}, a_{t}) := (1-\alpha)Q(s_{t}, a_{t}) + \alpha (r_{t} + \gamma \underset{a}{\max}Q(s_{t+1},a))$$
$s_{t}$ - current state.<br>
$a_{t}$ - chosen action.<br>
$\alpha$ - learning rate.<br>
$r_{t}$ - reward from taking the action $a_{t}$.<br>
$\gamma$ - discount factor.<br>
$s_{t+1}$ - new state after taking action $a_{t}$.<br>
$\underset{a}{\max}Q(s_{t+1},a)$ - the optional value possible from $s_{t+1}$.<br></p>

    </div>
  </div></div>

<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <div class=" alert alert-warning">
<h2 id="Student-Task-A5.4">Student Task A5.4<a class="anchor-link" href="#Student-Task-A5.4">&#182;</a></h2><p><strong><i><u>Your task<i></u></strong> is to implement the Bellman equation in <code>q_update()</code> that calculates and returns the new value for $Q^{updated}(s_{t}, a_{t})$.<br>It takes as input: Q-table, $s_{t}$, $a_{t}$, $s_{t+1}$, $r_{t}$, $\alpha$, and $\gamma$.</p>
</div>

    </div>
  </div></div>

<div id="cell-id=e1915777" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="comment-cell-4b8c88159a873820"></a><div class="panel-heading"><span class="nbgrader-label">Student's answer</span><span class="pull-right"><a href="#top">(Top)</a></span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">q_update</span><span class="p">(</span><span class="n">q_table</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">new_state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">,</span> <span class="n">discount_factor</span><span class="p">):</span>
    <span class="c1"># Calculate the new value in the q_table using Bellman equation</span>

    <span class="c1">## Implement the Bellman equation as shown above</span>
    <span class="c1"># q_new = q_table[state, action] * ...</span>
    
    <span class="c1"># YOUR CODE HERE</span>
    <span class="n">current_q</span> <span class="o">=</span> <span class="n">q_table</span><span class="p">[</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">]</span>
    <span class="n">max_q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">q_table</span><span class="p">[</span><span class="n">new_state</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">q_new</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">learning_rate</span><span class="p">)</span> <span class="o">*</span> <span class="n">current_q</span> <span class="o">+</span> <span class="n">learning_rate</span> <span class="o">*</span> <span class="p">(</span><span class="n">reward</span> <span class="o">+</span> <span class="n">discount_factor</span> <span class="o">*</span> <span class="n">max_q</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">q_new</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

</div>
<div id="cell-id=7dc8915d" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[14]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="cell-789d006652c57c07"></a><div class="panel-heading"><span class="nbgrader-label">Grade cell: <code>cell-789d006652c57c07</code></span>
  <span class="pull-right">
      Score: 0.0 / 1.0 <a href="#top">(Top)</a>
  </span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># this cell is for tests</span>

<span class="c1">### BEGIN HIDDEN TESTS</span>
<span class="c1"># Should this test be improved somehow?</span>
<span class="k">assert</span> <span class="n">q_update</span><span class="p">(</span><span class="n">q_table</span><span class="o">=</span><span class="n">q_table</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_state</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">reward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">,</span> <span class="n">discount_factor</span><span class="o">=</span><span class="n">discount_factor</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0.0</span>
<span class="k">assert</span> <span class="n">q_update</span><span class="p">(</span><span class="n">q_table</span><span class="o">=</span><span class="n">q_table</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_state</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">reward</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">,</span> <span class="n">discount_factor</span><span class="o">=</span><span class="n">discount_factor</span><span class="p">)</span> <span class="o">==</span> <span class="mf">0.1</span>

<span class="n">test_q_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.58940116</span><span class="p">,</span> <span class="mf">0.50458308</span><span class="p">,</span> <span class="mf">0.50449804</span><span class="p">,</span> <span class="mf">0.50430707</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.39701686</span><span class="p">,</span> <span class="mf">0.31072888</span><span class="p">,</span> <span class="mf">0.32279088</span><span class="p">,</span> <span class="mf">0.52844835</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.40813145</span><span class="p">,</span> <span class="mf">0.43028301</span><span class="p">,</span> <span class="mf">0.41980598</span><span class="p">,</span> <span class="mf">0.4987701</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.34803986</span><span class="p">,</span> <span class="mf">0.31594787</span><span class="p">,</span> <span class="mf">0.31342393</span><span class="p">,</span> <span class="mf">0.47886813</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.6137157</span><span class="p">,</span> <span class="mf">0.39051021</span><span class="p">,</span> <span class="mf">0.33313007</span><span class="p">,</span> <span class="mf">0.40253577</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span>        <span class="p">],</span>
                <span class="p">[</span><span class="mf">0.45621221</span><span class="p">,</span> <span class="mf">0.157744</span><span class="p">,</span>  <span class="mf">0.16167418</span><span class="p">,</span> <span class="mf">0.15956471</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span>        <span class="p">],</span>
                <span class="p">[</span><span class="mf">0.40419588</span><span class="p">,</span> <span class="mf">0.44695664</span><span class="p">,</span> <span class="mf">0.49716483</span><span class="p">,</span> <span class="mf">0.66166421</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.48304007</span><span class="p">,</span> <span class="mf">0.70040278</span><span class="p">,</span> <span class="mf">0.43290747</span><span class="p">,</span> <span class="mf">0.42981004</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.68873522</span><span class="p">,</span> <span class="mf">0.45787092</span><span class="p">,</span> <span class="mf">0.36492453</span><span class="p">,</span> <span class="mf">0.39246048</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span>        <span class="p">],</span>
                <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span>        <span class="p">],</span>
                <span class="p">[</span><span class="mf">0.45736412</span><span class="p">,</span> <span class="mf">0.66062829</span><span class="p">,</span> <span class="mf">0.80533251</span><span class="p">,</span> <span class="mf">0.59763036</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.7685619</span><span class="p">,</span>  <span class="mf">0.9257641</span><span class="p">,</span>  <span class="mf">0.77140422</span><span class="p">,</span> <span class="mf">0.75617869</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span>        <span class="p">]])</span>
<span class="k">assert</span> <span class="mf">0.5</span> <span class="o">&lt;=</span> <span class="n">q_update</span><span class="p">(</span><span class="n">q_table</span><span class="o">=</span><span class="n">test_q_table</span><span class="p">,</span> <span class="n">state</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">new_state</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span> <span class="n">reward</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">,</span> <span class="n">discount_factor</span><span class="o">=</span><span class="n">discount_factor</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.6</span> <span class="c1"># == 0.51678822222</span>
<span class="c1">### END HIDDEN TESTS</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[14], line 5</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span style="color: rgb(95,135,135)"># this cell is for tests</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> 
<span class="ansi-green-intense-fg ansi-bold">      3</span> <span style="color: rgb(95,135,135)">### BEGIN HIDDEN TESTS</span>
<span class="ansi-green-intense-fg ansi-bold">      4</span> <span style="color: rgb(95,135,135)"># Should this test be improved somehow?</span>
<span class="ansi-green-fg">----&gt; 5</span> <span class="ansi-bold" style="color: rgb(0,135,0)">assert</span> q_update(q_table<span style="color: rgb(98,98,98)">=</span><span class="ansi-yellow-bg">q_table</span>, state<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">0</span>, action<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">2</span>, new_state<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">1</span>, reward<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">0</span>, learning_rate<span style="color: rgb(98,98,98)">=</span>learning_rate, discount_factor<span style="color: rgb(98,98,98)">=</span>discount_factor) <span style="color: rgb(98,98,98)">==</span> <span style="color: rgb(98,98,98)">0.0</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> <span class="ansi-bold" style="color: rgb(0,135,0)">assert</span> q_update(q_table<span style="color: rgb(98,98,98)">=</span>q_table, state<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">0</span>, action<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">2</span>, new_state<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">1</span>, reward<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(98,98,98)">1</span>, learning_rate<span style="color: rgb(98,98,98)">=</span>learning_rate, discount_factor<span style="color: rgb(98,98,98)">=</span>discount_factor) <span style="color: rgb(98,98,98)">==</span> <span style="color: rgb(98,98,98)">0.1</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span> test_q_table <span style="color: rgb(98,98,98)">=</span> np<span style="color: rgb(98,98,98)">.</span>array([[<span style="color: rgb(98,98,98)">0.58940116</span>, <span style="color: rgb(98,98,98)">0.50458308</span>, <span style="color: rgb(98,98,98)">0.50449804</span>, <span style="color: rgb(98,98,98)">0.50430707</span>],
<span class="ansi-green-intense-fg ansi-bold">      9</span>                 [<span style="color: rgb(98,98,98)">0.39701686</span>, <span style="color: rgb(98,98,98)">0.31072888</span>, <span style="color: rgb(98,98,98)">0.32279088</span>, <span style="color: rgb(98,98,98)">0.52844835</span>],
<span class="ansi-green-intense-fg ansi-bold">     10</span>                 [<span style="color: rgb(98,98,98)">0.40813145</span>, <span style="color: rgb(98,98,98)">0.43028301</span>, <span style="color: rgb(98,98,98)">0.41980598</span>, <span style="color: rgb(98,98,98)">0.4987701</span>],
<span class="ansi-green-fg">   (...)</span>
<span class="ansi-green-intense-fg ansi-bold">     22</span>                 [<span style="color: rgb(98,98,98)">0.7685619</span>,  <span style="color: rgb(98,98,98)">0.9257641</span>,  <span style="color: rgb(98,98,98)">0.77140422</span>, <span style="color: rgb(98,98,98)">0.75617869</span>],
<span class="ansi-green-intense-fg ansi-bold">     23</span>                 [<span style="color: rgb(98,98,98)">0.</span>,         <span style="color: rgb(98,98,98)">0.</span>,         <span style="color: rgb(98,98,98)">0.</span>,         <span style="color: rgb(98,98,98)">0.</span>        ]])

<span class="ansi-red-fg">NameError</span>: name &#39;q_table&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div id="cell-id=374604c2" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># For the mentioned epsilon greedy strategy we will need a few more parameters.</span>

<span class="c1"># Upper bound for the exploration rate (value between 0 and 1)</span>
<span class="n">max_exploration_rate</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># Lower bound for the exploration rate (value between 0 and 1)</span>
<span class="n">min_exploration_rate</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="c1"># How much the exploration rate decays per episode (down to the min_exploration_rate, value between 0 and 1).</span>
<span class="n">exploration_decay_rate</span> <span class="o">=</span> <span class="mf">0.001</span>
</pre></div>

    </div>
  </div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h2 id="Epsilon-Greedy-Strategy">Epsilon Greedy Strategy<a class="anchor-link" href="#Epsilon-Greedy-Strategy">&#182;</a></h2><p>By using the <em>epsilon greedy strategy</em>, we will let the exploration rate start high (1), and then decrease for every episode with exponential decay. The goal here is to find the optimal balance between exploration and exploitation. Each round will consist of 10000 episodes. In the first episodes we want to have a high probility of performing exploration actions to avoid getting stuck in sub-optimal paths (local maximums). However, we want to gradually start leaning more towards exploitation towards the later episodes.<br></p>
<br>
We will be using the following formula for calculating the exploration rate for a given episode $\epsilon(i)$:<br>
$$\epsilon(i) = \epsilon_{min} + (\epsilon_{max} - \epsilon_{min}) \cdot e^{-\zeta \cdot i}$$
$\epsilon$ - exploration rate.<br>
$i$ - episode number.<br>
$\epsilon_{min}$ - min exploration rate.<br>
$\epsilon_{max}$ - max exploration rate.<br>
$\zeta$ - exploration decay rate.<br>

    </div>
  </div></div>

<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <div class=" alert alert-warning">
<h2 id="Student-Task-A5.5">Student Task A5.5<a class="anchor-link" href="#Student-Task-A5.5">&#182;</a></h2><p>Implement the <code>calc_exploration_rate()</code> function which calculates and returns the exploration rate using the above formula.</p>
</div>

    </div>
  </div></div>

<div id="cell-id=210d77f4" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="comment-cell-2d10be506d65f993"></a><div class="panel-heading"><span class="nbgrader-label">Student's answer</span><span class="pull-right"><a href="#top">(Top)</a></span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Function that calculate the exploration rate for a given episode</span>
<span class="k">def</span> <span class="nf">calc_exploration_rate</span><span class="p">(</span><span class="n">episode</span><span class="p">,</span> <span class="n">min_exploration_rate</span><span class="p">,</span> <span class="n">max_exploration_rate</span><span class="p">,</span> <span class="n">exploration_decay_rate</span><span class="p">):</span>
    <span class="c1">## Calculate the exploration rate</span>
    <span class="c1"># exploration_rate = ...</span>
    
    <span class="c1"># YOUR CODE HERE</span>
    <span class="n">exploration_rate</span> <span class="o">=</span> <span class="n">min_exploration_rate</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_exploration_rate</span> <span class="o">-</span> <span class="n">min_exploration_rate</span><span class="p">)</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">exploration_decay_rate</span> <span class="o">*</span> <span class="n">episode</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">exploration_rate</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

</div>
<div id="cell-id=df34e84c" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="cell-307f265b7d244b66"></a><div class="panel-heading"><span class="nbgrader-label">Grade cell: <code>cell-307f265b7d244b66</code></span>
  <span class="pull-right">
      Score: 1.0 / 1.0 <a href="#top">(Top)</a>
  </span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># this cell is for tests</span>

<span class="c1">### BEGIN HIDDEN TESTS</span>
<span class="k">assert</span> <span class="mf">0.03</span> <span class="o">&lt;=</span> <span class="n">calc_exploration_rate</span><span class="p">(</span><span class="mi">700</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.04</span>  <span class="c1"># == 0.0398954095880953</span>
<span class="k">assert</span> <span class="mf">0.55</span> <span class="o">&lt;=</span> <span class="n">calc_exploration_rate</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.005</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mf">0.65</span>  <span class="c1"># == 0.6104653531155071</span>
<span class="c1">### END HIDDEN TESTS</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <div class=" alert alert-warning">
<h2 id="Student-Task-A5.6">Student Task A5.6<a class="anchor-link" href="#Student-Task-A5.6">&#182;</a></h2><p>Next we will make the function for choosing an action given a state. This function includes an <em>exploration rate threshold</em> which is a randomly drawn number between 0 and 1. For every action, this thershold makes the agent perform an exploration action with a probability equal to the given <em>exploration rate</em>.</p>
<br>
<strong><i><u>Your task<i></u></strong> is to complete the below function `choose_action()`. This function takes as input the Q-table, current state $s_{t}$, and exploration rate $\epsilon$. It should return an integer reflecting the chosen action (from the set {0, 1, 2, 3}).
</div>

    </div>
  </div></div>

<div id="cell-id=3f932326" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[18]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="comment-cell-188c8ae072cecd71"></a><div class="panel-heading"><span class="nbgrader-label">Student's answer</span><span class="pull-right"><a href="#top">(Top)</a></span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">choose_action</span><span class="p">(</span><span class="n">q_table</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">exploration_rate</span><span class="p">):</span>
    
    <span class="c1">## 1. Pick a random number between 0 and 1</span>
    <span class="c1"># exploration_rate_threshold = ...</span>
    
    <span class="n">exploration_rate_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1">## 2. Exploration vs exploitation</span>
    <span class="k">if</span> <span class="n">exploration_rate</span> <span class="o">&gt;</span> <span class="n">exploration_rate_threshold</span> <span class="ow">or</span> <span class="nb">sum</span><span class="p">(</span><span class="n">q_table</span><span class="p">[</span><span class="n">state</span><span class="p">,</span> <span class="p">:])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1">## Exploration, i.e., random action </span>
        <span class="c1"># action = ...</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">q_table</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1">## Exploitation, i.e., perform the optimal action at this state according to the Q-table</span>
        <span class="c1"># action = ...</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">q_table</span><span class="p">[</span><span class="n">state</span><span class="p">,</span> <span class="p">:])</span>
        

    <span class="k">return</span> <span class="n">action</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

</div>
<div id="cell-id=5411b02b" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[19]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="cell-c5bab8432aab8bc7"></a><div class="panel-heading"><span class="nbgrader-label">Grade cell: <code>cell-c5bab8432aab8bc7</code></span>
  <span class="pull-right">
      Score: 2.0 / 2.0 <a href="#top">(Top)</a>
  </span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># this cell is for tests</span>

<span class="c1">### BEGIN HIDDEN TESTS</span>
<span class="n">test_q_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mf">0.58940116</span><span class="p">,</span> <span class="mf">0.50458308</span><span class="p">,</span> <span class="mf">0.50449804</span><span class="p">,</span> <span class="mf">0.50430707</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.39701686</span><span class="p">,</span> <span class="mf">0.31072888</span><span class="p">,</span> <span class="mf">0.32279088</span><span class="p">,</span> <span class="mf">0.52844835</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.40813145</span><span class="p">,</span> <span class="mf">0.43028301</span><span class="p">,</span> <span class="mf">0.41980598</span><span class="p">,</span> <span class="mf">0.4987701</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.34803986</span><span class="p">,</span> <span class="mf">0.31594787</span><span class="p">,</span> <span class="mf">0.31342393</span><span class="p">,</span> <span class="mf">0.47886813</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.6137157</span><span class="p">,</span> <span class="mf">0.39051021</span><span class="p">,</span> <span class="mf">0.33313007</span><span class="p">,</span> <span class="mf">0.40253577</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span>        <span class="p">],</span>
                <span class="p">[</span><span class="mf">0.45621221</span><span class="p">,</span> <span class="mf">0.157744</span><span class="p">,</span>  <span class="mf">0.16167418</span><span class="p">,</span> <span class="mf">0.15956471</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span>        <span class="p">],</span>
                <span class="p">[</span><span class="mf">0.40419588</span><span class="p">,</span> <span class="mf">0.44695664</span><span class="p">,</span> <span class="mf">0.49716483</span><span class="p">,</span> <span class="mf">0.66166421</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.48304007</span><span class="p">,</span> <span class="mf">0.70040278</span><span class="p">,</span> <span class="mf">0.43290747</span><span class="p">,</span> <span class="mf">0.42981004</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.68873522</span><span class="p">,</span> <span class="mf">0.45787092</span><span class="p">,</span> <span class="mf">0.36492453</span><span class="p">,</span> <span class="mf">0.39246048</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span>        <span class="p">],</span>
                <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span>        <span class="p">],</span>
                <span class="p">[</span><span class="mf">0.45736412</span><span class="p">,</span> <span class="mf">0.66062829</span><span class="p">,</span> <span class="mf">0.80533251</span><span class="p">,</span> <span class="mf">0.59763036</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.7685619</span><span class="p">,</span>  <span class="mf">0.9257641</span><span class="p">,</span>  <span class="mf">0.77140422</span><span class="p">,</span> <span class="mf">0.75617869</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span><span class="p">,</span>         <span class="mf">0.</span>        <span class="p">]])</span>

<span class="n">action_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">i_action</span> <span class="o">=</span> <span class="n">choose_action</span><span class="p">(</span><span class="n">test_q_table</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">action_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i_action</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">action_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">action_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">action_list</span><span class="p">)</span>

<span class="n">action_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">i_action</span> <span class="o">=</span> <span class="n">choose_action</span><span class="p">(</span><span class="n">test_q_table</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">action_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i_action</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="o">==</span> <span class="n">action_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">action_list</span><span class="p">)</span>
<span class="c1">### END HIDDEN TESTS</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h2 id="Q-Learning-Algorithm">Q-Learning Algorithm<a class="anchor-link" href="#Q-Learning-Algorithm">&#182;</a></h2><p>Now it is time to train our agent using the Q-learning algorithm as shown below.
If everything works as intended, the below code should print some statistics from the training.</p>

    </div>
  </div></div>

<div id="cell-id=37d85fe0" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[20]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Number of episodes to train</span>
<span class="n">num_episodes</span> <span class="o">=</span> <span class="mi">10000</span>

<span class="c1"># Max number of steps before ending the round</span>
<span class="n">max_steps_per_episode</span> <span class="o">=</span> <span class="mi">100</span>
</pre></div>

    </div>
  </div>
</div>

</div>
<div id="cell-id=0803db2f" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[21]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Q-learning function</span>
<span class="k">def</span> <span class="nf">train_q_learn</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">q_table</span><span class="p">):</span>
    
    <span class="c1"># Q-Learning algorithm</span>
    <span class="n">rewards_all_episodes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">steps_all_episodes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">exploration_rate</span> <span class="o">=</span> <span class="n">max_exploration_rate</span>

    <span class="c1"># Play the game for n episodes</span>
    <span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_episodes</span><span class="p">):</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
        <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">rewards_current_episode</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">steps_current_episode</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_steps_per_episode</span><span class="p">):</span>
            <span class="c1"># Chooce an action. Exploration vs exploitation trade-off with the epsilon greedy strategy</span>
            <span class="n">action</span> <span class="o">=</span> <span class="n">choose_action</span><span class="p">(</span><span class="n">q_table</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">exploration_rate</span><span class="p">)</span>

            <span class="c1"># Perform the chosen action</span>
            <span class="n">new_state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

            <span class="c1"># Upadete the Q-table</span>
            <span class="n">q_table</span><span class="p">[</span><span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">]</span> <span class="o">=</span> <span class="n">q_update</span><span class="p">(</span><span class="n">q_table</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">new_state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">,</span> <span class="n">discount_factor</span><span class="p">)</span>

            <span class="c1"># Set the new state</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">new_state</span>

            <span class="c1"># Collect some statistics</span>
            <span class="n">rewards_current_episode</span> <span class="o">+=</span> <span class="n">reward</span>
            <span class="n">steps_current_episode</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="k">if</span> <span class="n">done</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
                <span class="k">break</span>

        <span class="c1"># Update the exploration rate</span>
        <span class="n">exploration_rate</span> <span class="o">=</span> <span class="n">calc_exploration_rate</span><span class="p">(</span><span class="n">episode</span><span class="p">,</span> <span class="n">min_exploration_rate</span><span class="p">,</span> <span class="n">max_exploration_rate</span><span class="p">,</span> <span class="n">exploration_decay_rate</span><span class="p">)</span>

        <span class="n">rewards_all_episodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rewards_current_episode</span><span class="p">)</span>
        <span class="n">steps_all_episodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">steps_current_episode</span><span class="p">)</span>


    <span class="c1"># Print the average rewards</span>
    <span class="n">rewards_per_thousand_episodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rewards_all_episodes</span><span class="p">),</span> <span class="n">num_episodes</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">steps_per_thousand_episodes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">steps_all_episodes</span><span class="p">),</span> <span class="n">num_episodes</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Training results, average reward and steps per thousand episodes:&#39;</span><span class="p">)</span>
    <span class="n">count</span> <span class="o">=</span> <span class="mi">1000</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rewards_per_thousand_episodes</span><span class="p">):</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">rewards_per_thousand_episodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">s</span> <span class="o">=</span> <span class="n">steps_per_thousand_episodes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">: rewards </span><span class="si">{:.4}</span><span class="s1">, steps </span><span class="si">{:.4}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">count</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">r</span><span class="o">/</span><span class="mi">1000</span><span class="p">),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">s</span><span class="o">/</span><span class="mi">1000</span><span class="p">)))</span>
        <span class="n">count</span> <span class="o">+=</span> <span class="mi">1000</span>
    <span class="k">return</span> <span class="n">q_table</span>
</pre></div>

    </div>
  </div>
</div>

</div>
<div id="cell-id=577d21b7" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[22]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Run the train_q_learn function</span>
<span class="n">q_table</span> <span class="o">=</span> <span class="n">train_q_learn</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">q_table</span><span class="p">)</span>
</pre></div>

    </div>
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[22], line 2</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span style="color: rgb(95,135,135)"># Run the train_q_learn function</span>
<span class="ansi-green-fg">----&gt; 2</span> q_table <span style="color: rgb(98,98,98)">=</span> train_q_learn(<span class="ansi-yellow-bg">env</span>, q_table)

<span class="ansi-red-fg">NameError</span>: name &#39;env&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div id="cell-id=7344263d" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[23]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Trained Q-table:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">q_table</span><span class="p">)</span>
</pre></div>

    </div>
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Trained Q-table:
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[23], line 2</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span style="color: rgb(0,135,0)">print</span>(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">Trained Q-table:</span><span style="color: rgb(175,0,0)">&#39;</span>)
<span class="ansi-green-fg">----&gt; 2</span> <span style="color: rgb(0,135,0)">print</span>(<span class="ansi-yellow-bg">q_table</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;q_table&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h2 id="Playing-Frozen-Lake">Playing Frozen Lake<a class="anchor-link" href="#Playing-Frozen-Lake">&#182;</a></h2><p>Finally we will let the agent play Frozen Lake using the Q-table that we have learned above.</p>

    </div>
  </div></div>

<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <div class=" alert alert-warning">
<h2 id="Student-Task-A5.7">Student Task A5.7<a class="anchor-link" href="#Student-Task-A5.7">&#182;</a></h2><p>Now we are ready to put the agent to navigate the frozen lake based on what it has learned. By simply looking at the Q-table, maybe you can already see what route the agent will be taking?<br><br>
<strong><i><u>Your task<i></u></strong> is to run the below code and observe how the agent is navigating the frozen lake. Observe the learned Q-table to understand why the agent is taking this specific path.</p>
</div>

    </div>
  </div></div>

<div id="cell-id=3849f1a8" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[24]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">run_check</span><span class="p">():</span>
    <span class="n">nbgrader_exec_env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBGRADER_EXECUTION&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nbgrader_exec_env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">nbgrader_exec_env</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;autograde&#39;</span><span class="p">,</span> <span class="s1">&#39;validate&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>

<span class="c1"># Defining the run_agent function</span>
<span class="k">def</span> <span class="nf">run_agent</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">q_table</span><span class="p">):</span>
    <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
    <span class="n">env</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">run_check</span><span class="p">():</span>
        <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># Watch the agent play for a few rounds using the learned Q-table</span>
        <span class="n">n_rounds</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">for</span> <span class="n">episode</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_rounds</span><span class="p">):</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
            <span class="n">done</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; EPISODE </span><span class="si">{}</span><span class="s1"> &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">episode</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_steps_per_episode</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
                <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                <span class="n">env</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>

                <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">q_table</span><span class="p">[</span><span class="n">state</span><span class="p">,</span> <span class="p">:])</span>
                
                <span class="n">new_state</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">done</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
                    <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="n">env</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">reward</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; You reached the goal after </span><span class="si">{}</span><span class="s1"> steps! &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">step</span> <span class="o">==</span> <span class="n">max_steps_per_episode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; No steps left (</span><span class="si">{}</span><span class="s1"> steps max)! &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; You fell through a hole after </span><span class="si">{}</span><span class="s1"> steps! &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                    <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">elif</span> <span class="n">step</span> <span class="o">==</span> <span class="n">max_steps_per_episode</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; No steps left (</span><span class="si">{}</span><span class="s1"> steps max)! &#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">step</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
                    <span class="n">clear_output</span><span class="p">(</span><span class="n">wait</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="n">state</span> <span class="o">=</span> <span class="n">new_state</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39; Done &#39;</span><span class="p">)</span>
        <span class="n">env</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>

    </div>
  </div>
</div>

</div>
<div id="cell-id=968397e4" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[25]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Run the run_agent function with the trained Q-table</span>
<span class="n">run_agent</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="n">q_table</span><span class="p">)</span>
</pre></div>

    </div>
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[25], line 2</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span style="color: rgb(95,135,135)"># Run the run_agent function with the trained Q-table</span>
<span class="ansi-green-fg">----&gt; 2</span> run_agent(<span class="ansi-yellow-bg">env</span>, q_table)

<span class="ansi-red-fg">NameError</span>: name &#39;env&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h2 id="The-Ice-Can-Get-Slippery!">The Ice Can Get Slippery!<a class="anchor-link" href="#The-Ice-Can-Get-Slippery!">&#182;</a></h2><p><img src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS7iaMa5OcNHtJFKB1fZo_EvG-nQyPPTm_fsA&amp;usqp=CAU" alt="Slippery ice" title="Slippery ice" /></p>
<p>So far the ice has been easy to walk on, and we have seen that the agent has not had any problem in finding an optimal path leading to the goal. Now, however, the weather has changed and the ice has suddenly become very slippery.
In the next part of this exercise we have defined the frozen lake as:<br>
<code>env_frozen = gym.make('FrozenLake-v1', is_slippery=False, map_name=&quot;4x4&quot;)</code><br>
<code>is_slippery=True</code> means that there is only a 1/3 chance that the agent will move in the intended 
direction, and 2/3 chance to move in one of the perpendicular directions (1/3 and 1/3). 
E.g., if <strong>action = left</strong>, then:</p>
<ul>
<li>P(move left) = 1/3</li>
<li>P(move up) = 1/3</li>
<li>P(move down) = 1/3</li>
</ul>

    </div>
  </div></div>

<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <div class=" alert alert-warning">
<h2 id="Student-Task-A5.8a">Student Task A5.8a<a class="anchor-link" href="#Student-Task-A5.8a">&#182;</a></h2><p>First run the Q-Learning algorithm below and observe how the new trained Q-table looks like, and how the new statistics has become. Also observe how the behaviour of the agent has changed at run time.</p>
<h2 id="Student-Task-A5.8b">Student Task A5.8b<a class="anchor-link" href="#Student-Task-A5.8b">&#182;</a></h2><p>Next we want you to briefly explore the impact of different values assigned to the different parameters, and try to find the most promising values that optimize the reward gained by the agent (look at the scores from the last 1000 episodes).
The parameters in question are:</p>
<ul>
<li>learning_rate ($\alpha$)</li>
<li>discount_factor ($\gamma$)</li>
<li>max_exploration_rate ($\epsilon_{max}$)</li>
<li>min_exploration_rate ($\epsilon_{min}$)</li>
<li>exploration_decay_rate ($\zeta$)</li>
</ul>
<p><u>Be prepared to discuss your findings with your colleges and/or teaching assistants.</u><br>
Some additional things to think about: Why is the preferred first move of the agent to move left? Can you think of some possible approaches and strategies that could improve the performance of the agent further? Can you think of some completely different ways for how to solve this game/problem?</p>
</div>

    </div>
  </div></div>

<div id="cell-id=b36984fb" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[26]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Initiate the FrozenLake game with slippery ice</span>
<span class="n">env_slippery</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s1">&#39;FrozenLake-v1&#39;</span><span class="p">,</span> <span class="n">is_slippery</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">map_name</span><span class="o">=</span><span class="s2">&quot;4x4&quot;</span><span class="p">)</span>


<span class="c1">## Parameters used by the Q-training algorithm</span>

<span class="c1"># Learning rate (value between 0 and 1)</span>
<span class="n">learning_rate</span> <span class="o">=</span> <span class="mf">0.1</span>

<span class="c1"># Reward discount used in the Bellman equation (value between 0 and 1)</span>
<span class="n">discount_factor</span> <span class="o">=</span> <span class="mf">0.99</span>

<span class="c1"># Upper bound for the exploration rate (value between 0 and 1)</span>
<span class="n">max_exploration_rate</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># Lower bound for the exploration rate (value between 0 and 1)</span>
<span class="n">min_exploration_rate</span> <span class="o">=</span> <span class="mf">0.01</span>

<span class="c1"># How much the exploration rate decays per episode (down to the min_exploration_rate, value between 0 and 1).</span>
<span class="n">exploration_decay_rate</span> <span class="o">=</span> <span class="mf">0.001</span>


<span class="c1"># Train the agent to navigate the slippery ice</span>
<span class="n">q_table_slippery</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">env</span><span class="o">.</span><span class="n">observation_space</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">env</span><span class="o">.</span><span class="n">action_space</span><span class="o">.</span><span class="n">n</span><span class="p">))</span>
<span class="k">if</span> <span class="n">run_check</span><span class="p">():</span>
    <span class="n">q_table_slippery</span> <span class="o">=</span> <span class="n">train_q_learn</span><span class="p">(</span><span class="n">env_slippery</span><span class="p">,</span> <span class="n">q_table_slippery</span><span class="p">)</span>
</pre></div>

    </div>
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[26], line 2</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span style="color: rgb(95,135,135)"># Initiate the FrozenLake game with slippery ice</span>
<span class="ansi-green-fg">----&gt; 2</span> env_slippery <span style="color: rgb(98,98,98)">=</span> <span class="ansi-yellow-bg">gym</span><span style="color: rgb(98,98,98)">.</span>make(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">FrozenLake-v1</span><span style="color: rgb(175,0,0)">&#39;</span>, is_slippery<span style="color: rgb(98,98,98)">=</span><span class="ansi-bold" style="color: rgb(0,135,0)">True</span>, map_name<span style="color: rgb(98,98,98)">=</span><span style="color: rgb(175,0,0)">&#34;</span><span style="color: rgb(175,0,0)">4x4</span><span style="color: rgb(175,0,0)">&#34;</span>)
<span class="ansi-green-intense-fg ansi-bold">      5</span> <span style="color: rgb(95,135,135)">## Parameters used by the Q-training algorithm</span>
<span class="ansi-green-intense-fg ansi-bold">      6</span> 
<span class="ansi-green-intense-fg ansi-bold">      7</span> <span style="color: rgb(95,135,135)"># Learning rate (value between 0 and 1)</span>
<span class="ansi-green-intense-fg ansi-bold">      8</span> learning_rate <span style="color: rgb(98,98,98)">=</span> <span style="color: rgb(98,98,98)">0.1</span>

<span class="ansi-red-fg">NameError</span>: name &#39;gym&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div id="cell-id=0d794daa" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[27]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Trained slippery Q-table:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">q_table_slippery</span><span class="p">)</span>
</pre></div>

    </div>
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Trained slippery Q-table:
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[27], line 2</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span style="color: rgb(0,135,0)">print</span>(<span style="color: rgb(175,0,0)">&#39;</span><span style="color: rgb(175,0,0)">Trained slippery Q-table:</span><span style="color: rgb(175,0,0)">&#39;</span>)
<span class="ansi-green-fg">----&gt; 2</span> <span style="color: rgb(0,135,0)">print</span>(<span class="ansi-yellow-bg">q_table_slippery</span>)

<span class="ansi-red-fg">NameError</span>: name &#39;q_table_slippery&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div id="cell-id=274422be" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[28]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Run the agent to see how the agent now navigates the slippery ice.</span>
<span class="n">run_agent</span><span class="p">(</span><span class="n">env_slippery</span><span class="p">,</span> <span class="n">q_table_slippery</span><span class="p">)</span>
</pre></div>

    </div>
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">NameError</span>                                 Traceback (most recent call last)
Cell <span class="ansi-green-fg">In[28], line 2</span>
<span class="ansi-green-intense-fg ansi-bold">      1</span> <span style="color: rgb(95,135,135)"># Run the agent to see how the agent now navigates the slippery ice.</span>
<span class="ansi-green-fg">----&gt; 2</span> run_agent(<span class="ansi-yellow-bg">env_slippery</span>, q_table_slippery)

<span class="ansi-red-fg">NameError</span>: name &#39;env_slippery&#39; is not defined</pre>
</div>
</div>

</div>
</div>

</div>
<div id="cell-id=6d5b0aac-a50d-4d12-941e-de64ca9838f4" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[&nbsp;]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span> 
</pre></div>

    </div>
  </div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h1 id="Language-Models">Language Models<a class="anchor-link" href="#Language-Models">&#182;</a></h1><img src="https://www.wisecube.ai/wp-content/uploads/2023/05/Featured-Blog-Image-A-Comprehensive-Overview-of-Large-Language-Models-1080x675.jpg" alt="drawing" width="800"/>
<p>Language models, or large language models (LLMs), primarily focuses on classifying and generating text (next token prediction), as well as generating condensed vector representations of texts, typically referred to as embeddings. 
Pre-training on large datasets, in conjunction with task-specific supervised fine-tuning, demonstrates state of the art performance in many natural language processing (NLP) tasks, including few-shot and zero-shot scenarios. In this assignment we will explore the application of LLM in completing two tasks.</p>
<p>The transformer library by Huggingface will be used for ease of implementation. It is built for simplifying the implementation of NLP applications. Huggingface is also known for their model and dataset hub, where they host various trained models and datasets which allows users to easily exchange trained models and datasets, as well as showcase demos of their models.</p>
<h3 id="Learning-Goals">Learning Goals<a class="anchor-link" href="#Learning-Goals">&#182;</a></h3><p>After successfully completing this part of the assignment, you should be able to:</p>
<ul>
<li>solve NLP tasks using existing LLM in a zero-shot manner.</li>
<li>learn how to use existing LLMs to generate texts.</li>
<li>understand the basics of how to evaluate generative LLMs.</li>
<li>understand how to use huggingface library and Huggingface model hub.</li>
<li>implement similarity search for doing query-based document retrieval.</li>
</ul>
<h2 id="Table-of-Contents">Table of Contents<a class="anchor-link" href="#Table-of-Contents">&#182;</a></h2><ol>
<li><a href="#language_gneration">Language Generation</a></li>
<li><a href="#zero_shot_information_retrieval">Zero-Shot Information Retrieval</a></li>
</ol>

    </div>
  </div></div>

<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h1 id="Language-Generation-">Language Generation <a class="anchor" id="language_gneration" /><a class="anchor-link" href="#Language-Generation-">&#182;</a></h1><p>The task involves generating textual content in response to a given prompt. 
It serves as the foundation for numerous natural language generation (NLG) tasks. 
In this work, the GPT-Neo Model with 68 Million parameters will be utilized. 
Despite its very modest size, the model has been pre-trained on the TinyStories dataset, enabling it to generate plausible sentences.</p>

    </div>
  </div></div>

<div id="cell-id=1b837fd7" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[29]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Import the libraries we will be using</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">AutoModelForCausalLM</span><span class="p">,</span> <span class="n">AutoTokenizer</span><span class="p">,</span><span class="n">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">set_verbosity</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">ERROR</span> <span class="p">)</span>
<span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

<span class="c1"># Helper function for grading</span>
<span class="k">def</span> <span class="nf">run_check</span><span class="p">():</span>
    <span class="n">nbgrader_exec_env</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NBGRADER_EXECUTION&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nbgrader_exec_env</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">nbgrader_exec_env</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;autograde&#39;</span><span class="p">,</span> <span class="s1">&#39;validate&#39;</span><span class="p">]:</span>
        <span class="k">return</span> <span class="kc">False</span>
    <span class="k">return</span> <span class="kc">True</span>

<span class="c1"># Model checkpoint name from Huggingface hub</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="s1">&#39;roneneldan/TinyStories-33M&#39;</span>

<span class="c1"># Load the pre-trained model</span>
<span class="c1"># AutoModelForCausalLM is for language model tasks</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">AutoModelForCausalLM</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>

<span class="c1"># Load the tokenizer associated with the model</span>
<span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>

<span class="c1"># Example prompt for text generation</span>
<span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;Hi, How are you?&quot;</span>

<span class="c1"># Tokenize the prompt</span>
<span class="c1"># return_tensors=&quot;pt&quot; specifies PyTorch tensors (use &quot;tf&quot; for TensorFlow)</span>
<span class="n">input_ids</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span>

<span class="c1"># Generates up to max_length words from the prompt.</span>
<span class="c1"># top_p, num_beams, etc., control generation (details: https://huggingface.co/transformers/v4.2.2/_modules/transformers/generation_utils.html).</span>
<span class="c1"># return_dict_in_generate and output_scores: return prediction scores along with tokens.</span>
<span class="c1"># pad_token_id:ID of the padding token.</span>
<span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">input_ids</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">return_dict_in_generate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">output_scores</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pad_token_id</span><span class="o">=</span><span class="mi">50256</span><span class="p">)</span>

<span class="c1"># Decode the generated tokens back to text</span>
<span class="c1"># skip_special_tokens=True: special tokens such as [CLS], [SEP] which we skip in the output text.</span>
<span class="n">output_text</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="o">*</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">skip_special_tokens</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Given the prompt: &quot;</span><span class="si">{</span><span class="n">prompt</span><span class="si">}</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">The generated text corresponding to this prompt is: </span><span class="se">\n\n</span><span class="s1"> </span><span class="si">{</span><span class="n">output_text</span><span class="si">}</span><span class="s1"> </span><span class="se">\n\n\n</span><span class="s1"> &#39;</span><span class="p">)</span>

<span class="c1"># outputs[1] contains the logit scores for each token. </span>
<span class="c1"># Typically, these logits are converted to probabilities using the Softmax function.</span>
<span class="n">probabilities</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</pre></div>

    </div>
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stderr output_text">
<pre>2025-10-13 18:39:45.207451: I tensorflow/core/platform/cpu_feature_guard.cc:182] This TensorFlow binary is optimized to use available CPU instructions in performance-critical operations.
To enable the following instructions: SSE4.1 SSE4.2 AVX, in other operations, rebuild TensorFlow with the appropriate compiler flags.
</pre>
</div>
</div>

<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>Given the prompt: &#34;Hi, How are you?&#34;
The generated text corresponding to this prompt is: 

 Hi, How are you? Do you want to play with me?&#34;

The boy looked at her and said, &#34;No, I don&#39;t. Go away. You are too small and silly. You don&#39;t know how to play. You are a baby.&#34;

Lily felt sad and angry. She said, &#34;No, you are not. You are mean and rude. You don&#39;t know how to be nice. You don&#39;t know how to have fun. You don&#39;t know how to be a friend.&#34;

The boy laughed and said, &#34;You are just a baby. You don&#39;t know how to have fun. You don&#39;t know how to be happy. You don&#39;t know how to be a friend. You are a bully.&#34;

Lily felt hurt and scared. She said, &#34;No, I am not. I am a friend. I am a bully. I don&#39;t know how to be nice. I don&#39;t know how to be 


 
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <div class=" alert alert-warning">
<h2 id="Student-Task-A5.9">Student Task A5.9<a class="anchor-link" href="#Student-Task-A5.9">&#182;</a></h2><p>Your task is to implement the <code>text_generation()</code> function, whose stages are already demonstrated in the cell above. The function will be invoked for three prompts with respective max_len values of 50, 100, and 60.</p>
</div>

    </div>
  </div></div>

<div id="cell-id=b296bc50-765f-4a6a-8643-7bb383d8b54f" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[30]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="comment-cell-77b421e67d1de8b9"></a><div class="panel-heading"><span class="nbgrader-label">Student's answer</span><span class="pull-right"><a href="#top">(Top)</a></span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Implementing Text Generation</span>
<span class="k">def</span> <span class="nf">text_generation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tokenizer</span><span class="p">,</span><span class="n">prompt</span><span class="p">,</span><span class="n">max_len</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; </span>
<span class="sd">    Given a prompt and model, generate text of length max_len.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">    model: The pre-trained language model</span>
<span class="sd">    tokenizer: The tokenizer associated with the model</span>
<span class="sd">    prompt (str): The input text to generate from</span>
<span class="sd">    max_len (int): The maximum length of the generated text</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    tuple: (generated_text, token_probabilities)</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span> 
    
    <span class="c1"># input_ids = tokenizer.</span>
    <span class="c1"># outputs = model.generate()</span>
    <span class="c1"># output_text = </span>
    <span class="c1"># probabilities = </span>
    
    <span class="c1"># YOUR CODE HERE</span>
    <span class="n">input_ids</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">)</span>
    <span class="n">outputs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="n">input_ids</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="n">max_len</span><span class="p">,</span> <span class="n">return_dict_in_generate</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">output_scores</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pad_token_id</span><span class="o">=</span><span class="mi">50256</span><span class="p">)</span>
    
    <span class="n">output_text</span> <span class="o">=</span> <span class="n">tokenizer</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="o">*</span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">skip_special_tokens</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">probabilities</span> <span class="o">=</span> <span class="p">[</span><span class="nb">max</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">functional</span><span class="o">.</span><span class="n">softmax</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">outputs</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">return</span> <span class="n">output_text</span><span class="p">,</span><span class="n">probabilities</span>

<span class="n">prompt</span> <span class="o">=</span> <span class="s2">&quot;once upon a time &quot;</span>
<span class="n">text</span><span class="p">,</span><span class="n">prob</span> <span class="o">=</span> <span class="n">text_generation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tokenizer</span><span class="p">,</span><span class="n">prompt</span><span class="p">,</span><span class="n">max_len</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>once upon a time  there was a little girl named Lucy. She was three years old and loved to explore. One day, Lucy was walking in the park when she saw something shiny. She went closer and saw it was a big, round,
</pre>
</div>
</div>

</div>
</div>

</div>
<div id="cell-id=4c0c3ab5-9ae0-464a-babd-b7bd47be0cc6" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[31]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="cell-973c5451c1c3107d"></a><div class="panel-heading"><span class="nbgrader-label">Grade cell: <code>cell-973c5451c1c3107d</code></span>
  <span class="pull-right">
      Score: 1.0 / 1.0 <a href="#top">(Top)</a>
  </span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># this cell is for tests</span>


<span class="c1">### BEGIN HIDDEN TESTS</span>

<span class="n">prompt1</span> <span class="o">=</span> <span class="s2">&quot;once upon a time there was a&quot;</span>
<span class="n">prompt2</span> <span class="o">=</span> <span class="s2">&quot;Hi everyone, today I am going to learn about&quot;</span>
<span class="n">prompt3</span> <span class="o">=</span> <span class="s2">&quot;Two friends went to a forrest and&quot;</span>

<span class="n">text1</span><span class="p">,</span><span class="n">prob1</span> <span class="o">=</span> <span class="n">text_generation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tokenizer</span><span class="p">,</span><span class="n">prompt1</span><span class="p">,</span><span class="n">max_len</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">text2</span><span class="p">,</span><span class="n">prob2</span> <span class="o">=</span> <span class="n">text_generation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tokenizer</span><span class="p">,</span><span class="n">prompt2</span><span class="p">,</span><span class="n">max_len</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">text3</span><span class="p">,</span><span class="n">prob3</span> <span class="o">=</span> <span class="n">text_generation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tokenizer</span><span class="p">,</span><span class="n">prompt3</span><span class="p">,</span><span class="n">max_len</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>

<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">(</span><span class="n">text1</span><span class="p">)[</span><span class="s1">&#39;input_ids&#39;</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">48</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">(</span><span class="n">text1</span><span class="p">)[</span><span class="s1">&#39;input_ids&#39;</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">52</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">(</span><span class="n">text2</span><span class="p">)[</span><span class="s1">&#39;input_ids&#39;</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">98</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">(</span><span class="n">text2</span><span class="p">)[</span><span class="s1">&#39;input_ids&#39;</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">102</span>
<span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">(</span><span class="n">text3</span><span class="p">)[</span><span class="s1">&#39;input_ids&#39;</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">58</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">tokenizer</span><span class="p">(</span><span class="n">text3</span><span class="p">)[</span><span class="s1">&#39;input_ids&#39;</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">62</span>

<span class="c1">### END HIDDEN TESTS</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h3 id="Prompt-Engineering">Prompt Engineering<a class="anchor-link" href="#Prompt-Engineering">&#182;</a></h3><p>Large language models behave differently based on the prompt, resulting in a new discipline called prompt engineering that focuses on the optimal design of prompts for maximum output. Let's see if we can find some engaging prompts to generate meaningful text.</p>

    </div>
  </div></div>

<div id="cell-id=09127202" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[32]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="c1">## ==========================================================</span>
<span class="c1">## Play with prompts, try it yourself</span>
<span class="n">prompt</span> <span class="o">=</span> <span class="s1">&#39;Write a joke for me &#39;</span>
<span class="n">max_length</span> <span class="o">=</span> <span class="mi">100</span>
<span class="c1">## ==========================================================</span>

<span class="k">if</span> <span class="n">run_check</span><span class="p">():</span>
    <span class="n">text</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">text_generation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">tokenizer</span><span class="p">,</span><span class="n">prompt</span><span class="p">,</span><span class="n">max_len</span><span class="o">=</span><span class="n">max_length</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
</pre></div>

    </div>
  </div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h2 id="Evaluation-of-Language-Models">Evaluation of Language Models<a class="anchor-link" href="#Evaluation-of-Language-Models">&#182;</a></h2><p>Evaluating Natural Language Processing (NLP) models, particularly Large Language Models (LLMs), is essential for understanding their capabilities and limitations. There are two primary approaches to evaluation:</p>
<h4 id="1.-Extrinsic-Evaluation">1. Extrinsic Evaluation<a class="anchor-link" href="#1.-Extrinsic-Evaluation">&#182;</a></h4><p>This method assesses a model's performance on specific, downstream tasks, providing a practical measure of the model's effectiveness in applied scenarios.</p>
<h4 id="2.-Intrinsic-Evaluation">2. Intrinsic Evaluation<a class="anchor-link" href="#2.-Intrinsic-Evaluation">&#182;</a></h4><p>This approach involves identifying inherent properties of a model to estimate its quality, independent of any specific task it was designed to perform. These properties often relate to the model's underlying linguistic capabilities.</p>
<hr />
<h3 id="Perplexity:-A-Key-Intrinsic-Metric">Perplexity: A Key Intrinsic Metric<a class="anchor-link" href="#Perplexity:-A-Key-Intrinsic-Metric">&#182;</a></h3><p>One critical metric for intrinsic evaluation is <strong>perplexity</strong>, which quantifies the uncertainty a language model exhibits during word generation. It reflects how well the model can predict a sequence of text.</p>
<h4 id="Calculation-of-Perplexity">Calculation of Perplexity<a class="anchor-link" href="#Calculation-of-Perplexity">&#182;</a></h4><p>Perplexity is calculated as follows:</p>
<ol>
<li>For each word $x_t$ in the corpus, compute its probability based on all preceding words.</li>
<li>Take the inverse of this probability.</li>
<li>Calculate the product of these inverse probabilities for all words.</li>
<li>Normalize this product by raising it to the power of $\frac{1}{N}$, where $N$ is the total number of words.</li>
</ol>
<p>Mathematically, this is expressed as:</p>
$$
\text{Perplexity} = \sqrt[N]{\prod_{t=1}^N \frac{1}{P_{LM}(x_t|x_1, \ldots, x_{t-1})}}
$$<p>Where:</p>
<ul>
<li>$N$ is the total number of words in the corpus.</li>
<li>$P_{LM}(x_t|x_1, \ldots, x_{t-1})$ is the conditional probability of the $t$-th word given all previous words.</li>
</ul>
<blockquote>
<p><strong>Note:</strong> To ensure numerical stability and avoid exceptions when the probability $P_{LM}(x_t|x_1, \ldots, x_{t-1})$ is zero, a small epsilon value can be used.</p>
</blockquote>
<h4 id="Interpretation-of-Perplexity">Interpretation of Perplexity<a class="anchor-link" href="#Interpretation-of-Perplexity">&#182;</a></h4><p>A lower perplexity value indicates better performance, as it suggests the model is less uncertain in predicting words.</p>
<hr />
<h4 id="Limitations-and-Considerations">Limitations and Considerations<a class="anchor-link" href="#Limitations-and-Considerations">&#182;</a></h4><p>While perplexity is a valuable metric, it  may not always correlate directly with performance on specific downstream tasks. Moreover Perplexity scores are not directly comparable between models with different vocabularies or tokenization schemes.</p>

    </div>
  </div></div>

<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <div class=" alert alert-warning">
<h2 id="Student-Task-A5.10">Student Task A5.10<a class="anchor-link" href="#Student-Task-A5.10">&#182;</a></h2><p>Your task is to implement the function <code>calculate_perplexity()</code>, which computes the perplexity based on the output probabilities of the models.</p>
<p>Note: Element t in the input list probabilities is $P_{LM}(x_{t}|x_{1},x_{2}...,x_{t-1})$. and $N=$ len(probabilities)</p>
</div>

    </div>
  </div></div>

<div id="cell-id=eae346e1-997f-45ae-88e7-02ef52ee137e" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[33]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="comment-cell-6e20fb6c4e76c72c"></a><div class="panel-heading"><span class="nbgrader-label">Student's answer</span><span class="pull-right"><a href="#top">(Top)</a></span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Implementing perplexity calculation</span>
<span class="k">def</span> <span class="nf">calculate_perplexity</span><span class="p">(</span><span class="n">probabilities</span><span class="p">,</span><span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate perplexity given a list of probabilities.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">    probabilities (list): List of probabilities for each token.</span>
<span class="sd">    epsilon (float, optional): A small value to prevent division by zero or log of zero.</span>

<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    float: Perplexity value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># YOUR CODE HERE</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">probabilities</span><span class="p">)</span>
    <span class="n">log_perplexity</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">prob</span> <span class="ow">in</span> <span class="n">probabilities</span><span class="p">:</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>
        <span class="n">log_perplexity</span> <span class="o">+=</span> <span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">prob</span><span class="p">)</span>
    <span class="n">log_perplexity</span> <span class="o">/=</span> <span class="n">N</span>
    
    <span class="n">perplexity</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">log_perplexity</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">perplexity</span>

<span class="c1"># # Unit Test example:</span>
<span class="c1"># probs = [0.8, 0.7, 0.1,0.4,0]</span>
<span class="c1"># perplexity = calculate_perplexity(probs)</span>
<span class="c1"># print(f&quot;Perplexity: {perplexity}&quot;) # Output should be Perplexity: 536.970462</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

</div>
<div id="cell-id=479c04e1-2b64-41e2-bc6e-d388e7d338e3" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[34]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="cell-87af2727f38ded3c"></a><div class="panel-heading"><span class="nbgrader-label">Grade cell: <code>cell-87af2727f38ded3c</code></span>
  <span class="pull-right">
      Score: 2.0 / 2.0 <a href="#top">(Top)</a>
  </span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># this cell is for tests</span>

<span class="c1">### BEGIN HIDDEN TESTS</span>

<span class="n">prob1</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2471</span><span class="p">,</span><span class="mf">0.6604</span><span class="p">,</span><span class="mf">0.3618</span><span class="p">,</span><span class="mf">0.1209</span><span class="p">,</span><span class="mf">0.9250</span><span class="p">,</span><span class="mf">0.8897</span><span class="p">,</span><span class="mf">0.6856</span><span class="p">,</span><span class="mf">0.4092</span><span class="p">,</span><span class="mf">0.9610</span><span class="p">,</span><span class="mf">0.9997</span><span class="p">,</span><span class="mf">0.8457</span><span class="p">,</span><span class="mf">0.3797</span><span class="p">,</span><span class="mf">0.7008</span><span class="p">,</span><span class="mf">0.4389</span><span class="p">,</span>
         <span class="mf">0.5476</span><span class="p">,</span><span class="mf">0.5578</span><span class="p">,</span><span class="mf">0.9821</span><span class="p">,</span><span class="mf">0.6435</span><span class="p">,</span><span class="mf">0.5036</span><span class="p">,</span><span class="mf">0.2786</span><span class="p">,</span><span class="mf">0.3232</span><span class="p">,</span><span class="mf">0.5163</span><span class="p">,</span><span class="mf">0.8642</span><span class="p">,</span><span class="mf">0.5955</span><span class="p">,</span><span class="mf">0.5857</span><span class="p">,</span><span class="mf">0.9710</span><span class="p">,</span><span class="mf">0.5580</span><span class="p">,</span><span class="mf">0.4689</span><span class="p">,</span>
         <span class="mf">0.2396</span><span class="p">,</span><span class="mf">0.2836</span><span class="p">,</span><span class="mf">0.9133</span><span class="p">,</span><span class="mf">0.7567</span><span class="p">,</span><span class="mf">0.9845</span><span class="p">,</span><span class="mf">0.7478</span><span class="p">,</span><span class="mf">0.4204</span><span class="p">,</span><span class="mf">0.9374</span><span class="p">,</span><span class="mf">0.5560</span><span class="p">,</span><span class="mf">0.4706</span><span class="p">,</span><span class="mf">0.9938</span><span class="p">,</span><span class="mf">0.9995</span><span class="p">,</span><span class="mf">0.7713</span><span class="p">,</span><span class="mf">0.3114</span><span class="p">,</span><span class="mf">0.4982</span><span class="p">]</span>

<span class="n">prob2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0941</span><span class="p">,</span><span class="mf">0.3984</span><span class="p">,</span><span class="mf">0.3205</span><span class="p">,</span><span class="mf">0.7992</span><span class="p">,</span><span class="mf">0.2022</span><span class="p">,</span><span class="mf">0.2319</span><span class="p">,</span><span class="mf">0.2660</span><span class="p">,</span><span class="mf">0.8589</span><span class="p">,</span><span class="mf">0.9930</span><span class="p">,</span><span class="mf">0.1831</span><span class="p">,</span><span class="mf">0.5989</span><span class="p">,</span><span class="mf">0.5815</span><span class="p">,</span><span class="mf">0.5503</span><span class="p">,</span><span class="mf">0.3186</span><span class="p">,</span><span class="mf">0.2790</span><span class="p">,</span>
         <span class="mf">0.5686</span><span class="p">,</span><span class="mf">0.9887</span><span class="p">,</span><span class="mf">0.4117</span><span class="p">,</span><span class="mf">0.9626</span><span class="p">,</span><span class="mf">0.2330</span><span class="p">,</span><span class="mf">0.4383</span><span class="p">,</span><span class="mf">0.2382</span><span class="p">,</span><span class="mf">0.2322</span><span class="p">,</span><span class="mf">0.6690</span><span class="p">,</span><span class="mf">0.2147</span><span class="p">,</span><span class="mf">0.3013</span><span class="p">,</span><span class="mf">0.3301</span><span class="p">,</span><span class="mf">0.3194</span><span class="p">,</span><span class="mf">0.6311</span><span class="p">,</span><span class="mf">0.2823</span><span class="p">,</span>
         <span class="mf">0.1729</span><span class="p">,</span><span class="mf">0.6095</span><span class="p">,</span><span class="mf">0.7279</span><span class="p">,</span><span class="mf">0.7791</span><span class="p">,</span><span class="mf">0.4430</span><span class="p">,</span><span class="mf">0.3599</span><span class="p">,</span><span class="mf">0.7766</span><span class="p">,</span><span class="mf">0.2705</span><span class="p">,</span><span class="mf">0.9861</span><span class="p">,</span><span class="mf">0.6198</span><span class="p">,</span><span class="mf">0.9526</span><span class="p">,</span><span class="mf">0.4820</span><span class="p">,</span><span class="mf">0.8740</span><span class="p">,</span><span class="mf">0.9945</span><span class="p">,</span><span class="mf">0.4585</span><span class="p">,</span>
         <span class="mf">0.3470</span><span class="p">,</span><span class="mf">0.6209</span><span class="p">,</span><span class="mf">0.5905</span><span class="p">,</span><span class="mf">0.3927</span><span class="p">,</span><span class="mf">0.9187</span><span class="p">,</span><span class="mf">0.3885</span><span class="p">,</span><span class="mf">0.9619</span><span class="p">,</span><span class="mf">0.2664</span><span class="p">,</span><span class="mf">0.9991</span><span class="p">,</span><span class="mf">0.9538</span><span class="p">,</span><span class="mf">0.9704</span><span class="p">,</span><span class="mf">0.5305</span><span class="p">,</span><span class="mf">0.1803</span><span class="p">,</span><span class="mf">0.9489</span><span class="p">,</span><span class="mf">0.7729</span><span class="p">,</span>
         <span class="mf">0.5070</span><span class="p">,</span><span class="mf">0.1781</span><span class="p">,</span><span class="mf">0.3876</span><span class="p">,</span><span class="mf">0.6870</span><span class="p">,</span><span class="mf">0.7547</span><span class="p">,</span><span class="mf">0.9913</span><span class="p">,</span><span class="mf">0.3905</span><span class="p">,</span><span class="mf">0.9271</span><span class="p">,</span><span class="mf">0.4514</span><span class="p">,</span><span class="mf">0.4398</span><span class="p">,</span><span class="mf">0.3369</span><span class="p">,</span><span class="mf">0.8801</span><span class="p">,</span><span class="mf">0.9015</span><span class="p">,</span><span class="mf">0.9965</span><span class="p">,</span><span class="mf">0.7782</span><span class="p">,</span>
         <span class="mf">0.9978</span><span class="p">,</span><span class="mf">0.5227</span><span class="p">,</span><span class="mf">0.8866</span><span class="p">,</span><span class="mf">0.9697</span><span class="p">,</span><span class="mf">0.9943</span><span class="p">,</span><span class="mf">0.9989</span><span class="p">,</span><span class="mf">0.7160</span><span class="p">,</span><span class="mf">0.8932</span><span class="p">,</span><span class="mf">0.5134</span><span class="p">,</span><span class="mf">0.9999</span><span class="p">,</span><span class="mf">0.3148</span><span class="p">,</span><span class="mf">0.9989</span><span class="p">,</span><span class="mf">0.5667</span><span class="p">,</span><span class="mf">0.3580</span><span class="p">,</span><span class="mf">0.7530</span><span class="p">]</span>


<span class="n">prob3</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0988</span><span class="p">,</span><span class="mf">0.7763</span><span class="p">,</span><span class="mf">0.5176</span><span class="p">,</span><span class="mf">0.7219</span><span class="p">,</span><span class="mf">0.5965</span><span class="p">,</span><span class="mf">0.5735</span><span class="p">,</span><span class="mf">0.1188</span><span class="p">,</span><span class="mf">0.2356</span><span class="p">,</span><span class="mf">0.6014</span><span class="p">,</span><span class="mf">0.4270</span><span class="p">,</span><span class="mf">0.2952</span><span class="p">,</span><span class="mf">0.2331</span><span class="p">,</span><span class="mf">0.5040</span><span class="p">,</span><span class="mf">0.3467</span><span class="p">,</span><span class="mf">0.9627</span><span class="p">,</span>
         <span class="mf">0.8893</span><span class="p">,</span><span class="mf">0.2556</span><span class="p">,</span><span class="mf">0.9456</span><span class="p">,</span><span class="mf">0.2805</span><span class="p">,</span><span class="mf">0.3978</span><span class="p">,</span><span class="mf">0.9805</span><span class="p">,</span><span class="mf">0.9760</span><span class="p">,</span><span class="mf">0.8508</span><span class="p">,</span><span class="mf">0.8709</span><span class="p">,</span><span class="mf">0.7091</span><span class="p">,</span><span class="mf">0.9691</span><span class="p">,</span><span class="mf">0.5755</span><span class="p">,</span><span class="mf">0.4200</span><span class="p">,</span><span class="mf">0.9720</span><span class="p">,</span><span class="mf">0.3764</span><span class="p">,</span>
         <span class="mf">0.9537</span><span class="p">,</span><span class="mf">0.4578</span><span class="p">,</span><span class="mf">0.2339</span><span class="p">,</span><span class="mf">0.2558</span><span class="p">,</span><span class="mf">0.6757</span><span class="p">,</span><span class="mf">0.6341</span><span class="p">,</span><span class="mf">0.3572</span><span class="p">,</span><span class="mf">0.2798</span><span class="p">,</span><span class="mf">0.8307</span><span class="p">,</span><span class="mf">0.2861</span><span class="p">,</span><span class="mf">0.8508</span><span class="p">,</span><span class="mf">0.3028</span><span class="p">,</span><span class="mf">0.4041</span><span class="p">,</span><span class="mf">0.9404</span><span class="p">,</span><span class="mf">0.8984</span><span class="p">,</span>
         <span class="mf">0.3573</span><span class="p">,</span><span class="mf">0.2059</span><span class="p">,</span><span class="mf">0.2125</span><span class="p">,</span><span class="mf">0.9999</span><span class="p">,</span><span class="mf">0.9998</span><span class="p">,</span><span class="mf">0.3267</span><span class="p">,</span><span class="mf">0.9872</span><span class="p">]</span>


<span class="n">prob4</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-12</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">,</span> <span class="mf">1e-12</span><span class="p">,</span><span class="mf">1e-12</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Test case for zero prob</span>


<span class="n">perplexity1</span> <span class="o">=</span> <span class="n">calculate_perplexity</span><span class="p">(</span><span class="n">prob1</span><span class="p">)</span>
<span class="n">perplexity2</span> <span class="o">=</span> <span class="n">calculate_perplexity</span><span class="p">(</span><span class="n">prob2</span><span class="p">)</span>
<span class="n">perplexity3</span> <span class="o">=</span> <span class="n">calculate_perplexity</span><span class="p">(</span><span class="n">prob3</span><span class="p">)</span>
<span class="n">perplexity4</span> <span class="o">=</span> <span class="n">calculate_perplexity</span><span class="p">(</span><span class="n">prob4</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">perplexity1</span> <span class="o">&gt;</span> <span class="mf">1.75</span> <span class="ow">and</span> <span class="n">perplexity1</span><span class="o">&lt;</span><span class="mf">1.78</span>
<span class="k">assert</span> <span class="n">perplexity2</span> <span class="o">&gt;</span> <span class="mf">1.90</span> <span class="ow">and</span> <span class="n">perplexity2</span><span class="o">&lt;</span><span class="mf">1.94</span>
<span class="k">assert</span> <span class="n">perplexity3</span> <span class="o">&gt;</span> <span class="mf">2.0</span> <span class="ow">and</span> <span class="n">perplexity3</span><span class="o">&lt;</span><span class="mf">2.05</span>
<span class="k">assert</span> <span class="p">(</span><span class="n">perplexity4</span> <span class="o">&gt;</span> <span class="mf">999999999999.5</span> <span class="ow">and</span> <span class="n">perplexity3</span><span class="o">&lt;</span><span class="mf">1000000000000.5</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">perplexity4</span> <span class="o">&gt;</span> <span class="mf">561231024154.65</span> <span class="ow">and</span> <span class="n">perplexity3</span><span class="o">&lt;</span><span class="mf">561231024154.7</span><span class="p">)</span>


<span class="c1">### END HIDDEN TESTS</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h1 id="Zero-Shot-Information-Retrieval-">Zero-Shot Information Retrieval <a class="anchor" id="zero_shot_information_retrieval" /><a class="anchor-link" href="#Zero-Shot-Information-Retrieval-">&#182;</a></h1><p>Information Retrieval aims to find and extract information relevant to a user's query. It's widely used in web search, question-answering systems, personal assistants, and chatbots.
In this task, we'll use a pre-trained BERT model (110 million parameters) for zero-shot information retrieval.</p>
<blockquote>
<p><strong>Note:</strong> &quot;Zero-shot&quot; means the model hasn't been specifically trained for <code>information retrieval</code> on this <code>dataset</code>.</p>
</blockquote>
<hr />
<h4 id="Task-Overview:">Task Overview:<a class="anchor-link" href="#Task-Overview:">&#182;</a></h4><p>You are provided with 1,000 short stories and their unique identifiers in <code>story.csv</code>. The objective is to retrieve the most relevant story for each query, which consists of 1-2 sentences. The <code>query.csv</code> file contains 100 such queries. Your goal is to determine and return the unique identifier of the most relevant story for each query.</p>
<h4 id="Solution-Strategy:">Solution Strategy:<a class="anchor-link" href="#Solution-Strategy:">&#182;</a></h4><p>We will leverage a language model to generate embeddingsvectorized representationsof both the stories and queries. By calculating the cosine similarity between these embeddings, we will identify and retrieve the story that best matches each query.</p>

    </div>
  </div></div>

<div id="cell-id=5d84b0c0-c7fa-4ac5-bb9f-0beff5f2d4c7" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[35]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Import the libraries we will be using</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">tqdm</span>

<span class="c1"># 1000 stories with their unique id (story_uid) which is our information database </span>
<span class="n">story_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;story.csv&#39;</span><span class="p">)</span>
<span class="n">story_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[35]:</div>



<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>story_uid</th>
      <th>story</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>774</td>
      <td>Once upon a time, there was a little car name...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>90</td>
      <td>Once upon a time, there was a white bunny. Th...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>961</td>
      <td>Once upon a time, there was a little girl nam...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>255</td>
      <td>Once upon a time, there was a little girl who...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>382</td>
      <td>One day, a mommy and her little girl went to...</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
<div id="cell-id=b3862a94" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[36]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># We are given query.csv file which contains 100 queries.</span>
<span class="c1"># We need to search and return the most similar story (from story_df) corresponding to each query.</span>
<span class="n">query_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;query.csv&#39;</span><span class="p">)</span>
<span class="n">query_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">query_df</span><span class="p">[</span><span class="s1">&#39;query&#39;</span><span class="p">])</span>
<span class="n">query_list</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
</pre></div>

    </div>
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[36]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>[&#39; &#34;Give that back!&#34; Beth said. Her brother ignored her and tried to run away with it, but Beth was determined not to let him take it&#39;,
 &#39;&#34; From that day on, Lily played with her toy ambulance and pretended to be a smart doctor who helped people in need. She knew that one day, she would be just like the real ambulance and help even more people&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h3 id="Extracting-Embedding-Vectors-Using-a-Pre-Trained-LLM-Model">Extracting Embedding Vectors Using a Pre-Trained LLM Model<a class="anchor-link" href="#Extracting-Embedding-Vectors-Using-a-Pre-Trained-LLM-Model">&#182;</a></h3><p>There are various methods to extract embeddings from a pre-trained language model, each suited for different use cases. The output from the last layer of the language model typically has the shape <code>(B, T, d)</code>, where:</p>
<ul>
<li><code>B</code> is the batch size,</li>
<li><code>T</code> is the sequence length (number of tokens), and</li>
<li><code>d</code> is the feature dimension in each token's representation.</li>
</ul>
<p>Assuming <code>output_tensor</code> (a NumPy/ PyTorch tensor) is the output from the last layer with shape <code>(B, T, d)</code>, where <code>B=1</code>, the following are some common approaches to extract embeddings:</p>
<ol>
<li><strong>Last Token Embedding:</strong> Extracts the embedding of the last token in the sequence: <code>last_token_embedding = output_tensor.squeeze(0)[-1, :]</code>.</li>
<li><strong>[CLS] Token Embedding:</strong> Uses the embedding of the [CLS] token, which is often located at the first position and represents the entire sequence (specific to BERT models): <code>cls_token_embedding = output_tensor.squeeze(0)[0, :]</code></li>
<li><strong>Mean Pooling:</strong> Computes the mean of all token embeddings, providing a generalized representation of the sequence: <code>mean_embedding = output_tensor.mean(dim=1).squeeze(0)</code></li>
<li><strong>Weighted Mean Pooling:</strong> Applies a weighted mean where the influence of each token's embedding decreases linearly from the last token to the first. This can be implemented using the <code>get_weighted_mean_emb()</code> function : <code>weighted_mean_embedding = get_weighted_mean_emb(last_layer_embs)</code></li>
</ol>
<p>For our model, we found that Mean Pooling and especially Weighted Mean Pooling yield the best results in terms of capturing the sequence's semantic information.</p>
<blockquote>
<p><strong>Note:</strong> For models of the <code>AutoModelForCausalLM</code> type, the <code>model.transformer()</code> method is used to obtain the output from the last feature layer.</p>
</blockquote>

    </div>
  </div></div>

<div id="cell-id=b78f49ef" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[37]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">torch.nn.functional</span> <span class="k">as</span> <span class="nn">F</span>


<span class="c1"># Function to extract mean weighted embeddings.</span>
<span class="k">def</span> <span class="nf">get_weighted_mean_emb</span><span class="p">(</span><span class="n">last_layer_embs</span><span class="p">):</span>
    <span class="n">phrase_embedding_mean_weighted</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">last_layer_embs</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">len_s</span> <span class="o">=</span> <span class="n">last_layer_embs</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">j_token</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">last_layer_embs</span><span class="p">):</span>
        <span class="n">phrase_embedding_mean_weighted</span> <span class="o">+=</span> <span class="p">((</span><span class="n">j</span> <span class="o">/</span> <span class="n">len_s</span><span class="p">)</span> <span class="o">*</span> <span class="n">j_token</span><span class="p">)</span>
    <span class="n">normalized</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">normalize</span><span class="p">(</span><span class="n">phrase_embedding_mean_weighted</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">normalized</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>


<span class="c1"># Here we have precomputed the embeddings for each story to save some time.</span>
<span class="n">load_precomputed_embeddings</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">load_precomputed_embeddings</span> <span class="ow">and</span> <span class="n">run_check</span><span class="p">():</span>
    <span class="n">story_emb_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">story</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="o">.</span><span class="n">tqdm</span><span class="p">(</span><span class="n">story_df</span><span class="p">[</span><span class="s1">&#39;story&#39;</span><span class="p">]):</span>
        <span class="c1"># Mean</span>
        <span class="c1">#story_emb_list.append(model.transformer(tokenizer.encode(story, return_tensors=&quot;pt&quot;))[0].mean(dim=1).squeeze(0).detach().numpy())</span>
        
        <span class="c1"># Weighted mean, using the get_weighted_mean_emb() function</span>
        <span class="n">story_emb_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_weighted_mean_emb</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">transformer</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">story</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
        
    <span class="n">story_emb_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">story_emb_list</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">story_emb_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s1">&#39;story_embeddings.npy&#39;</span><span class="p">)</span>

<span class="n">uids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">story_df</span><span class="p">[</span><span class="s1">&#39;story_uid&#39;</span><span class="p">]))</span>
</pre></div>

    </div>
  </div>
</div>

</div>
<div id="cell-id=11d4eccf" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[38]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># We also want to get the embeddings of each query.</span>
<span class="n">query_emb_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">query</span> <span class="ow">in</span> <span class="n">query_list</span><span class="p">:</span>
    <span class="n">query_emb_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">get_weighted_mean_emb</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">transformer</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
<span class="n">query_emb_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span><span class="n">query_emb_list</span><span class="p">)</span>
</pre></div>

    </div>
  </div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h2 id="Visualization-of-Embeddings">Visualization of Embeddings<a class="anchor-link" href="#Visualization-of-Embeddings">&#182;</a></h2><p>Each stories and queries are embedded to a 768 dimensional vector space where their position and distance represents their semantic similarities. For visualization purposes, those vectors are projected down to 2 dimension using tSNE method (PCA is also an alternatives) as shown below.</p>

    </div>
  </div></div>

<div id="cell-id=53e8d729" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[39]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="c1">## The code to generate TSNE plot</span>
<span class="c1">#from sklearn.manifold import TSNE</span>
<span class="c1">#import matplotlib.pyplot as plt</span>
<span class="c1">#story_embedded = TSNE(n_components=2, init=&#39;random&#39;, perplexity=3).fit_transform(story_emb)</span>
<span class="c1">#plt.scatter(story_embedded[:,0],story_embedded[:,1],marker=&#39;o&#39;)</span>
<span class="c1">#query_embedded = TSNE(n_components=2, init=&#39;random&#39;, perplexity=3).fit_transform(query_emb[:30])</span>
<span class="c1">#plt.scatter(query_embedded[:,0],query_embedded[:,1],marker=&#39;+&#39;)</span>
<span class="c1">#plt.legend([&quot;story embeddings&quot; , &quot;Query embeddings&quot;])</span>
</pre></div>

    </div>
  </div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <img src="tsne.png" alt="drawing" />

    </div>
  </div></div>

<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <p>The information retrieval problem has been simplified to a search problem in a vector space where both the data and the query reside. To determine the closest data point for each query, we will utilize the cosine similarity measure.</p>
<h3 id="Cosine-Similarity">Cosine Similarity<a class="anchor-link" href="#Cosine-Similarity">&#182;</a></h3><p>Cosine similarity is a measure of similarity between two non-zero vectors in an n-dimensional space. It quantifies the cosine of the angle between the vectors, providing an indication of their orientation rather than their magnitude. This metric is widely used to assess the similarity between documents or feature vectors.</p>
<p>Given two vectors of attributes $\mathbf{a}$ and $\mathbf{b}$, the cosine similarity $\cos(\theta)$ is defined as:</p>
$$
\cos(\theta) = \frac{\mathbf{a} \cdot \mathbf{b}}{\|\mathbf{a}\| \|\mathbf{b}\|}
$$<p>Where:</p>
<ul>
<li>$\mathbf{a} \cdot \mathbf{b}$ represents the dot product of the vectors.</li>
<li>$\|\mathbf{a}\|$ and $\|\mathbf{b}\| $ are the magnitudes (or Euclidean norms) of the vectors $\mathbf{a}$ and $ \mathbf{b}$, respectively.</li>
</ul>
<p>The magnitude of a vector $\mathbf{a}$ is calculated as:</p>
$$
\|\mathbf{a}\| = \sqrt{a_1^2 + a_2^2 + \cdots + a_n^2}
$$<p>Cosine similarity ranges from -1 to 1:</p>
<ul>
<li>A value of 1 indicates that the vectors are identical in direction.</li>
<li>A value of 0 indicates that the vectors are orthogonal (i.e., completely dissimilar in terms of direction).</li>
<li>A value of -1 indicates that the vectors are diametrically opposed.</li>
</ul>
<blockquote>
<p>Note: In Python, the magnitude of a vector can be computed using the <code>np.linalg.norm(vector)</code> function from the NumPy library.</p>
</blockquote>

    </div>
  </div></div>

<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <div class=" alert alert-warning">
<h2 id="Student-Task-A5.11">Student Task A5.11<a class="anchor-link" href="#Student-Task-A5.11">&#182;</a></h2><p>Your task is to implement the function <code>cosine_similarity()</code>, which computes the similarity between two vectors vector1 and vector2.</p>
</div>

    </div>
  </div></div>

<div id="cell-id=a2b0d897" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[40]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="comment-cell-36bc8c27e065585e"></a><div class="panel-heading"><span class="nbgrader-label">Student's answer</span><span class="pull-right"><a href="#top">(Top)</a></span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># implement cosine similarity measure between two vectors.</span>
<span class="k">def</span> <span class="nf">cosine_similarity</span><span class="p">(</span><span class="n">vector1</span><span class="p">,</span> <span class="n">vector2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Calculate Cosine similarity between two vectors.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    vector1: numpy array of shape (N,)</span>
<span class="sd">    vector2: numpy array of shape (N,)</span>
<span class="sd">    </span>
<span class="sd">    Returns:</span>
<span class="sd">    similarity: cosine similarity value.</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="c1"># YOUR CODE HERE</span>
    <span class="n">dot_product</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">vector1</span><span class="p">,</span> <span class="n">vector2</span><span class="p">)</span>
    <span class="n">norm1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vector1</span><span class="p">)</span>
    <span class="n">norm2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">vector2</span><span class="p">)</span>
    
    <span class="n">similarity</span> <span class="o">=</span> <span class="n">dot_product</span> <span class="o">/</span> <span class="p">(</span><span class="n">norm1</span> <span class="o">*</span> <span class="n">norm2</span> <span class="o">+</span> <span class="mf">1e-12</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">similarity</span>


<span class="c1"># Unit test case</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">4.1</span><span class="p">,</span> <span class="mf">5.6</span><span class="p">])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">3.2</span><span class="p">])</span>
<span class="n">sim_score</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>  <span class="c1"># sim_score = 0.47879</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sim_score</span><span class="p">)</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>0.4787905921769883
</pre>
</div>
</div>

</div>
</div>

</div>
<div id="cell-id=e4405bf4" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[41]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="cell-e9f5e28fbc895895"></a><div class="panel-heading"><span class="nbgrader-label">Grade cell: <code>cell-e9f5e28fbc895895</code></span>
  <span class="pull-right">
      Score: 1.0 / 1.0 <a href="#top">(Top)</a>
  </span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># this cell is for tests</span>

<span class="c1">### BEGIN HIDDEN TESTS</span>

<span class="n">a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.11533471</span><span class="p">,</span>  <span class="mf">1.04556537</span><span class="p">,</span>  <span class="mf">0.13392639</span><span class="p">,</span> <span class="mf">0.70704376</span><span class="p">,</span>  <span class="mf">0.75852533</span><span class="p">,</span>
        <span class="mf">2.2492923</span> <span class="p">,</span> <span class="mf">0.59350508</span><span class="p">,</span> <span class="mf">0.22037395</span><span class="p">,</span> <span class="mf">1.16663061</span><span class="p">,</span>  <span class="mf">0.83535213</span><span class="p">])</span>
<span class="n">b1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.43334248</span><span class="p">,</span>  <span class="mf">0.45027188</span><span class="p">,</span> <span class="mf">0.22673487</span><span class="p">,</span> <span class="mf">0.44715403</span><span class="p">,</span> <span class="mf">2.44860054</span><span class="p">,</span>
        <span class="mf">0.25722278</span><span class="p">,</span> <span class="mf">0.08151348</span><span class="p">,</span>  <span class="mf">0.45046734</span><span class="p">,</span>  <span class="mf">0.62550483</span><span class="p">,</span>  <span class="mf">0.73190715</span><span class="p">])</span>

<span class="n">a2</span><span class="p">,</span> <span class="n">b2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">))),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)))</span>

<span class="n">sim1</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span><span class="n">b1</span><span class="p">)</span>
<span class="n">sim2</span> <span class="o">=</span> <span class="n">cosine_similarity</span><span class="p">(</span><span class="n">a2</span><span class="p">,</span><span class="n">b2</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">sim1</span><span class="o">&gt;</span> <span class="mf">0.51</span> <span class="ow">and</span> <span class="n">sim1</span><span class="o">&lt;</span><span class="mf">0.55</span>
<span class="k">assert</span> <span class="n">sim2</span><span class="o">&gt;</span> <span class="mf">0.71</span> <span class="ow">and</span> <span class="n">sim2</span><span class="o">&lt;</span><span class="mf">0.75</span>

<span class="c1">### END HIDDEN TESTS</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <h3 id="Example-of-document-retrieval-for-a-single-query">Example of document retrieval for a single query<a class="anchor-link" href="#Example-of-document-retrieval-for-a-single-query">&#182;</a></h3><p>Feel free to change the <code>query</code> string in the below cell and see what story is retrieved.</p>

    </div>
  </div></div>

<div id="cell-id=4197d4aa" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[42]:</div><div class="inner_cell">
    <div class="input_area">
      <div class=" highlight hl-ipython3"><pre><span></span><span class="c1">## ==========================================================</span>
<span class="c1">## A single query. Feel free to try your own query!</span>
<span class="c1">#query = &#39;picking berries&#39;</span>
<span class="c1">#query = &#39;loud sound&#39;</span>
<span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;the dog&#39;</span>
<span class="c1">## ==========================================================</span>

<span class="k">if</span> <span class="n">run_check</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Query: &quot;</span><span class="si">{</span><span class="n">query</span><span class="si">}</span><span class="s1">&quot;&#39;</span><span class="p">)</span>
    
    <span class="c1"># Embedding of the query</span>
    <span class="c1">#query_embed = model.transformer(tokenizer.encode(query, return_tensors=&quot;pt&quot;))[0].mean(dim=1).squeeze(0).detach().numpy()</span>
    <span class="c1">#query_embed = model.transformer(tokenizer.encode(query, return_tensors=&quot;pt&quot;))[0].squeeze(0)[-1].detach().numpy()</span>
    <span class="n">query_emb</span> <span class="o">=</span> <span class="n">get_weighted_mean_emb</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">transformer</span><span class="p">(</span><span class="n">tokenizer</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">return_tensors</span><span class="o">=</span><span class="s2">&quot;pt&quot;</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

    <span class="c1"># Cosine similarity of the query with all the documnts/stories in our data</span>
    <span class="n">similarity_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">cosine_similarity</span><span class="p">(</span><span class="n">query_emb</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">story_emb_array</span><span class="p">]</span>

    <span class="c1"># Index of the retrived document and its similarity score to the query.</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">similarity_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">similarity_list</span><span class="p">))</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">similarity_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="n">story</span> <span class="o">=</span> <span class="n">story_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;story&quot;</span><span class="p">]</span>
    <span class="n">uid</span> <span class="o">=</span> <span class="n">story_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s1">&#39;story_uid&#39;</span><span class="p">]</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Retrieved story: </span><span class="si">{</span><span class="n">story_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">index</span><span class="p">][</span><span class="s2">&quot;story&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Unique id of retreived document: </span><span class="si">{</span><span class="n">uid</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>

    </div>
  </div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
  <div class="prompt input_prompt">
</div><div class="inner_cell">
    <div class="text_cell_render border-box-sizing rendered_html">
      <div class=" alert alert-warning">
<h2 id="Student-Task-A5.12">Student Task A5.12<a class="anchor-link" href="#Student-Task-A5.12">&#182;</a></h2><p>Your task is to implement the function <code>predict_uid()</code>, which yields the predicted document uids (predicted_uid_list). The instructions for a single example are already shown in the cell above.</p>
</div>

    </div>
  </div></div>

<div id="cell-id=70dc492a" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[43]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="comment-cell-d7e99edb6dbd4d97"></a><div class="panel-heading"><span class="nbgrader-label">Student's answer</span><span class="pull-right"><a href="#top">(Top)</a></span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">predict_uid</span><span class="p">(</span><span class="n">query_embs</span><span class="p">,</span> <span class="n">story_embs</span><span class="p">,</span> <span class="n">story_df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Predict the uid for each query in the query_emb array.</span>
<span class="sd">    </span>
<span class="sd">    Args:</span>
<span class="sd">        query_emb (np.array): Array of query embeddings.</span>
<span class="sd">        story_emb (np.array): Array of story embeddings.</span>
<span class="sd">        story_df (pd.DataFrame): DataFrame containing story information including &#39;story_uid&#39;.</span>
<span class="sd">    Return:</span>
<span class="sd">        predicted_uid_list (List): List of predicted story uids corresponding to the queries.</span>
<span class="sd">    </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1">#list to append predicted story/document uids corresponding to the queries.  </span>
    <span class="n">predicted_uid_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="c1"># YOUR CODE HERE</span>
    <span class="k">for</span> <span class="n">query_emb</span> <span class="ow">in</span> <span class="n">query_embs</span><span class="p">:</span>
        <span class="n">similarity_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">cosine_similarity</span><span class="p">(</span><span class="n">query_emb</span><span class="p">,</span> <span class="n">story_emb</span><span class="p">)</span> <span class="k">for</span> <span class="n">story_emb</span> <span class="ow">in</span> <span class="n">story_embs</span><span class="p">]</span>
        <span class="n">max_index</span> <span class="o">=</span> <span class="n">similarity_list</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">similarity_list</span><span class="p">))</span>
        <span class="n">predicted_uid</span> <span class="o">=</span> <span class="n">story_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">max_index</span><span class="p">][</span><span class="s1">&#39;story_uid&#39;</span><span class="p">]</span>
        <span class="n">predicted_uid_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">predicted_uid</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">predicted_uid_list</span>
<span class="c1"># #unit test example:</span>
<span class="c1"># predicted_uids_test = predict_uid(query_emb_array[:2],story_emb_array,story_df) # correct output should be predicted_uids_test = [957, 245]</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

</div>
<div id="cell-id=08811c87" class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[44]:</div><div class="panel panel-primary nbgrader_cell">
    <a name="cell-4722a2f16e1305ef"></a><div class="panel-heading"><span class="nbgrader-label">Grade cell: <code>cell-4722a2f16e1305ef</code></span>
  <span class="pull-right">
      Score: 1.0 / 1.0 <a href="#top">(Top)</a>
  </span></div>
    <div class="panel-body">
      <div class="input_area">
        <div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># this cell is for tests</span>

<span class="c1">### BEGIN HIDDEN TESTS</span>

<span class="n">predicted_uids</span> <span class="o">=</span> <span class="n">predict_uid</span><span class="p">(</span><span class="n">query_emb_array</span><span class="p">,</span> <span class="n">story_emb_array</span><span class="p">,</span> <span class="n">story_df</span><span class="p">)</span>

<span class="n">ground_truth_uids</span> <span class="o">=</span> <span class="p">[</span><span class="mi">957</span><span class="p">,</span><span class="mi">245</span><span class="p">,</span><span class="mi">86</span><span class="p">,</span><span class="mi">839</span><span class="p">,</span><span class="mi">699</span><span class="p">,</span><span class="mi">862</span><span class="p">,</span><span class="mi">616</span><span class="p">,</span><span class="mi">350</span><span class="p">,</span><span class="mi">278</span><span class="p">,</span><span class="mi">195</span><span class="p">,</span><span class="mi">335</span><span class="p">,</span><span class="mi">525</span><span class="p">,</span><span class="mi">526</span><span class="p">,</span><span class="mi">323</span><span class="p">,</span><span class="mi">419</span><span class="p">,</span><span class="mi">305</span><span class="p">,</span><span class="mi">436</span><span class="p">,</span><span class="mi">922</span><span class="p">,</span><span class="mi">141</span><span class="p">,</span><span class="mi">900</span><span class="p">,</span><span class="mi">336</span><span class="p">,</span><span class="mi">958</span><span class="p">,</span>
                    <span class="mi">255</span><span class="p">,</span><span class="mi">340</span><span class="p">,</span><span class="mi">188</span><span class="p">,</span><span class="mi">279</span><span class="p">,</span><span class="mi">258</span><span class="p">,</span><span class="mi">969</span><span class="p">,</span><span class="mi">389</span><span class="p">,</span><span class="mi">249</span><span class="p">,</span><span class="mi">105</span><span class="p">,</span><span class="mi">274</span><span class="p">,</span><span class="mi">633</span><span class="p">,</span><span class="mi">340</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">541</span><span class="p">,</span><span class="mi">69</span><span class="p">,</span><span class="mi">230</span><span class="p">,</span><span class="mi">712</span><span class="p">,</span><span class="mi">441</span><span class="p">,</span><span class="mi">310</span><span class="p">,</span><span class="mi">306</span><span class="p">,</span><span class="mi">956</span><span class="p">,</span><span class="mi">178</span><span class="p">,</span>
                    <span class="mi">223</span><span class="p">,</span><span class="mi">966</span><span class="p">,</span><span class="mi">138</span><span class="p">,</span><span class="mi">652</span><span class="p">,</span><span class="mi">362</span><span class="p">,</span><span class="mi">612</span><span class="p">,</span><span class="mi">281</span><span class="p">,</span><span class="mi">559</span><span class="p">,</span><span class="mi">570</span><span class="p">,</span><span class="mi">479</span><span class="p">,</span><span class="mi">491</span><span class="p">,</span><span class="mi">441</span><span class="p">,</span><span class="mi">591</span><span class="p">,</span><span class="mi">763</span><span class="p">,</span><span class="mi">448</span><span class="p">,</span><span class="mi">468</span><span class="p">,</span><span class="mi">177</span><span class="p">,</span><span class="mi">647</span><span class="p">,</span><span class="mi">733</span><span class="p">,</span><span class="mi">427</span><span class="p">,</span><span class="mi">169</span><span class="p">,</span><span class="mi">485</span><span class="p">,</span>
                    <span class="mi">391</span><span class="p">,</span><span class="mi">903</span><span class="p">,</span><span class="mi">767</span><span class="p">,</span><span class="mi">238</span><span class="p">,</span><span class="mi">323</span><span class="p">,</span><span class="mi">929</span><span class="p">,</span><span class="mi">880</span><span class="p">,</span><span class="mi">567</span><span class="p">,</span><span class="mi">615</span><span class="p">,</span><span class="mi">552</span><span class="p">,</span><span class="mi">561</span><span class="p">,</span><span class="mi">298</span><span class="p">,</span><span class="mi">781</span><span class="p">,</span><span class="mi">281</span><span class="p">,</span><span class="mi">458</span><span class="p">,</span><span class="mi">969</span><span class="p">,</span><span class="mi">754</span><span class="p">,</span><span class="mi">179</span><span class="p">,</span><span class="mi">441</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">465</span><span class="p">,</span><span class="mi">191</span><span class="p">,</span>
                    <span class="mi">493</span><span class="p">,</span><span class="mi">593</span><span class="p">,</span><span class="mi">836</span><span class="p">,</span><span class="mi">318</span><span class="p">,</span><span class="mi">646</span><span class="p">,</span><span class="mi">828</span><span class="p">,</span><span class="mi">936</span><span class="p">,</span><span class="mi">661</span><span class="p">,</span><span class="mi">469</span><span class="p">,</span><span class="mi">704</span><span class="p">,</span><span class="mi">686</span><span class="p">,</span><span class="mi">470</span><span class="p">]</span>

<span class="n">accuracy</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="mi">1</span> <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">predicted_uids</span><span class="p">,</span> <span class="n">ground_truth_uids</span><span class="p">)])</span> <span class="o">/</span> <span class="mi">100</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The model accuracy is:&#39;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">accuracy</span> <span class="o">&gt;</span> <span class="mf">0.64</span>

<span class="c1">### END HIDDEN TESTS</span>
</pre></div>

      </div>
    </div>
    
  </div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt"></div>


<div class="output_subarea output_stream output_stdout output_text">
<pre>The model accuracy is: 0.66
</pre>
</div>
</div>

</div>
</div>

</div>
    </div>
  </div>
</body>

          </div>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
